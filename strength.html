<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>13&nbsp; Study Design – Business Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./other_methods.html" rel="next">
<link href="./coordination.html" rel="prev">
<link href="./hex.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-364982630eef5352dd1537128a8ed5cb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/social-share-0.1.0/social-share.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/social-share-0.1.0/all.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script defer="" src="https://umami.martinez.fyi/script.js" data-website-id="bc587120-3bd3-4c2d-b463-5eb64dd4e330"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="13&nbsp; Study Design – Business Data Science">
<meta property="og:description" content="">
<meta property="og:image" content="https://book.martinez.fyi/strength_files/figure-html/unnamed-chunk-1-1.png">
<meta property="og:site_name" content="Business Data Science">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
<meta name="twitter:title" content="13&nbsp; Study Design – Business Data Science">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://book.martinez.fyi/strength_files/figure-html/unnamed-chunk-1-1.png">
<meta name="twitter:image-height" content="960">
<meta name="twitter:image-width" content="1344">
<meta name="twitter:card" content="summary_large_image">
<meta name="citation_title" content="[13]{.chapter-number}&nbsp; [Study Design]{.chapter-title}">
<meta name="citation_fulltext_html_url" content="https:/book.martinez.fyi">
<meta name="citation_language" content="en">
<meta name="citation_book_title" content="Business Data Science: A guide for data-driven decisions">
<meta name="citation_reference" content="citation_title=Sur les applications de la théorie des probabilités aux experiences agricoles: Essai des principes;,citation_author=Jersey Neyman;,citation_publication_date=1923;,citation_cover_date=1923;,citation_year=1923;,citation_issue=1;,citation_volume=10;,citation_journal_title=Roczniki Nauk Rolniczych;">
<meta name="citation_reference" content="citation_title=Causal inference;,citation_author=Peng Ding;,citation_author=Fan Li;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_fulltext_html_url=https://projecteuclid.org/journals/statistical-science/volume-33/issue-2/Causal-Inference-A-Missing-Data-Perspective/10.1214/18-STS645.pdf;,citation_issue=2;,citation_volume=33;,citation_journal_title=Statistical Science;,citation_publisher=JSTOR;">
<meta name="citation_reference" content="citation_title=Estimating causal effects of treatments in randomized and nonrandomized studies.;,citation_author=Donald B Rubin;,citation_publication_date=1974;,citation_cover_date=1974;,citation_year=1974;,citation_fulltext_html_url=http://www.fsb.muohio.edu/lij14/420_paper_Rubin74.pdf;,citation_issue=5;,citation_volume=66;,citation_journal_title=Journal of educational Psychology;,citation_publisher=American Psychological Association;">
<meta name="citation_reference" content="citation_title=Bayesian inference for causal effects: The role of randomization;,citation_author=Donald B Rubin;,citation_publication_date=1978;,citation_cover_date=1978;,citation_year=1978;,citation_fulltext_html_url=https://www.jstor.org/stable/2958688;,citation_journal_title=The Annals of statistics;,citation_publisher=JSTOR;">
<meta name="citation_reference" content="citation_title=The lure of incredible certitude;,citation_author=Charles F Manski;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_fulltext_html_url=https://www.nber.org/system/files/working_papers/w24905/w24905.pdf;,citation_issue=2;,citation_volume=36;,citation_journal_title=Economics &amp;amp;amp; Philosophy;,citation_publisher=Cambridge University Press;">
<meta name="citation_reference" content="citation_title=The ASA statement on p-values: Context, process, and purpose;,citation_author=Ronald L Wasserstein;,citation_author=Nicole A Lazar;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;,citation_fulltext_html_url=https://www.tandfonline.com/doi/pdf/10.1080/00031305.2016.1154108;,citation_volume=70;,citation_journal_title=The American Statistician;,citation_publisher=Taylor &amp;amp;amp; Francis;">
<meta name="citation_reference" content="citation_title=What works for whom? A bayesian approach to channeling big data streams for public program evaluation;,citation_author=Mariel McKenzie Finucane;,citation_author=Ignacio Martinez;,citation_author=Scott Cody;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_fulltext_html_url=https://journals.sagepub.com/doi/abs/10.1177/1098214017737173;,citation_issue=1;,citation_volume=39;,citation_journal_title=American Journal of Evaluation;,citation_publisher=SAGE Publications Sage CA: Los Angeles, CA;">
<meta name="citation_reference" content="citation_title=Beyond “treatment versus control”: How bayesian analysis makes factorial experiments feasible in education research;,citation_author=Daniel Kassler;,citation_author=Ira Nichols-Barrer;,citation_author=Mariel Finucane;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_fulltext_html_url=https://journals.sagepub.com/doi/abs/10.1177/0193841X18818903;,citation_doi=10.1177/0193841X18818903;">
<meta name="citation_reference" content="citation_title=Nudge: The final edition;,citation_author=Richard H Thaler;,citation_author=Cass R Sunstein;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;">
<meta name="citation_reference" content="citation_title=Nudge: Improving decisions about health, wealth, and happiness;,citation_author=Richard H Thaler;,citation_author=Cass R Sunstein;,citation_publication_date=2009;,citation_cover_date=2009;,citation_year=2009;">
<meta name="citation_reference" content="citation_title=Speaking on data’s behalf: What researchers say and how audiences choose;,citation_author=Jesse J Chandler;,citation_author=Ignacio Martinez;,citation_author=Mariel M Finucane;,citation_author=Jeffrey G Terziev;,citation_author=Alexandra M Resch;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_issue=4;,citation_volume=44;,citation_journal_title=Evaluation Review;,citation_publisher=SAGE Publications Sage CA: Los Angeles, CA;">
<meta name="citation_reference" content="citation_title=The null ritual;,citation_author=Gerd Gigerenzer;,citation_author=Stefan Krauss;,citation_author=Oliver Vitouch;,citation_publication_date=2004;,citation_cover_date=2004;,citation_year=2004;,citation_journal_title=The Sage handbook of quantitative methodology for the social sciences;,citation_publisher=Sage Thousand Oaks, CA;">
<meta name="citation_reference" content="citation_title=Robust misinterpretation of confidence intervals;,citation_author=Rink Hoekstra;,citation_author=Richard D Morey;,citation_author=Jeffrey N Rouder;,citation_author=Eric-Jan Wagenmakers;,citation_publication_date=2014;,citation_cover_date=2014;,citation_year=2014;,citation_fulltext_html_url=https://ejwagenmakers.com/inpress/HoekstraEtAlPBR.pdf;,citation_doi=10.3758/s13423-013-0572-3;,citation_volume=21;,citation_journal_title=Psychonomic bulletin &amp;amp;amp; review;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Applied causal inference powered by ML and AI;,citation_author=Victor Chernozhukov;,citation_author=Christian Hansen;,citation_author=Nathan Kallus;,citation_author=Martin Spindler;,citation_author=Vasilis Syrgkanis;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://causalml-book.org/assets/chapters/CausalML_chap_2.pdf;,citation_issue=1;,citation_volume=12;">
<meta name="citation_reference" content="citation_title=What works clearinghouse baseline equivalence standard;,citation_author=undefined WWC;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_fulltext_html_url=https://ies.ed.gov/ncee/wwc/Docs/ReferenceResources/WWC-Baseline-Brief-v6_508.pdf;,citation_technical_report_institution=U.S. Department of Education, Institute of Education Sciences, National Center for Education Evaluation; Regional Assistance;">
<meta name="citation_reference" content="citation_title=Using Rapid-Cycle Evaluation to Improve Program Design and Delivery;,citation_abstract=This chapter discusses rapid-cycle evaluation (RCE) approaches to inform decisions related to program design and to support ongoing program improvement. As the name suggests, RCEs involve quick systematic tests to facilitate learning around programmatic elements. They can be used to diagnose challenges, identify facilitators to implementation and take-up, and test potential solutions. RCEs can be useful at early stages of implementation or program design to help identify operational choices that can maximize chances of a program’s success, as well as during program implementation if a program does not appear to be achieving the desired results. RCE approaches can also be used to test short-term program effectiveness, when taking a program to scale, or when seeking to adapt a successful implementation effort in a different context. This chapter describes the steps involved in implementing RCE and provides several instances of using RCE for program design and improvement.;,citation_author=Emilie Bagby;,citation_author=Anu Rangarajan;,citation_publication_date=2023-12;,citation_cover_date=2023-12;,citation_year=2023;,citation_fulltext_html_url=https://doi.org/10.1093/oxfordhb/9780190059668.013.7;,citation_doi=10.1093/oxfordhb/9780190059668.013.7;,citation_isbn=9780190059668;">
<meta name="citation_reference" content="citation_title=Bayesian causal inference: A critical review;,citation_author=Fan Li;,citation_author=Peng Ding;,citation_author=Fabrizia Mealli;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=2247;,citation_doi=10.1098/rsta.2022.0153;,citation_volume=381;,citation_journal_title=Philosophical Transactions of the Royal Society A;,citation_publisher=The Royal Society;">
<meta name="citation_reference" content="citation_title=The most dangerous equation;,citation_author=Howard Wainer;,citation_publication_date=2007;,citation_cover_date=2007;,citation_year=2007;,citation_issue=3;,citation_volume=95;,citation_journal_title=American Scientist;">
<meta name="citation_reference" content="citation_title=Inferring causal impact using bayesian structural time-series models;,citation_author=Kay H Brodersen;,citation_author=Fabian Gallusser;,citation_author=Jim Koehler;,citation_author=Nicolas Remy;,citation_author=Steven L Scott;,citation_publication_date=2015;,citation_cover_date=2015;,citation_year=2015;,citation_doi=10.1214/14-AOAS788;,citation_volume=9;,citation_journal_title=Annals of Applied Statistics;">
<meta name="citation_reference" content="citation_title=Evaluating the surrogate index as a decision-making tool using 200 a/b tests at netflix;,citation_author=Vickie Zhang;,citation_author=Michael Zhao;,citation_author=Anh Le;,citation_author=Nathan Kallus;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_journal_title=arXiv preprint arXiv:2311.11922;">
<meta name="citation_reference" content="citation_title=Long-term causal inference under persistent confounding via data combination;,citation_author=Guido Imbens;,citation_author=Nathan Kallus;,citation_author=Xiaojie Mao;,citation_author=Yuhao Wang;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_journal_title=arXiv preprint arXiv:2202.07234;">
<meta name="citation_reference" content="citation_title=The surrogate index: Combining short-term proxies to estimate long-term treatment effects more rapidly and precisely;,citation_author=Susan Athey;,citation_author=Raj Chetty;,citation_author=Guido W Imbens;,citation_author=Hyunseung Kang;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_technical_report_institution=National Bureau of Economic Research;">
<meta name="citation_reference" content="citation_title=Semiparametric estimation of long-term treatment effects;,citation_author=Jiafeng Chen;,citation_author=David M Ritzwoller;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=2;,citation_volume=237;,citation_journal_title=Journal of Econometrics;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Bayesian and frequentist inference for synthetic controls;,citation_author=Ignacio Martinez;,citation_author=Jaume Vives-i-Bastida;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://arxiv.org/abs/2206.01779;">
<meta name="citation_reference" content="citation_title=Synthetic controls in action;,citation_author=Alberto Abadie;,citation_author=Jaume Vives-i-Bastida;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2203.06279;">
<meta name="citation_reference" content="citation_title=Comparative politics and the synthetic control method;,citation_author=Alberto Abadie;,citation_author=Alexis Diamond;,citation_author=Jens Hainmueller;,citation_publication_date=2015;,citation_cover_date=2015;,citation_year=2015;,citation_issue=2;,citation_volume=59;,citation_journal_title=American Journal of Political Science;,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=Parallel experiments in eight schools;,citation_author=A. Gelman;,citation_author=J. B. Carlin;,citation_author=H. S. Stern;,citation_author=D. B. Dunson;,citation_author=A. Vehtari;,citation_author=D. B. Rubin;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_fulltext_html_url=https://books.google.com/books?id=ZXL6AQAAQBAJ;,citation_isbn=9781439840955;,citation_inbook_title=Bayesian data analysis, third edition;,citation_series_title=Chapman &amp;amp;amp; hall/CRC texts in statistical science;">
<meta name="citation_reference" content="citation_title=Statistics and causal inference;,citation_author=Paul W Holland;,citation_publication_date=1986;,citation_cover_date=1986;,citation_year=1986;,citation_issue=396;,citation_doi=10.2307/2289064;,citation_volume=81;,citation_journal_title=Journal of the American statistical Association;,citation_publisher=Taylor &amp;amp;amp; Francis;">
<meta name="citation_reference" content="citation_title=Rstanarm: Bayesian applied regression modeling via Stan.;,citation_author=Ben Goodrich;,citation_author=Jonah Gabry;,citation_author=Imad Ali;,citation_author=Sam Brilleman;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_fulltext_html_url=https://mc-stan.org/rstanarm;">
<meta name="citation_reference" content="citation_title=brms: An R package for Bayesian multilevel models using Stan;,citation_author=Paul-Christian Bürkner;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=1;,citation_doi=10.18637/jss.v080.i01;,citation_volume=80;,citation_journal_title=Journal of Statistical Software;">
<meta name="citation_reference" content="citation_title=Stan: A probabilistic programming language;,citation_abstract=Stan is a probabilistic programming language for specifying statistical models. A Stan program imperatively defines a log probability function over parameters conditioned on specified data and constants. As of version 2.14.0, Stan provides full Bayesian inference for continuous-variable models through Markov chain Monte Carlo methods such as the No-U-Turn sampler, an adaptive form of Hamiltonian Monte Carlo sampling. Penalized maximum likelihood estimates are calculated using optimization methods such as the limited memory Broyden-Fletcher-Goldfarb-Shanno algorithm. Stan is also a platform for computing log densities and their gradients and Hessians, which can be used in alternative algorithms such as variational Bayes, expectation propagation, and marginal inference using approximate integration. To this end, Stan is set up so that the densities, gradients, and Hessians, along with intermediate quantities of the algorithm such as acceptance probabilities, are easily accessible. Stan can be called from the command line using the cmdstan package, through R using the rstan package, and through Python using the pystan package. All three interfaces support sampling and optimization-based inference with diagnostics and posterior analysis. rstan and pystan also provide access to log probabilities, gradients, Hessians, parameter transforms, and specialized plotting.;,citation_author=Bob Carpenter;,citation_author=Andrew Gelman;,citation_author=Matthew D. Hoffman;,citation_author=Daniel Lee;,citation_author=Ben Goodrich;,citation_author=Michael Betancourt;,citation_author=Marcus Brubaker;,citation_author=Jiqiang Guo;,citation_author=Peter Li;,citation_author=Allen Riddell;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_fulltext_html_url=https://www.jstatsoft.org/index.php/jss/article/view/v076i01;,citation_issue=1;,citation_doi=10.18637/jss.v076.i01;,citation_volume=76;,citation_journal_title=Journal of Statistical Software;">
<meta name="citation_reference" content="citation_title=The state of applied econometrics: Causality and policy evaluation;,citation_author=Susan Athey;,citation_author=Guido W Imbens;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=2;,citation_volume=31;,citation_journal_title=Journal of Economic perspectives;,citation_publisher=American Economic Association 2014 Broadway, Suite 305, Nashville, TN 37203-2418;">
<meta name="citation_reference" content="citation_title=Using synthetic controls: Feasibility, data requirements, and methodological aspects;,citation_author=Alberto Abadie;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_issue=2;,citation_volume=59;,citation_journal_title=Journal of Economic Literature;,citation_publisher=American Economic Association 2014 Broadway, Suite 305, Nashville, TN 37203-2425;">
<meta name="citation_reference" content="citation_title=Potential outcomes causal model;,citation_author=Scott Cunningham;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://mixtape.scunning.com/04-potential_outcomes;,citation_inbook_title=Causal inference: The mixtape;">
<meta name="citation_reference" content="citation_title=BART: Bayesian additive regression trees;,citation_author=Hugh A. Chipman;,citation_author=Edward I. George;,citation_author=Robert E. McCulloch;,citation_publication_date=2010;,citation_cover_date=2010;,citation_year=2010;,citation_fulltext_html_url=https://doi.org/10.1214/09-AOAS285;,citation_issue=1;,citation_doi=10.1214/09-AOAS285;,citation_volume=4;,citation_journal_title=The Annals of Applied Statistics;,citation_publisher=Institute of Mathematical Statistics;">
<meta name="citation_reference" content="citation_title=Bayesian nonparametric modeling for causal inference;,citation_author=Jennifer L Hill;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_issue=1;,citation_doi=10.1198/jcgs.2010.08162;,citation_volume=20;,citation_journal_title=Journal of Computational and Graphical Statistics;,citation_publisher=Taylor &amp;amp;amp; Francis;">
<meta name="citation_reference" content="citation_title=Causal methods madness: Lessons learned from the 2022 ACIC competition to estimate health policy impacts;,citation_author=Dan RC Thal;,citation_author=Mariel M Finucane;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=3;,citation_doi=110.1353/obs.2023.0023;,citation_volume=9;,citation_journal_title=Observational Studies;,citation_publisher=University of Pennsylvania Press;">
<meta name="citation_reference" content="citation_title=Bayesian regression tree models for causal inference: Regularization, confounding, and heterogeneous effects (with discussion);,citation_author=P Richard Hahn;,citation_author=Jared S Murray;,citation_author=Carlos M Carvalho;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_issue=3;,citation_doi=10.1214/19-BA1195;,citation_volume=15;,citation_journal_title=Bayesian Analysis;,citation_publisher=International Society for Bayesian Analysis;">
<meta name="citation_reference" content="citation_title=LongBet: Heterogeneous treatment effect estimation in panel data;,citation_author=Meijia Wang;,citation_author=Ignacio Martinez;,citation_author=P Richard Hahn;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_doi=arXiv:2406.02530;,citation_journal_title=arXiv preprint arXiv:2406.02530;">
<meta name="citation_reference" content="citation_title=Stochtree: Stochastic tree ensembles (XBART and BART) for supervised learning and causal inference;,citation_author=Drew Herren;,citation_author=Richard Hahn;,citation_author=Jared Murray;,citation_author=Carlos Carvalho;,citation_author=Jingyu He;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://stochastictree.github.io/stochtree-r/;">
<meta name="citation_reference" content="citation_title=Stochastic tree ensembles for estimating heterogeneous effects;,citation_abstract=Determining subgroups that respond especially well (or poorly) to specific interventions (medical or policy) requires new supervised learning methods tailored specifically for causal inference. Bayesian Causal Forest (BCF) is a recent method that has been documented to perform well on data generating processes with strong confounding of the sort that is plausible in many applications. This paper develops a novel algorithm for fitting the BCF model, which is more efficient than the previous Gibbs sampler. The new algorithm can be used to initialize independent chains of the existing Gibbs sampler leading to better posterior exploration and coverage of the associated interval estimates in simulation studies. The new algorithm is compared to related approaches via simulation studies as well as an empirical analysis.;,citation_author=Nikolay Krantsevich;,citation_author=Jingyu He;,citation_author=P. Richard Hahn;,citation_editor=Francisco Ruiz;,citation_editor=Jennifer Dy;,citation_editor=Jan-Willem Meent;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://proceedings.mlr.press/v206/krantsevich23a.html;,citation_volume=206;,citation_conference_title=Proceedings of the 26th international conference on artificial intelligence and statistics;,citation_conference=PMLR;,citation_series_title=Proceedings of machine learning research;">
<meta name="citation_reference" content="citation_title=XBART: Accelerated bayesian additive regression trees;,citation_author=Jingyu He;,citation_author=Saar Yalov;,citation_author=P Richard Hahn;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://proceedings.mlr.press/v89/he19a.html;,citation_conference_title=The 22nd international conference on artificial intelligence and statistics;,citation_conference=PMLR;">
<meta name="citation_reference" content="citation_title=Thinking in bets: Making smarter decisions when you don’t have all the facts;,citation_author=Annie Duke;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://www.google.com/books/edition/Thinking_in_Bets/CI-RDwAAQBAJ;">
<meta name="citation_reference" content="citation_title=MatchIt: Nonparametric preprocessing for parametric causal inference;,citation_author=Daniel E. Ho;,citation_author=Kosuke Imai;,citation_author=Gary King;,citation_author=Elizabeth A. Stuart;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_issue=8;,citation_doi=10.18637/jss.v042.i08;,citation_volume=42;,citation_journal_title=Journal of Statistical Software;">
<meta name="citation_reference" content="citation_title=Matching as nonparametric preprocessing for reducing model dependence in parametric causal inference;,citation_author=Daniel E Ho;,citation_author=Kosuke Imai;,citation_author=Gary King;,citation_author=Elizabeth A Stuart;,citation_publication_date=2007;,citation_cover_date=2007;,citation_year=2007;,citation_issue=3;,citation_volume=15;,citation_journal_title=Political analysis;,citation_publisher=Cambridge University Press;">
<meta name="citation_reference" content="citation_title=Why propensity scores should not be used for matching;,citation_author=Gary King;,citation_author=Richard Nielsen;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_issue=4;,citation_doi=10.1017/pan.2019.11;,citation_volume=27;,citation_journal_title=Political Analysis;">
<meta name="citation_reference" content="citation_title=Bayesianly Justifiable and Relevant Frequency Calculations for the Applied Statistician;,citation_author=Donald B. Rubin;,citation_publication_date=1984;,citation_cover_date=1984;,citation_year=1984;,citation_fulltext_html_url=https://doi.org/10.1214/aos/1176346785;,citation_issue=4;,citation_doi=10.1214/aos/1176346785;,citation_volume=12;,citation_journal_title=The Annals of Statistics;,citation_publisher=Institute of Mathematical Statistics;">
<meta name="citation_reference" content="citation_title=Bayesian data analysis for newcomers;,citation_author=John K Kruschke;,citation_author=Torrin M Liddell;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=1;,citation_doi=10.3758/s13423-017-1272-1;,citation_volume=25;,citation_journal_title=Psychonomic bulletin &amp;amp;amp; review;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Bayesian data analysis, third edition;,citation_author=A. Gelman;,citation_author=J. B. Carlin;,citation_author=H. S. Stern;,citation_author=D. B. Dunson;,citation_author=A. Vehtari;,citation_author=D. B. Rubin;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_fulltext_html_url=http://www.stat.columbia.edu/~gelman/book/;,citation_isbn=9781439840955;,citation_series_title=Chapman &amp;amp;amp; hall/CRC texts in statistical science;">
<meta name="citation_reference" content="citation_title=Statistical rethinking: A bayesian course with examples in r and stan;,citation_author=R. McElreath;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_fulltext_html_url=https://books.google.com/books?id=T3FQDwAAQBAJ;,citation_isbn=9781315362618;,citation_series_title=Chapman &amp;amp;amp; hall/CRC texts in statistical science;">
<meta name="citation_reference" content="citation_title=Statistical rethinking: A bayesian course with examples in r and stan;,citation_author=R. McElreath;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_fulltext_html_url=https://books.google.com/books?id=T3FQDwAAQBAJ;,citation_isbn=9781315362618;,citation_series_title=Chapman &amp;amp;amp;amp; hall/CRC texts in statistical science;">
<meta name="citation_reference" content="citation_title=Shinylive: Run ’shiny’ applications in the browser;,citation_author=Barret Schloerke;,citation_author=Winston Chang;,citation_author=George Stagg;,citation_author=Garrick Aden-Buie;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://posit-dev.github.io/r-shinylive/;">
<meta name="citation_reference" content="citation_title=Distribution theory for glass’s estimator of effect size and related estimators;,citation_author=Larry V Hedges;,citation_publication_date=1981;,citation_cover_date=1981;,citation_year=1981;,citation_issue=2;,citation_doi=10.3102/10769986006002107;,citation_volume=6;,citation_journal_title=journal of Educational Statistics;,citation_publisher=Sage Publications Sage CA: Thousand Oaks, CA;">
<meta name="citation_reference" content="citation_title=Regression models and life-tables;,citation_author=David R Cox;,citation_publication_date=1972;,citation_cover_date=1972;,citation_year=1972;,citation_fulltext_html_url=https://rss.onlinelibrary.wiley.com/doi/abs/10.1111/j.2517-6161.1972.tb00899.x;,citation_issue=2;,citation_doi=https://doi.org/10.1111/j.2517-6161.1972.tb00899.x;,citation_volume=34;,citation_journal_title=Journal of the Royal Statistical Society: Series B (Methodological);,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=Baseline equivalence: What it is and why it is needed;,citation_author=Mary Anne Anderson;,citation_author=Nan Maxwell;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_fulltext_html_url=https://www.mathematica.org/-/media/publications/pdfs/labor/2021/cncs_baseline-equivalencebrief.pdf;,citation_journal_title=Submitted to AmeriCorps by Mathematica. Chicago, IL, September;">
<meta name="citation_reference" content="citation_title=STA 640 — causal inference unit 6.2: Post-treatment confounding: Principal stratification;,citation_author=Fan Li;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://www2.stat.duke.edu/~fl35/teaching/640/Chapter6.2_principal%20stratification.pdf;">
<meta name="citation_reference" content="citation_title=Identification of causal effects using instrumental variables;,citation_author=Joshua D Angrist;,citation_author=Guido W Imbens;,citation_author=Donald B Rubin;,citation_publication_date=1996;,citation_cover_date=1996;,citation_year=1996;,citation_issue=434;,citation_doi=10.1080/01621459.1996.10476902;,citation_volume=91;,citation_journal_title=Journal of the American statistical Association;,citation_publisher=Taylor &amp;amp;amp; Francis;">
<meta name="citation_reference" content="citation_title=Principal stratification in causal inference;,citation_author=Constantine E Frangakis;,citation_author=Donald B Rubin;,citation_publication_date=2002;,citation_cover_date=2002;,citation_year=2002;,citation_fulltext_html_url=https://doi.org/10.1111/j.0006-341X.2002.00021.x;,citation_issue=1;,citation_doi=10.1111/j.0006-341X.2002.00021.x;,citation_volume=58;,citation_journal_title=Biometrics;,citation_publisher=Oxford University Press;">
<meta name="citation_reference" content="citation_title=Instrumental variables: An econometrician’s perspective;,citation_author=Guido Imbens;,citation_publication_date=2014;,citation_cover_date=2014;,citation_year=2014;,citation_doi=10.3386/w19983;,citation_technical_report_institution=National Bureau of Economic Research;">
<meta name="citation_reference" content="citation_title=Bayesian inference for causal effects in randomized experiments with noncompliance;,citation_author=Guido W. Imbens;,citation_author=Donald B. Rubin;,citation_publication_date=1997;,citation_cover_date=1997;,citation_year=1997;,citation_fulltext_html_url=http://www.jstor.org/stable/2242722;,citation_issue=1;,citation_issn=00905364;,citation_volume=25;,citation_journal_title=The Annals of Statistics;,citation_publisher=Institute of Mathematical Statistics;">
<meta name="citation_reference" content="citation_title=PStrata: An r package for principal stratification;,citation_author=Bo Liu;,citation_author=Fan Li;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://arxiv.org/abs/2304.02740;">
<meta name="citation_reference" content="citation_title=Principal stratification–uses and limitations;,citation_author=Tyler J VanderWeele;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_issue=1;,citation_doi=10.2202/1557-4679.1329;,citation_volume=7;,citation_journal_title=The international journal of biostatistics;,citation_publisher=De Gruyter;">
<meta name="citation_reference" content="citation_title=Finite mixtures and zero-inflated models;,citation_author=Stan Development Team;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://mc-stan.org/docs/stan-users-guide/finite-mixtures.html#zero-inflated.section;">
<meta name="citation_reference" content="citation_title=A guide to modeling outcomes that have lots of zeros with bayesian hurdle lognormal and hurdle gaussian regression models;,citation_author=Andrew Heiss;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://www.andrewheiss.com/blog/2022/05/09/hurdle-lognormal-gaussian-brms/;">
<meta name="citation_reference" content="citation_title=Trial registration at ClinicalTrials. Gov between may and october 2005;,citation_author=Deborah A Zarin;,citation_author=Tony Tse;,citation_author=Nicholas C Ide;,citation_publication_date=2005;,citation_cover_date=2005;,citation_year=2005;,citation_issue=26;,citation_volume=353;,citation_journal_title=New England Journal of Medicine;,citation_publisher=Mass Medical Soc;">
<meta name="citation_reference" content="citation_title=PowerUp!: A tool for calculating minimum detectable effect sizes and minimum required sample sizes for experimental and quasi-experimental design studies;,citation_author=Nianbo Dong;,citation_author=Rebecca Maynard;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_fulltext_html_url=https://www.ipr.northwestern.edu/documents/required-reading/2018/dong--maynard-2013.pdf;,citation_issue=1;,citation_volume=6;,citation_journal_title=Journal of Research on Educational Effectiveness;,citation_publisher=Taylor &amp;amp;amp; Francis;">
<meta name="citation_reference" content="citation_title=The core analytics of randomized experiments for social research;,citation_author=Howard S Bloom;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_fulltext_html_url=https://files.eric.ed.gov/fulltext/ED493363.pdf;,citation_journal_title=The SAGE handbook of social research methods;,citation_publisher=Sage Los Angeles;">
<meta name="citation_reference" content="citation_title=Beyond power calculations: Assessing type s (sign) and type m (magnitude) errors;,citation_author=Andrew Gelman;,citation_author=John Carlin;,citation_publication_date=2014;,citation_cover_date=2014;,citation_year=2014;,citation_fulltext_html_url=https://journals.sagepub.com/doi/pdf/10.1177/1745691614551642?trk=public_post_comment-text;,citation_issue=6;,citation_volume=9;,citation_journal_title=Perspectives on psychological science;,citation_publisher=Sage Publications Sage CA: Los Angeles, CA;">
<meta name="citation_reference" content="citation_title=Test &amp;amp;amp; roll: Profit-maximizing a/b tests;,citation_author=Elea McDonnell Feit;,citation_author=Ron Berman;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_fulltext_html_url=https://ui.adsabs.harvard.edu/abs/2018arXiv181100457M/abstract;,citation_journal_title=arXiv e-prints;">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./rct.html">The Gold Standard</a></li><li class="breadcrumb-item"><a href="./strength.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Study Design</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./hex.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Business Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ignacio82/book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">What Does it Mean to Be Data-Driven?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./potential_outcome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Potential Outcomes Framework</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./baseline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Baseline Equivalence</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes101.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bayes 101</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./decisions_first.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">A Decisions First Framework</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rce.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Rapid-Cycle Evaluation for Program Improvement</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surrogates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Surrogates</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./rct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Gold Standard</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rct_basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">The Power of Randomization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bad.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Bayesian Adaptive Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./factorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Bayesian Factorial Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Randomized Encouragement Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./coordination.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">The Importance of Coordination</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./strength.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Study Design</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./other_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Non Experimental Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Matching</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causalimpact.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Bayesian Structural Time Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bsynth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Bayesian Synthetic Control</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generalized Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./blm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Bayesian Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meta-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Meta-Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./beyond_normality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Beyond Normality</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hurdle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Hurdle Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./stochastictrees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Stochastic Trees</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Bayesian Additive Regression Trees (BART)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bcf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Bayesian Causal Forest (BCF)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longbet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">LongBet: Heterogeneous Treatment Effects in Panel Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causalPropensity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Causal Propensity Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#power-calculations-in-experimental-design" id="toc-power-calculations-in-experimental-design" class="nav-link active" data-scroll-target="#power-calculations-in-experimental-design"><span class="header-section-number">13.1</span> Power Calculations in Experimental Design</a>
  <ul class="collapse">
  <li><a href="#methods-for-performing-power-calculations" id="toc-methods-for-performing-power-calculations" class="nav-link" data-scroll-target="#methods-for-performing-power-calculations">Methods for Performing Power Calculations</a></li>
  <li><a href="#a-simple-example-with-the-analytical-method" id="toc-a-simple-example-with-the-analytical-method" class="nav-link" data-scroll-target="#a-simple-example-with-the-analytical-method">A Simple Example with the Analytical Method</a></li>
  <li><a href="#simulations-for-type-s-and-m-errors" id="toc-simulations-for-type-s-and-m-errors" class="nav-link" data-scroll-target="#simulations-for-type-s-and-m-errors">Simulations for Type S and M Errors</a></li>
  </ul></li>
  <li><a href="#profit-maximizing-ab-testing-a-test-roll-approach" id="toc-profit-maximizing-ab-testing-a-test-roll-approach" class="nav-link" data-scroll-target="#profit-maximizing-ab-testing-a-test-roll-approach"><span class="header-section-number">13.2</span> Profit-Maximizing A/B Testing: A Test &amp; Roll Approach</a>
  <ul class="collapse">
  <li><a href="#balancing-learning-and-opportunity-cost" id="toc-balancing-learning-and-opportunity-cost" class="nav-link" data-scroll-target="#balancing-learning-and-opportunity-cost">Balancing Learning and Opportunity Cost</a></li>
  <li><a href="#a-closed-form-insight" id="toc-a-closed-form-insight" class="nav-link" data-scroll-target="#a-closed-form-insight">A Closed-Form Insight</a></li>
  <li><a href="#extensions-to-asymmetric-and-complex-settings" id="toc-extensions-to-asymmetric-and-complex-settings" class="nav-link" data-scroll-target="#extensions-to-asymmetric-and-complex-settings">Extensions to Asymmetric and Complex Settings</a></li>
  <li><a href="#operational-advantages" id="toc-operational-advantages" class="nav-link" data-scroll-target="#operational-advantages">Operational Advantages</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul></li>
  <li><a href="#pilot-strength-a-decision-centric-approach" id="toc-pilot-strength-a-decision-centric-approach" class="nav-link" data-scroll-target="#pilot-strength-a-decision-centric-approach"><span class="header-section-number">13.3</span> Pilot Strength: A Decision-Centric Approach</a>
  <ul class="collapse">
  <li><a href="#generating-synthetic-data" id="toc-generating-synthetic-data" class="nav-link" data-scroll-target="#generating-synthetic-data">Generating Synthetic Data</a></li>
  <li><a href="#a-simple-stan-model-to-fit-the-data" id="toc-a-simple-stan-model-to-fit-the-data" class="nav-link" data-scroll-target="#a-simple-stan-model-to-fit-the-data">A Simple Stan Model to Fit the Data</a></li>
  <li><a href="#prior-predictive-checks" id="toc-prior-predictive-checks" class="nav-link" data-scroll-target="#prior-predictive-checks">Prior Predictive Checks</a></li>
  <li><a href="#sequential-bayesian-updating-with-incoming-data" id="toc-sequential-bayesian-updating-with-incoming-data" class="nav-link" data-scroll-target="#sequential-bayesian-updating-with-incoming-data">Sequential Bayesian Updating with Incoming Data</a></li>
  <li><a href="#calculating-the-strength-of-a-pilot" id="toc-calculating-the-strength-of-a-pilot" class="nav-link" data-scroll-target="#calculating-the-strength-of-a-pilot">Calculating the Strength of a Pilot</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ignacio82/book/edit/master/strength.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./rct.html">The Gold Standard</a></li><li class="breadcrumb-item"><a href="./strength.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Study Design</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Study Design</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>As we discussed before, the most important thing when designing a study is to start with the decision you are trying to inform, and craft the right business questions that can be answered with data to inform that decision. Then, if you are going to run an experiment to answer those questions you will have to think about important details such as how big of an experiment should I run, what should be the unit of randomization, what proportion should be assigned to each arm, etc. To answer these questions most people use power calculations.</p>
<section id="power-calculations-in-experimental-design" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="power-calculations-in-experimental-design"><span class="header-section-number">13.1</span> Power Calculations in Experimental Design</h2>
<p>In the context of experimental design, power is the probability of detecting an effect if it truly exists. In other words, it’s the likelihood of rejecting the null hypothesis when it is false. Power is intrinsically linked to Type II error (false negative), which is the probability of failing to reject the null hypothesis when it is actually false. Power is calculated as <span class="math inline">\(1 - \beta\)</span>, where <span class="math inline">\(\beta\)</span> represents the probability of a Type II error.</p>
<p>Power analysis involves determining the minimum sample size needed to detect an effect of a given size or determining the effect size that can be detected with a given sample size. A key concept in power analysis is the Minimum Detectable Effect (MDE), which is the smallest effect size that the study is designed to detect with a specified level of statistical power. Power can be conceptualized as a function of the signal-to-noise ratio in an experiment. The “signal” refers to the effect size, while the “noise” represents the variability within the data. A stronger signal and lower noise lead to higher power.</p>
<p>Traditional power analysis focuses on Type I and Type II errors. However, Gelman and Carlin (2014) argue that these are insufficient to fully capture the risks of null hypothesis significance testing (NHST). They propose considering Type S (sign) and Type M (magnitude) errors:</p>
<ul>
<li><strong>Type S error:</strong> The probability that a statistically significant result has the opposite sign of the true effect. This can lead to incorrect conclusions about the direction of an effect.</li>
<li><strong>Type M error:</strong> The factor by which a statistically significant effect might be overestimated. This can lead to exaggerated claims about the size of an effect.</li>
</ul>
<p>These errors are particularly relevant in studies with small samples and noisy data, where statistically significant results may be misleading. Gelman and Carlin recommend design analysis, which involves calculating Type S and Type M errors to assess the potential for these errors in a study design.</p>
<section id="methods-for-performing-power-calculations" class="level3">
<h3 class="anchored" data-anchor-id="methods-for-performing-power-calculations">Methods for Performing Power Calculations</h3>
<p>There are different methods for performing power calculations:</p>
<ul>
<li><p><strong>Analytical methods:</strong> These methods use formulas to calculate power or sample size based on the factors mentioned above. For example, the formula for calculating the sample size needed for a two-sample t-test can be found in many statistical textbooks .</p></li>
<li><p><strong>Simulation methods:</strong> These methods involve generating random data and performing statistical tests repeatedly to estimate power. They are particularly useful for complex study designs where analytical formulas may not be available or accurate.</p></li>
</ul>
</section>
<section id="a-simple-example-with-the-analytical-method" class="level3">
<h3 class="anchored" data-anchor-id="a-simple-example-with-the-analytical-method">A Simple Example with the Analytical Method</h3>
<p>Suppose we are thinking about running an experiment and our outcome of interest is binary and only 5% of the outcomes take the value 1. For example, this could be an experiment for reducing churn. Imagine we are testing a new intervention aimed at reducing customer churn, and we want to understand how large of an experiment we need to reliably detect a reduction in the churn rate if the intervention is effective. Our baseline churn rate is 5%, meaning that without any intervention, approximately 5% of customers churn.</p>
<p>We want to use an analytical method to perform a power calculation. Specifically, we want to investigate how the Minimum Detectable Effect (MDE) changes as we increase the sample size of our experiment. The MDE, in this context, represents the smallest reduction in the churn rate that our experiment is designed to detect with a given level of statistical power.</p>
<p>The R code below uses the <code>calculateMdes</code> function to compute the MDE for different sample sizes (N), assuming we are conducting a two-sample t-test to compare the churn rates between a treatment and a control group. We set the significance level (<code>sig_lvl</code>) to 0.05 and the desired power (<code>power</code>) to 0.80. This means we want to design our experiment such that if there is a true effect (reduction in churn), we have an 80% chance of detecting it as statistically significant at the 5% significance level. The proportion assigned to treatment (and control) p is set to 0.5, assuming equal allocation. The outcome is specified as “binary”, and <code>mean_y</code> is set to 0.05, representing our baseline churn rate.</p>
<p>The code then iterates through a range of sample sizes, from 500 to 2000, and calculates the MDE for each sample size. Finally, it generates a plot showing the relationship between the sample size (N) and the MDE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>calculateMdes <span class="ot">&lt;-</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(<span class="at">sig_lvl =</span> <span class="fl">0.05</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">power =</span> <span class="fl">0.80</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>           N,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">g =</span> <span class="dv">1</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">p =</span> <span class="fl">0.5</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">outcome =</span> <span class="fu">c</span>(<span class="st">"binary"</span>, <span class="st">"continuous"</span>),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">mean_y =</span> <span class="cn">NULL</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">sigma_y =</span> <span class="cn">NULL</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">R_sq_xy =</span> <span class="dv">0</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">rho =</span> <span class="dv">0</span>,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">R_sq_WG =</span> <span class="dv">0</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">R_sq_BG =</span> <span class="dv">0</span>) {</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Input Validation (Moved up for earlier checks)</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    outcome <span class="ot">&lt;-</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">match.arg</span>(outcome)  <span class="co"># Ensure a valid outcome is selected</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (outcome <span class="sc">==</span> <span class="st">"continuous"</span> <span class="sc">&amp;</span> <span class="fu">is.null</span>(sigma_y)) {</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"When outcome is continuous, you must specify sigma_y"</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (outcome <span class="sc">==</span> <span class="st">"binary"</span> <span class="sc">&amp;</span> <span class="fu">is.null</span>(mean_y)) {</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"When outcome is binary, you must specify mean_y"</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate Degrees of Freedom</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(g <span class="sc">==</span> <span class="dv">1</span>, N <span class="sc">-</span> <span class="dv">2</span>, g <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate Factor for t-distribution</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    factor <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="at">p =</span> <span class="dv">1</span> <span class="sc">-</span> sig_lvl <span class="sc">/</span> <span class="dv">2</span>, <span class="at">df =</span> df) <span class="sc">+</span> <span class="fu">qt</span>(<span class="at">p =</span> power, <span class="at">df =</span> df)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate sigma_lambdaRA_hat</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (g <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>      sigma_lambdaRA_hat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="dv">1</span> <span class="sc">-</span> R_sq_xy) <span class="sc">/</span> (N <span class="sc">*</span> p <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p)))</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      cluster_size <span class="ot">&lt;-</span> N <span class="sc">/</span> g</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      A <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (p <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p))</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>      B <span class="ot">&lt;-</span> ((<span class="dv">1</span> <span class="sc">-</span> rho) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> R_sq_WG)) <span class="sc">/</span> (g <span class="sc">*</span> cluster_size)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>      C <span class="ot">&lt;-</span> (rho <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> R_sq_BG)) <span class="sc">/</span> g</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>      sigma_lambdaRA_hat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(A <span class="sc">*</span> (B <span class="sc">+</span> C))</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate sigma_y for binary outcome</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (outcome <span class="sc">==</span> <span class="st">"binary"</span>) {</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>      sigma_y <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mean_y <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> mean_y))</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate MDE and MDES</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    MDE <span class="ot">&lt;-</span> factor <span class="sc">*</span> sigma_lambdaRA_hat <span class="sc">*</span> sigma_y</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    MDES <span class="ot">&lt;-</span> MDE <span class="sc">/</span> sigma_y</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="at">MDES =</span> MDES, <span class="at">MDE =</span> MDE))</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector of N values to explore (adjust as needed)</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>n_values <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">500</span>, <span class="dv">2000</span>, <span class="at">by =</span> <span class="dv">100</span>)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with MDE values for different N</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>mde_data <span class="ot">&lt;-</span> <span class="fu">map_df</span>(n_values, <span class="sc">~</span><span class="fu">calculateMdes</span>(<span class="at">N =</span> .x,</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a> <span class="at">sig_lvl =</span> <span class="fl">0.05</span>,</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a> <span class="at">power =</span> <span class="fl">0.80</span>,</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a> <span class="at">p =</span> <span class="fl">0.5</span>,</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a> <span class="at">outcome =</span> <span class="st">"binary"</span>,</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a> <span class="at">mean_y =</span> <span class="fl">0.05</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">N =</span> n_values)</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mde_data, <span class="fu">aes</span>(<span class="at">x =</span> N, <span class="at">y =</span> MDE)) <span class="sc">+</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Minimum Detectable Effect (MDE) vs. Sample Size (N)"</span>,</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Sample Size (N)"</span>,</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Minimum Detectable Effect (MDE)"</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="strength_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For instance, let’s consider a point on the plot. If with a sample size of 1000, the MDE is approximately 0.04. This means that with a total sample size of 1000 (500 in the treatment group and 500 in the control group), we would be able to detect a reduction in the churn rate of 4 percentage points. If the true reduction in churn rate due to our intervention is smaller, our experiment might not be powerful enough to detect it as statistically significant, and we might fail to reject the null hypothesis of no effect (even if a real, albeit smaller, effect exists).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interpreting MDEs
</div>
</div>
<div class="callout-body-container callout-body">
<p>The MDE curve helps you determine the tradeoff between sample size and detectable effect size. Larger sample sizes allow you to detect smaller effects, but at diminishing returns. When planning your study, consider both the smallest effect size that would be practically meaningful for your business decision and the resources required for different sample sizes.</p>
</div>
</div>
</section>
<section id="simulations-for-type-s-and-m-errors" class="level3">
<h3 class="anchored" data-anchor-id="simulations-for-type-s-and-m-errors">Simulations for Type S and M Errors</h3>
<p>To illustrate Type S (Sign) and M (Magnitude) errors in a practical context, let’s consider a simulation based on a common A/B testing scenario. Imagine a company has a baseline customer churn rate of 5% and aims to detect an impact of 2 percentage points through some intervention.</p>
<p>The simulation below assesses how frequently a study with a moderate sample size (n=500 per group) might incorrectly estimate the direction or exaggerate the magnitude of the observed effect:</p>
<p>Now lets run some simulations to estimate type S and M errors. The code bellow runs 10,000 simulations with 500 obervations in the treatment and 500 in the control group, 5% probability of churn for the control group, and and impact of 2 percentage points for treated units.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>estimateTypeSM <span class="ot">&lt;-</span> <span class="cf">function</span>(p_true_control, lift, n_per_group, alpha, n_sim) {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  p_true_variant <span class="ot">&lt;-</span> p_true_control <span class="sc">+</span> lift</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  simulations <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">control_successes =</span> <span class="fu">rbinom</span>(n_sim, n_per_group, p_true_control),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">variant_successes =</span> <span class="fu">rbinom</span>(n_sim, n_per_group, p_true_variant)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  prop_tests <span class="ot">&lt;-</span> <span class="fu">map2_df</span>(simulations<span class="sc">$</span>control_successes, simulations<span class="sc">$</span>variant_successes, </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                        <span class="sc">~</span> <span class="fu">tidy</span>(<span class="fu">prop.test</span>(<span class="fu">c</span>(.x, .y), </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">n =</span> <span class="fu">c</span>(n_per_group, n_per_group),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">correct =</span> <span class="cn">FALSE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">diff =</span> estimate2 <span class="sc">-</span> estimate1)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  significant_results <span class="ot">&lt;-</span> prop_tests <span class="sc">%&gt;%</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(p.value <span class="sc">&lt;</span> alpha)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  significant_count <span class="ot">&lt;-</span> <span class="fu">nrow</span>(significant_results)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(significant_count <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    type_s_rate <span class="ot">&lt;-</span> <span class="fu">mean</span>(significant_results<span class="sc">$</span>diff <span class="sc">*</span> lift <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    exaggeration <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(significant_results<span class="sc">$</span>diff) <span class="sc">/</span> <span class="fu">abs</span>(lift))</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    type_s_rate <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    exaggeration <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">significant_count =</span> significant_count,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">type_s_rate =</span> type_s_rate,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">exaggeration =</span> exaggeration</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">estimateTypeSM</span>(<span class="at">p_true_control =</span> <span class="fl">0.05</span>, <span class="at">lift =</span> <span class="fl">0.02</span>, <span class="at">n_per_group =</span> <span class="dv">500</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>, <span class="at">n_sim =</span> <span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Out of the 10,000 simulations, only 2636 yielded a statistically significant result. Among these statistically significant results, 0.23% incorrectly estimated the direction of the effect (Type S error). The average exaggeration of the effect size (Type M error) among the significant results was 1.93x.</p>
</section>
</section>
<section id="profit-maximizing-ab-testing-a-test-roll-approach" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="profit-maximizing-ab-testing-a-test-roll-approach"><span class="header-section-number">13.2</span> Profit-Maximizing A/B Testing: A Test &amp; Roll Approach</h2>
<p>Traditional power calculations in A/B testing focus on managing statistical significance by controlling Type I and Type II errors. However, in practical business experiments, the primary goal isn’t merely to “reject the null hypothesis” but to maximize overall profit. The test &amp; roll framework, introduced by <span class="citation" data-cites="mcdonnell2018test">McDonnell Feit and Berman (<a href="references.html#ref-mcdonnell2018test" role="doc-biblioref">2018</a>)</span>, re-frames sample size determination as a strategic decision balancing the cost of learning against the opportunity cost of deploying a suboptimal treatment.</p>
<section id="balancing-learning-and-opportunity-cost" class="level3">
<h3 class="anchored" data-anchor-id="balancing-learning-and-opportunity-cost">Balancing Learning and Opportunity Cost</h3>
<p>In conventional A/B tests, achieving high statistical power often requires large test groups, inadvertently exposing more customers to potentially inferior treatments. The test &amp; roll framework explicitly addresses two crucial considerations:</p>
<ul>
<li><strong>The cost of testing:</strong> Every unit allocated to the test phase may experience a less-than-optimal treatment.</li>
<li><strong>The benefit of deployment:</strong> Once the better treatment is identified, it can be applied to the remainder of the population to maximize profit.</li>
</ul>
<p>By quantifying these trade-offs explicitly, the optimal (profit-maximizing) test size is typically smaller than traditional hypothesis testing methods recommend, particularly when data responses are noisy or population size is limited.</p>
</section>
<section id="a-closed-form-insight" class="level3">
<h3 class="anchored" data-anchor-id="a-closed-form-insight">A Closed-Form Insight</h3>
<p><span class="citation" data-cites="mcdonnell2018test">McDonnell Feit and Berman (<a href="references.html#ref-mcdonnell2018test" role="doc-biblioref">2018</a>)</span> derived a closed-form formula for determining optimal test sizes under symmetric Normal priors (assuming no initial preference between treatments). Formally, the optimal sample size grows as follows:</p>
<p><span class="math display">\[ n^* \propto \sqrt{N} \quad \text{and} \quad n^* \sim \mathcal{O}\left(\frac{s}{\sigma}\right) \]</span> This implies:</p>
<ul>
<li>Optimal test size (<span class="math inline">\(n^*\)</span>) scales with the square root of the total available population (<span class="math inline">\(N\)</span>).</li>
<li>The optimal test size is sensitive to the response noise (<span class="math inline">\(s\)</span>) and the uncertainty in treatment effects (<span class="math inline">\(\sigma\)</span>).</li>
</ul>
<p>More specifically, proposition A.2 in their paper derives:</p>
<p><span class="math display">\[
n^{*}=n_{1}^{*}=n_{2}^{*}=\sqrt{\frac{N}{4}\left(\frac{s}{\sigma}\right)^{2}+\left(\frac{3}{4}\left(\frac{s}{\sigma}\right)^{2}\right)^{2}}-\frac{3}{4}\left(\frac{s}{\sigma}\right)^{2}
\]</span></p>
<p>This contrasts with traditional power calculations, which typically recommend sample sizes scaling linearly or super-linearly with variance, often resulting in overly large tests.</p>
</section>
<section id="extensions-to-asymmetric-and-complex-settings" class="level3">
<h3 class="anchored" data-anchor-id="extensions-to-asymmetric-and-complex-settings">Extensions to Asymmetric and Complex Settings</h3>
<p>The basic test &amp; roll framework can also be extended to account for situations where prior beliefs about the treatments differ. For instance:</p>
<ul>
<li><strong>Incumbent/Challenger Tests:</strong> If one treatment is well understood (the incumbent) and the other is more uncertain (the challenger), asymmetric priors can be used to justify allocating a larger sample to the less-known treatment.</li>
<li><strong>Pricing Experiments:</strong> When treatments involve different price points, the trade-offs include not only response variability but also differences in profit per sale. The framework naturally extends to these settings by adjusting priors to reflect both the likelihood of purchase and the profit margin.</li>
</ul>
</section>
<section id="operational-advantages" class="level3">
<h3 class="anchored" data-anchor-id="operational-advantages">Operational Advantages</h3>
<p>In practice, the test &amp; roll design helps managers make timely decisions:</p>
<ul>
<li><strong>Smaller, Agile Tests:</strong> By running smaller tests, firms expose fewer customers to a potentially inferior treatment.</li>
<li><strong>Transparency:</strong> The decision rule is based on explicit profit calculations, making it easier to justify the chosen test size and strategy.</li>
<li><strong>Comparable Performance:</strong> Despite its simplicity, the test &amp; roll approach has been shown to achieve regret—and thus overall performance—that is comparable to more complex, continuously adaptive methods like Thompson sampling.</li>
</ul>
</section>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<p>By centering experimentation on maximizing business impact rather than solely achieving statistical significance, the test &amp; roll framework presents a robust, economically efficient alternative to traditional power-based approaches. It optimally manages the trade-offs between learning and earning, particularly advantageous for noisy data or limited customer populations.</p>
</section>
</section>
<section id="pilot-strength-a-decision-centric-approach" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="pilot-strength-a-decision-centric-approach"><span class="header-section-number">13.3</span> Pilot Strength: A Decision-Centric Approach</h2>
<p>Instead of focusing solely on traditional power calculations, let’s explore a slightly different concept: pilot strength. Pilot strength represents the probability of making the correct decision based on a pilot study with specific characteristics and assumptions. For instance, we can examine how sample size influences the strength of a pilot. This decision-centric approach proves particularly valuable when the traditional frequentist framework might fail to reject the null hypothesis, yet a decision must still be made with the available data. To calculate pilot strength, we’ll employ simulations.</p>
<section id="generating-synthetic-data" class="level3">
<h3 class="anchored" data-anchor-id="generating-synthetic-data">Generating Synthetic Data</h3>
<p>Let’s start by generating synthetic data. Similar to the previous example, we’ll consider a binary outcome like customer churn and an intervention that could potentially impact it. In our synthetic data, we’ll assume the new feature increases churn by 2 percentage points. Our goal is to decide whether to roll out this new feature, with the understanding that we should avoid the rollout if the impact on churn exceeds 1 percentage point.</p>
<p>We’ll generate data based on the following assumptions:</p>
<ol type="1">
<li><strong>Equal Treatment Allocation:</strong> A 50% probability of assignment to the treatment group.</li>
<li><strong>Churn Probabilities:</strong> A churn probability of 5% for the control group and 7% for the treatment group.</li>
<li><strong>Time Periods:</strong> Data collection across three time periods, with 20% of observations in period 1, 50% in period 2, and 30% in period 3.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to generate synthetic data</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>generate_synthetic_data <span class="ot">&lt;-</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(seed,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>             num_observations,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>             treatment_proportion,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>             control_churn_prob,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>             treatment_churn_prob,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>             period1_proportion,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>             period2_proportion) {</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">set.seed</span>(seed)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate number of observations in each group and period directly</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        num_treatment <span class="ot">&lt;-</span> <span class="fu">round</span>(num_observations <span class="sc">*</span> treatment_proportion)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        num_control <span class="ot">&lt;-</span> num_observations <span class="sc">-</span> num_treatment</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        num_period1 <span class="ot">&lt;-</span> <span class="fu">round</span>(num_observations <span class="sc">*</span> period1_proportion)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        num_period2 <span class="ot">&lt;-</span> <span class="fu">round</span>(num_observations <span class="sc">*</span> period2_proportion)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        num_period3 <span class="ot">&lt;-</span> num_observations <span class="sc">-</span> num_period1 <span class="sc">-</span> num_period2</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create data frame using explicit group and period assignments</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        synthetic_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span>num_observations,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">treat =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, num_treatment), <span class="fu">rep</span>(<span class="dv">0</span>, num_control)),</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">period =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, num_period1), <span class="fu">rep</span>(<span class="dv">2</span>, num_period2), <span class="fu">rep</span>(<span class="dv">3</span>, num_period3))</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by</span>(treat) <span class="sc">%&gt;%</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="co"># Generate binary outcome based on group-specific probabilities</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>                    treat <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">rbinom</span>(<span class="fu">n</span>(), <span class="dv">1</span>, control_churn_prob),</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>                    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">rbinom</span>(<span class="fu">n</span>(), <span class="dv">1</span>, treatment_churn_prob)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>                )) <span class="sc">%&gt;%</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ungroup</span>() <span class="co"># Important: Always ungroup after group_by</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(synthetic_data)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate synthetic data</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>synthetic_data <span class="ot">&lt;-</span> <span class="fu">generate_synthetic_data</span>(</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_observations =</span> <span class="dv">2000</span>,</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_proportion =</span> <span class="fl">0.5</span>,</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">control_churn_prob =</span> <span class="fl">0.05</span>,</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_churn_prob =</span> <span class="fl">0.07</span>,</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">period1_proportion =</span> <span class="fl">0.2</span>,</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">period2_proportion =</span> <span class="fl">0.5</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(synthetic_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,000
Columns: 4
$ id     &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, …
$ treat  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ period &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ y      &lt;int&gt; 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</code></pre>
</div>
</div>
<p>The <code>glimpse()</code> output provides a summary of the synthetic_data dataframe. It confirms that we have 2000 observations with the variables <code>id</code>, <code>treat</code> (treatment indicator), <code>period</code>, and <code>y</code> (binary outcome representing churn). The true impact of the new feature is a 2 percentage point increase in churn probability. Our objective is to estimate the probability that this impact exceeds 1 percentage point, which would lead us to decide against rolling out the feature.</p>
</section>
<section id="a-simple-stan-model-to-fit-the-data" class="level3">
<h3 class="anchored" data-anchor-id="a-simple-stan-model-to-fit-the-data">A Simple Stan Model to Fit the Data</h3>
<p>We’ll implement a simple Bayesian logistic regression model to analyze these synthetic data. This approach allows us to directly estimate the probability that the treatment effect exceeds our decision threshold.</p>
<div class="cell" data-output.var="logit">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> N;                          <span class="co">// Number of observations</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>, <span class="kw">upper</span> = <span class="dv">1</span>&gt; y[N]; <span class="co">// Outcome (binary 0 or 1)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] treat;      <span class="co">// Treatment indicator</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> mean_alpha;</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> sd_alpha;</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> tau_mean;        <span class="co">// Prior mean for treatment effect</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; tau_sd; <span class="co">// Prior standard deviation for treatment effect</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Flag for running estimation (0: no, 1: yes)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt; run_estimation;</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> alpha;         <span class="co">// Intercept parameter</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> tau;         <span class="co">// treatment effect parameter</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] theta;        <span class="co">// Linear predictor (stores calculated probabilities)</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Priors</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  alpha ~ normal(mean_alpha, sd_alpha);</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  tau ~ normal(tau_mean, tau_sd);</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  theta = alpha + tau * treat;     <span class="co">// Calculate linear predictor</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (run_estimation==<span class="dv">1</span>) {</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Likelihood with logit link function:</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>      y ~ bernoulli_logit(theta); </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="kw">generated quantities</span> {</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] y_sim;</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] y0;</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] y1;</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> eta;</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> mean_y_sim;</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    y_sim[i] = bernoulli_logit_rng(alpha + tau * treat[i]);</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    y0[i] = bernoulli_logit_rng(alpha);</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    y1[i] = bernoulli_logit_rng(alpha + tau);</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  eta = mean(y1) - mean(y0);</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  mean_y_sim = mean(y_sim);</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This model allows us to calculate the probability that the intervention elevates the likelihood of churn by more than our minimum threshold. Let’s create a function to analyze our synthetic data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>analyze_synthetic_data <span class="ot">&lt;-</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(data,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>           mean_alpha,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>           sd_alpha,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>           tau_mean,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>           tau_sd,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>           run_estimation,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>           periods,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>           threshold) {</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(periods)) {</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(period <span class="sc">%in%</span> periods)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare data for Stan</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">N =</span> <span class="fu">nrow</span>(data),</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> data<span class="sc">$</span>y,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">treat =</span> data<span class="sc">$</span>treat,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_alpha =</span> mean_alpha,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_alpha =</span> sd_alpha,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">tau_mean =</span> tau_mean,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">tau_sd =</span> tau_sd,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">run_estimation =</span> run_estimation</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit Stan model</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    posterior <span class="ot">&lt;-</span> <span class="fu">sampling</span>(logit, <span class="co"># Use the loaded stan model</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> stan_data,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>                          <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (run_estimation <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Prior predictive check</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>      prior_draws <span class="ot">&lt;-</span> posterior<span class="sc">::</span><span class="fu">as_draws_df</span>(posterior)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>      prior_eta <span class="ot">&lt;-</span> prior_draws<span class="sc">$</span>eta</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>      prior_tau <span class="ot">&lt;-</span> prior_draws<span class="sc">$</span>tau</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>      prior_mean_y <span class="ot">&lt;-</span> prior_draws<span class="sc">$</span>mean_y_sim</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>      <span class="co"># --- Create plots (using your provided structure) ---</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>      mean_y_plot <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">draws =</span> prior_mean_y),</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> draws)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x =</span> <span class="fu">quantile</span>(prior_mean_y, <span class="at">prob =</span> <span class="fl">0.9</span>),</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> <span class="dv">200</span>, <span class="at">label =</span> <span class="fu">paste0</span>(</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"mean: "</span>,</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">round</span>(<span class="fu">mean</span>(prior_mean_y) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>                          ),</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>                          <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">bar</span>(y))) <span class="sc">+</span>  <span class="co"># Using expression for y bar</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"N draws"</span>) <span class="sc">+</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>      tau_plot <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">draws =</span> prior_tau),</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> draws)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="fu">expression</span>(tau)) <span class="sc">+</span> <span class="co"># Using expression for tau</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"N draws"</span>) <span class="sc">+</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>      eta_plot <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">draws =</span> prior_eta <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> draws)</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x =</span> <span class="fu">quantile</span>(prior_eta <span class="sc">*</span> <span class="dv">100</span>, <span class="at">prob =</span> <span class="fl">0.9</span>),</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> <span class="dv">200</span>, <span class="at">label =</span> <span class="fu">paste0</span>(</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"mean: "</span>,</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">round</span>(<span class="fu">mean</span>(prior_eta) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>                          ),</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>                          <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span>,</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>                            <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>          <span class="st">"text"</span>,</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="fl">2.5</span>,</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="dv">250</span>,</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="st">"True Effect"</span>,</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>          <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="st">"Impact in percentage points"</span>) <span class="sc">+</span></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"N draws"</span>) <span class="sc">+</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>      <span class="co"># --- Combine plots with ggarrange ---</span></span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>      plots <span class="ot">&lt;-</span> ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(eta_plot,</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>                                 ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(tau_plot, mean_y_plot,</span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"tau"</span>, <span class="st">"Outcome"</span>),</span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">ncol =</span> <span class="dv">2</span>),</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">labels =</span> <span class="st">"Impact"</span>, <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>       plots <span class="ot">&lt;-</span> <span class="fu">annotate_figure</span>(plots,</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>                                <span class="at">top =</span> <span class="fu">text_grob</span>(</span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Draws from prior distributions"</span>,</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">size =</span> <span class="dv">14</span></span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>                               ))</span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate probability above threshold</span></span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>      prob_above_threshold <span class="ot">&lt;-</span> <span class="fu">mean</span>(prior_eta <span class="sc">&gt;</span> threshold)</span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Return the combined plot and probability</span></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">plot =</span> plots, <span class="at">prob_above_threshold =</span> prob_above_threshold))</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>      <span class="co"># --- Posterior analysis (remains the same) ---</span></span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>      posterior_draws <span class="ot">&lt;-</span> posterior<span class="sc">::</span><span class="fu">as_draws_df</span>(posterior)</span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>      posterior_eta <span class="ot">&lt;-</span> posterior_draws<span class="sc">$</span>eta</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>      eta_plot <span class="ot">&lt;-</span></span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">draws =</span> posterior_eta <span class="sc">*</span> <span class="dv">100</span>), <span class="fu">aes</span>(<span class="at">x =</span> draws)) <span class="sc">+</span></span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotate</span>(</span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>          <span class="st">"text"</span>,</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="fu">quantile</span>(posterior_eta <span class="sc">*</span> <span class="dv">100</span>, <span class="at">prob =</span> <span class="fl">0.9</span>),</span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="dv">200</span>,</span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"mean: "</span>, <span class="fu">round</span>(<span class="fu">mean</span>(posterior_eta) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)),</span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>          <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span>,</span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>                   <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotate</span>(</span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>          <span class="st">"text"</span>,</span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="fl">2.5</span>,</span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="dv">250</span>,</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="st">"True Effect"</span>,</span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>          <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Impact (percentage points)"</span>, <span class="at">y =</span> <span class="st">"N draws"</span>) <span class="sc">+</span></span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>()</span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>      prob_above_threshold <span class="ot">&lt;-</span> <span class="fu">mean</span>(posterior_eta <span class="sc">&gt;</span> threshold)</span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">plot =</span> eta_plot, <span class="at">prob_above_threshold =</span> prob_above_threshold))</span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prior-predictive-checks" class="level3">
<h3 class="anchored" data-anchor-id="prior-predictive-checks">Prior Predictive Checks</h3>
<p>In Bayesian modeling, it’s crucial to check if our prior distributions are reasonable. We use prior predictive checks to simulate data from our prior distributions and visually assess if these simulated datasets are plausible in the context of our problem. If the prior predictive distributions generate implausible data, it might indicate that our priors are misspecified.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">analyze_synthetic_data</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> synthetic_data,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_alpha =</span> <span class="sc">-</span><span class="dv">6</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau_mean =</span> <span class="dv">2</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau_sd =</span> <span class="dv">2</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">run_estimation =</span> <span class="dv">0</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">periods =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="fl">0.01</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the plot</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>prior<span class="sc">$</span>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="strength_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plots above show that our prior distributions for the outcome (churn) and the impact of the intervention are reasonable. In particular our prior before seeing the outcome data is that the probability that the intervention has a meaningful impact is 55%.</p>
</section>
<section id="sequential-bayesian-updating-with-incoming-data" class="level3">
<h3 class="anchored" data-anchor-id="sequential-bayesian-updating-with-incoming-data">Sequential Bayesian Updating with Incoming Data</h3>
<p>Let’s see how our model updates its beliefs as new data becomes available across different time periods.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>period_1 <span class="ot">&lt;-</span> <span class="fu">analyze_synthetic_data</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> synthetic_data,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_alpha =</span> <span class="sc">-</span><span class="dv">6</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau_mean =</span> <span class="dv">2</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau_sd =</span> <span class="dv">2</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">run_estimation =</span> <span class="dv">1</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">periods =</span> <span class="fu">c</span>(<span class="dv">1</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="fl">0.01</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the plot</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>period_1<span class="sc">$</span>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="strength_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Given the data available in period 1, we believe that the probability that the intervention has a meaningful impact is 99.7%. This is with just 400 observations. Now we can see what happens as we see more data in period 2.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="strength_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now, given the data available in period 2, we believe that the probability that the intervention has a meaningful impact is 75.3%. Notice that new 1000 observations from period 2 move the posterior quite a bit. Finally, let’s see how the data from period 3 updates the posterior.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="strength_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Once we have collected all the data from this pilot, Given the data available in period 3, we believe that the probability that the intervention has a meaningful impact is 91.8%.</p>
<p>One important thing to notice is that at any moment, including before collecting any data, we could have made a decision. Then, as we collected more data our belief changed.</p>
</section>
<section id="calculating-the-strength-of-a-pilot" class="level3">
<h3 class="anchored" data-anchor-id="calculating-the-strength-of-a-pilot">Calculating the Strength of a Pilot</h3>
<p>To calculate the strength of a pilot, we can run a simulation like the one above many times and see how often we would make the right decision. Moreover, we can do this under different assumptions.</p>
<p>For all our simulations, we will use the following decision rule: if the posterior probability that the impact exceeds 1 percentage point is greater than 75%, we kill the new feature; otherwise, we launch it. For the first set of simulations, we will assume that the true impact is an increase in churn of 2 percentage points; therefore, killing the new feature is the right choice. We will also run these simulations assuming our pilot will have 2000 observations, half in treatment and half in control.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>run_simulations <span class="ot">&lt;-</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(N,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>           num_observations,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>           treatment_proportion,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>           control_churn_prob,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>           treatment_churn_prob,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>           period1_proportion,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>           period2_proportion,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>           mean_alpha,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>           sd_alpha,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>           tau_mean,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>           tau_sd,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>           periods,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>           threshold,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">num_cores =</span> <span class="dv">1</span>) {</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Function to run a single simulation</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    run_single_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(i) {</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Generate synthetic data with a unique seed</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      synthetic_data <span class="ot">&lt;-</span> <span class="fu">generate_synthetic_data</span>(</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">seed =</span> i,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use simulation number as seed</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">num_observations =</span> num_observations,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment_proportion =</span> treatment_proportion,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">control_churn_prob =</span> control_churn_prob,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment_churn_prob =</span> treatment_churn_prob,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">period1_proportion =</span> period1_proportion,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">period2_proportion =</span> period2_proportion</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Analyze the synthetic data</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>      analysis_result <span class="ot">&lt;-</span> <span class="fu">analyze_synthetic_data</span>(</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> synthetic_data,</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_alpha =</span> mean_alpha,</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd_alpha =</span> sd_alpha,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">tau_mean =</span> tau_mean,</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">tau_sd =</span> tau_sd,</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">run_estimation =</span> <span class="dv">1</span>,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Run estimation</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">periods =</span> periods,</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">threshold =</span> threshold</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(analysis_result<span class="sc">$</span>prob_above_threshold)</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run simulations using purrr (parallel or sequential)</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    probabilities <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N <span class="sc">%&gt;%</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (num_cores <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Use future_map for parallel execution</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>          future<span class="sc">::</span><span class="fu">plan</span>(future<span class="sc">::</span>multicore, <span class="at">workers =</span> num_cores) <span class="co"># Setup parallel processing</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>          <span class="fu">future_map</span>(., run_single_sim)</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Use map for sequential execution</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>          <span class="fu">map</span>(., run_single_sim)</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(probabilities)</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s run the simulations with 2000 observations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>simulations <span class="ot">&lt;-</span> <span class="fu">run_simulations</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="dv">200</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_observations =</span> <span class="dv">2000</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_proportion =</span> <span class="fl">0.5</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">control_churn_prob =</span> <span class="fl">0.05</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_churn_prob =</span> <span class="fl">0.07</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">period1_proportion =</span> <span class="fl">0.2</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">period2_proportion =</span> <span class="fl">0.5</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_alpha =</span> <span class="sc">-</span><span class="dv">6</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau_mean =</span> <span class="dv">2</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau_sd =</span> <span class="dv">2</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">periods =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_cores =</span> <span class="dv">4</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The simulation results tell us that, with our chosen priors, model, pilot size, and decision rule, we correctly kill the new feature (when it truly has a meaningful impact) in approximately 74% of the simulated pilot studies.</p>
<p>Next we can run this simulation under the assumption that instead of 2000 observations we will only have 1000 observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>simulations <span class="ot">&lt;-</span> <span class="fu">run_simulations</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="dv">200</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_observations =</span> <span class="dv">1000</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_proportion =</span> <span class="fl">0.5</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">control_churn_prob =</span> <span class="fl">0.05</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_churn_prob =</span> <span class="fl">0.07</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">period1_proportion =</span> <span class="fl">0.2</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">period2_proportion =</span> <span class="fl">0.5</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_alpha =</span> <span class="sc">-</span><span class="dv">6</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau_mean =</span> <span class="dv">2</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau_sd =</span> <span class="dv">2</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">periods =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_cores =</span> <span class="dv">4</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can see that if the pilot only has 1000 observations, we would make the right decision only 68% of the time.</p>
<p>Similarly, we can now change our data generating process so that the true effect of the intervention is zero. In the right decision would be to roll out the new feature.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>simulations <span class="ot">&lt;-</span> <span class="fu">run_simulations</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="dv">200</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_observations =</span> <span class="dv">1000</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_proportion =</span> <span class="fl">0.5</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">control_churn_prob =</span> <span class="fl">0.05</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_churn_prob =</span> <span class="fl">0.05</span>, <span class="co"># &lt;-same as control_churn_prob</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">period1_proportion =</span> <span class="fl">0.2</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">period2_proportion =</span> <span class="fl">0.5</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_alpha =</span> <span class="sc">-</span><span class="dv">6</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau_mean =</span> <span class="dv">2</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau_sd =</span> <span class="dv">2</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">periods =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_cores =</span> <span class="dv">4</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this case, the probability of making the right choice (rolling out the new feature when it has no meaningful impact on churn) is 84%.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learn more
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p><span class="citation" data-cites="dong2013powerup">Dong and Maynard (<a href="references.html#ref-dong2013powerup" role="doc-biblioref">2013</a>)</span> PowerUp!: A tool for calculating minimum detectable effect sizes and minimum required sample sizes for experimental and quasi-experimental design studies.</p></li>
<li><p><span class="citation" data-cites="bloom2008core">Bloom (<a href="references.html#ref-bloom2008core" role="doc-biblioref">2008</a>)</span> The core analytics of randomized experiments for social research.</p></li>
<li><p><span class="citation" data-cites="gelman2014beyond">Gelman and Carlin (<a href="references.html#ref-gelman2014beyond" role="doc-biblioref">2014</a>)</span> Beyond power calculations: Assessing type S (sign) and type M (magnitude) errors.</p></li>
<li><p><span class="citation" data-cites="mcdonnell2018test">McDonnell Feit and Berman (<a href="references.html#ref-mcdonnell2018test" role="doc-biblioref">2018</a>)</span> Test &amp; Roll: Profit-Maximizing A/B Tests.<br>
</p></li>
</ul>
</div>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-bloom2008core" class="csl-entry" role="listitem">
Bloom, Howard S. 2008. <span>“The Core Analytics of Randomized Experiments for Social Research.”</span> <em>The SAGE Handbook of Social Research Methods</em>, 115–33. <a href="https://files.eric.ed.gov/fulltext/ED493363.pdf">https://files.eric.ed.gov/fulltext/ED493363.pdf</a>.
</div>
<div id="ref-dong2013powerup" class="csl-entry" role="listitem">
Dong, Nianbo, and Rebecca Maynard. 2013. <span>“PowerUp!: A Tool for Calculating Minimum Detectable Effect Sizes and Minimum Required Sample Sizes for Experimental and Quasi-Experimental Design Studies.”</span> <em>Journal of Research on Educational Effectiveness</em> 6 (1): 24–67. <a href="https://www.ipr.northwestern.edu/documents/required-reading/2018/dong--maynard-2013.pdf">https://www.ipr.northwestern.edu/documents/required-reading/2018/dong--maynard-2013.pdf</a>.
</div>
<div id="ref-gelman2014beyond" class="csl-entry" role="listitem">
Gelman, Andrew, and John Carlin. 2014. <span>“Beyond Power Calculations: Assessing Type s (Sign) and Type m (Magnitude) Errors.”</span> <em>Perspectives on Psychological Science</em> 9 (6): 641–51. <a href="https://journals.sagepub.com/doi/pdf/10.1177/1745691614551642?trk=public_post_comment-text">https://journals.sagepub.com/doi/pdf/10.1177/1745691614551642?trk=public_post_comment-text</a>.
</div>
<div id="ref-mcdonnell2018test" class="csl-entry" role="listitem">
McDonnell Feit, Elea, and Ron Berman. 2018. <span>“Test &amp; Roll: Profit-Maximizing a/b Tests.”</span> <em>arXiv e-Prints</em>, arXiv–1811. <a href="https://ui.adsabs.harvard.edu/abs/2018arXiv181100457M/abstract">https://ui.adsabs.harvard.edu/abs/2018arXiv181100457M/abstract</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/book\.martinez\.fyi");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<script src="https://utteranc.es/client.js" repo="ignacio82/book" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./coordination.html" class="pagination-link" aria-label="The Importance of Coordination">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">The Importance of Coordination</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./other_methods.html" class="pagination-link" aria-label="Non Experimental Methods">
        <span class="nav-page-text">Non Experimental Methods</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb13" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Study Design"</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="an">share:</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">  permalink: "https://book.martinez.fyi/strenght.html"</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">  description: "Pilot Strength: Designing Decision-Centric Business Experiments"</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">  linkedin: true</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">  email: true</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">  mastodon: true</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>As we discussed before, the most important thing when designing a study is to</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>start with the decision you are trying to inform, and craft the right business</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>questions that can be answered with data to inform that decision. Then, if you</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>are going to run an experiment to answer those questions you will have to think</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>about important details such as how big of an experiment should I run, what</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>should be the unit of randomization, what proportion should be assigned to each</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>arm, etc. To answer these questions most people use power calculations.</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="fu">## Power Calculations in Experimental Design</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>In the context of experimental design, power is the probability of detecting an</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>effect if it truly exists. In other words, it's the likelihood of rejecting the</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>null hypothesis when it is false. Power is intrinsically linked to Type II error</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>(false negative), which is the probability of failing to reject the null</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>hypothesis when it is actually false. Power is calculated as $1 - \beta$, where</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>$\beta$ represents the probability of a Type II error.</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>Power analysis involves determining the minimum sample size needed to detect an</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>effect of a given size or determining the effect size that can be detected with</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>a given sample size. A key concept in power analysis is the Minimum Detectable</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>Effect (MDE), which is the smallest effect size that the study is designed to</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>detect with a specified level of statistical power. Power can be conceptualized</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>as a function of the signal-to-noise ratio in an experiment. The "signal" refers</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>to the effect size, while the "noise" represents the variability within the</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>data. A stronger signal and lower noise lead to higher power.</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>Traditional power analysis focuses on Type I and Type II errors. However, Gelman</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>and Carlin (2014) argue that these are insufficient to fully capture the risks</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>of null hypothesis significance testing (NHST). They propose considering Type S</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>(sign) and Type M (magnitude) errors:</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Type S error:** The probability that a statistically significant result</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>    has the opposite sign of the true effect. This can lead to incorrect</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    conclusions about the direction of an effect.</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Type M error:** The factor by which a statistically significant effect</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>    might be overestimated. This can lead to exaggerated claims about the size</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>    of an effect.</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>These errors are particularly relevant in studies with small samples and noisy</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>data, where statistically significant results may be misleading. Gelman and</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>Carlin recommend design analysis, which involves calculating Type S and Type M</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>errors to assess the potential for these errors in a study design.</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a><span class="fu">### Methods for Performing Power Calculations</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>There are different methods for performing power calculations:</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Analytical methods:** These methods use formulas to calculate power or</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>    sample size based on the factors mentioned above. For example, the formula</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>    for calculating the sample size needed for a two-sample t-test can be found</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>    in many statistical textbooks .</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Simulation methods:** These methods involve generating random data and</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>    performing statistical tests repeatedly to estimate power. They are</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>    particularly useful for complex study designs where analytical formulas may</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>    not be available or accurate.</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a><span class="fu">### A Simple Example with the Analytical Method</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>Suppose we are thinking about running an experiment and our outcome of interest</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>is binary and only 5% of the outcomes take the value 1. For example, this could</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>be an experiment for reducing churn. Imagine we are testing a new intervention</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>aimed at reducing customer churn, and we want to understand how large of an</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>experiment we need to reliably detect a reduction in the churn rate if the</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>intervention is effective. Our baseline churn rate is 5%, meaning that without</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>any intervention, approximately 5% of customers churn.</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>We want to use an analytical method to perform a power calculation.</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>Specifically, we want to investigate how the Minimum Detectable Effect (MDE)</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>changes as we increase the sample size of our experiment. The MDE, in this</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>context, represents the smallest reduction in the churn rate that our experiment</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>is designed to detect with a given level of statistical power.</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>The R code below uses the <span class="in">`calculateMdes`</span> function to compute the MDE for</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>different sample sizes (N), assuming we are conducting a two-sample t-test to</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>compare the churn rates between a treatment and a control group. We set the</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>significance level (<span class="in">`sig_lvl`</span>) to 0.05 and the desired power (<span class="in">`power`</span>) to 0.80.</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>This means we want to design our experiment such that if there is a true effect</span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>(reduction in churn), we have an 80% chance of detecting it as statistically</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>significant at the 5% significance level. The proportion assigned to treatment</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>(and control) p is set to 0.5, assuming equal allocation. The outcome is</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>specified as "binary", and <span class="in">`mean_y`</span> is set to 0.05, representing our baseline</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>churn rate.</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>The code then iterates through a range of sample sizes, from 500 to 2000, and</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>calculates the MDE for each sample size. Finally, it generates a plot showing</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>the relationship between the sample size (N) and the MDE.</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>calculateMdes <span class="ot">&lt;-</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(<span class="at">sig_lvl =</span> <span class="fl">0.05</span>,</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>           <span class="at">power =</span> <span class="fl">0.80</span>,</span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>           N,</span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>           <span class="at">g =</span> <span class="dv">1</span>,</span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>           <span class="at">p =</span> <span class="fl">0.5</span>,</span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>           <span class="at">outcome =</span> <span class="fu">c</span>(<span class="st">"binary"</span>, <span class="st">"continuous"</span>),</span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>           <span class="at">mean_y =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>           <span class="at">sigma_y =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>           <span class="at">R_sq_xy =</span> <span class="dv">0</span>,</span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>           <span class="at">rho =</span> <span class="dv">0</span>,</span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>           <span class="at">R_sq_WG =</span> <span class="dv">0</span>,</span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a>           <span class="at">R_sq_BG =</span> <span class="dv">0</span>) {</span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Input Validation (Moved up for earlier checks)</span></span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>    outcome <span class="ot">&lt;-</span></span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a>      <span class="fu">match.arg</span>(outcome)  <span class="co"># Ensure a valid outcome is selected</span></span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (outcome <span class="sc">==</span> <span class="st">"continuous"</span> <span class="sc">&amp;</span> <span class="fu">is.null</span>(sigma_y)) {</span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"When outcome is continuous, you must specify sigma_y"</span>)</span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (outcome <span class="sc">==</span> <span class="st">"binary"</span> <span class="sc">&amp;</span> <span class="fu">is.null</span>(mean_y)) {</span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"When outcome is binary, you must specify mean_y"</span>)</span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate Degrees of Freedom</span></span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(g <span class="sc">==</span> <span class="dv">1</span>, N <span class="sc">-</span> <span class="dv">2</span>, g <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate Factor for t-distribution</span></span>
<span id="cb13-132"><a href="#cb13-132" aria-hidden="true" tabindex="-1"></a>    factor <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="at">p =</span> <span class="dv">1</span> <span class="sc">-</span> sig_lvl <span class="sc">/</span> <span class="dv">2</span>, <span class="at">df =</span> df) <span class="sc">+</span> <span class="fu">qt</span>(<span class="at">p =</span> power, <span class="at">df =</span> df)</span>
<span id="cb13-133"><a href="#cb13-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-134"><a href="#cb13-134" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate sigma_lambdaRA_hat</span></span>
<span id="cb13-135"><a href="#cb13-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (g <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb13-136"><a href="#cb13-136" aria-hidden="true" tabindex="-1"></a>      sigma_lambdaRA_hat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="dv">1</span> <span class="sc">-</span> R_sq_xy) <span class="sc">/</span> (N <span class="sc">*</span> p <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p)))</span>
<span id="cb13-137"><a href="#cb13-137" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb13-138"><a href="#cb13-138" aria-hidden="true" tabindex="-1"></a>      cluster_size <span class="ot">&lt;-</span> N <span class="sc">/</span> g</span>
<span id="cb13-139"><a href="#cb13-139" aria-hidden="true" tabindex="-1"></a>      A <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (p <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p))</span>
<span id="cb13-140"><a href="#cb13-140" aria-hidden="true" tabindex="-1"></a>      B <span class="ot">&lt;-</span> ((<span class="dv">1</span> <span class="sc">-</span> rho) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> R_sq_WG)) <span class="sc">/</span> (g <span class="sc">*</span> cluster_size)</span>
<span id="cb13-141"><a href="#cb13-141" aria-hidden="true" tabindex="-1"></a>      C <span class="ot">&lt;-</span> (rho <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> R_sq_BG)) <span class="sc">/</span> g</span>
<span id="cb13-142"><a href="#cb13-142" aria-hidden="true" tabindex="-1"></a>      sigma_lambdaRA_hat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(A <span class="sc">*</span> (B <span class="sc">+</span> C))</span>
<span id="cb13-143"><a href="#cb13-143" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-144"><a href="#cb13-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-145"><a href="#cb13-145" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate sigma_y for binary outcome</span></span>
<span id="cb13-146"><a href="#cb13-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (outcome <span class="sc">==</span> <span class="st">"binary"</span>) {</span>
<span id="cb13-147"><a href="#cb13-147" aria-hidden="true" tabindex="-1"></a>      sigma_y <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mean_y <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> mean_y))</span>
<span id="cb13-148"><a href="#cb13-148" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-149"><a href="#cb13-149" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-150"><a href="#cb13-150" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate MDE and MDES</span></span>
<span id="cb13-151"><a href="#cb13-151" aria-hidden="true" tabindex="-1"></a>    MDE <span class="ot">&lt;-</span> factor <span class="sc">*</span> sigma_lambdaRA_hat <span class="sc">*</span> sigma_y</span>
<span id="cb13-152"><a href="#cb13-152" aria-hidden="true" tabindex="-1"></a>    MDES <span class="ot">&lt;-</span> MDE <span class="sc">/</span> sigma_y</span>
<span id="cb13-153"><a href="#cb13-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-154"><a href="#cb13-154" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="at">MDES =</span> MDES, <span class="at">MDE =</span> MDE))</span>
<span id="cb13-155"><a href="#cb13-155" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-156"><a href="#cb13-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-157"><a href="#cb13-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector of N values to explore (adjust as needed)</span></span>
<span id="cb13-158"><a href="#cb13-158" aria-hidden="true" tabindex="-1"></a>n_values <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">500</span>, <span class="dv">2000</span>, <span class="at">by =</span> <span class="dv">100</span>)</span>
<span id="cb13-159"><a href="#cb13-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-160"><a href="#cb13-160" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with MDE values for different N</span></span>
<span id="cb13-161"><a href="#cb13-161" aria-hidden="true" tabindex="-1"></a>mde_data <span class="ot">&lt;-</span> <span class="fu">map_df</span>(n_values, <span class="sc">~</span><span class="fu">calculateMdes</span>(<span class="at">N =</span> .x,</span>
<span id="cb13-162"><a href="#cb13-162" aria-hidden="true" tabindex="-1"></a> <span class="at">sig_lvl =</span> <span class="fl">0.05</span>,</span>
<span id="cb13-163"><a href="#cb13-163" aria-hidden="true" tabindex="-1"></a> <span class="at">power =</span> <span class="fl">0.80</span>,</span>
<span id="cb13-164"><a href="#cb13-164" aria-hidden="true" tabindex="-1"></a> <span class="at">p =</span> <span class="fl">0.5</span>,</span>
<span id="cb13-165"><a href="#cb13-165" aria-hidden="true" tabindex="-1"></a> <span class="at">outcome =</span> <span class="st">"binary"</span>,</span>
<span id="cb13-166"><a href="#cb13-166" aria-hidden="true" tabindex="-1"></a> <span class="at">mean_y =</span> <span class="fl">0.05</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-167"><a href="#cb13-167" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">N =</span> n_values)</span>
<span id="cb13-168"><a href="#cb13-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-169"><a href="#cb13-169" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb13-170"><a href="#cb13-170" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mde_data, <span class="fu">aes</span>(<span class="at">x =</span> N, <span class="at">y =</span> MDE)) <span class="sc">+</span></span>
<span id="cb13-171"><a href="#cb13-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb13-172"><a href="#cb13-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb13-173"><a href="#cb13-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-174"><a href="#cb13-174" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Minimum Detectable Effect (MDE) vs. Sample Size (N)"</span>,</span>
<span id="cb13-175"><a href="#cb13-175" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Sample Size (N)"</span>,</span>
<span id="cb13-176"><a href="#cb13-176" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Minimum Detectable Effect (MDE)"</span></span>
<span id="cb13-177"><a href="#cb13-177" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-178"><a href="#cb13-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb13-179"><a href="#cb13-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-180"><a href="#cb13-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-181"><a href="#cb13-181" aria-hidden="true" tabindex="-1"></a>For instance, let's consider a point on the plot. If with a sample size of 1000,</span>
<span id="cb13-182"><a href="#cb13-182" aria-hidden="true" tabindex="-1"></a>the MDE is approximately</span>
<span id="cb13-183"><a href="#cb13-183" aria-hidden="true" tabindex="-1"></a><span class="in">`r round(calculateMdes(N = 1000, sig_lvl = 0.05, power = 0.80, p = 0.5, outcome = "binary", mean_y = 0.05)[[2]], 2)`</span>.</span>
<span id="cb13-184"><a href="#cb13-184" aria-hidden="true" tabindex="-1"></a>This means that with a total sample size of 1000 (500 in the treatment group</span>
<span id="cb13-185"><a href="#cb13-185" aria-hidden="true" tabindex="-1"></a>and 500 in the control group), we would be able to detect a reduction in the</span>
<span id="cb13-186"><a href="#cb13-186" aria-hidden="true" tabindex="-1"></a>churn rate of</span>
<span id="cb13-187"><a href="#cb13-187" aria-hidden="true" tabindex="-1"></a><span class="in">`r round(calculateMdes(N = 1000, sig_lvl = 0.05, power = 0.80, p = 0.5, outcome = "binary", mean_y = 0.05)[[2]], 2)*100`</span></span>
<span id="cb13-188"><a href="#cb13-188" aria-hidden="true" tabindex="-1"></a>percentage points. If the true reduction in churn rate due to our intervention</span>
<span id="cb13-189"><a href="#cb13-189" aria-hidden="true" tabindex="-1"></a>is smaller, our experiment might not be powerful enough to detect it as</span>
<span id="cb13-190"><a href="#cb13-190" aria-hidden="true" tabindex="-1"></a>statistically significant, and we might fail to reject the null hypothesis of no</span>
<span id="cb13-191"><a href="#cb13-191" aria-hidden="true" tabindex="-1"></a>effect (even if a real, albeit smaller, effect exists).</span>
<span id="cb13-192"><a href="#cb13-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-193"><a href="#cb13-193" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb13-194"><a href="#cb13-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-195"><a href="#cb13-195" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interpreting MDEs</span></span>
<span id="cb13-196"><a href="#cb13-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-197"><a href="#cb13-197" aria-hidden="true" tabindex="-1"></a>The MDE curve helps you determine the tradeoff between sample size and</span>
<span id="cb13-198"><a href="#cb13-198" aria-hidden="true" tabindex="-1"></a>detectable effect size. Larger sample sizes allow you to detect smaller effects,</span>
<span id="cb13-199"><a href="#cb13-199" aria-hidden="true" tabindex="-1"></a>but at diminishing returns. When planning your study, consider both the smallest</span>
<span id="cb13-200"><a href="#cb13-200" aria-hidden="true" tabindex="-1"></a>effect size that would be practically meaningful for your business decision and</span>
<span id="cb13-201"><a href="#cb13-201" aria-hidden="true" tabindex="-1"></a>the resources required for different sample sizes.</span>
<span id="cb13-202"><a href="#cb13-202" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb13-203"><a href="#cb13-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-204"><a href="#cb13-204" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simulations for Type S and M Errors</span></span>
<span id="cb13-205"><a href="#cb13-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-206"><a href="#cb13-206" aria-hidden="true" tabindex="-1"></a>To illustrate Type S (Sign) and M (Magnitude) errors in a practical context,</span>
<span id="cb13-207"><a href="#cb13-207" aria-hidden="true" tabindex="-1"></a>let's consider a simulation based on a common A/B testing scenario. Imagine a</span>
<span id="cb13-208"><a href="#cb13-208" aria-hidden="true" tabindex="-1"></a>company has a baseline customer churn rate of 5% and aims to detect an impact</span>
<span id="cb13-209"><a href="#cb13-209" aria-hidden="true" tabindex="-1"></a>of 2 percentage points through some intervention.</span>
<span id="cb13-210"><a href="#cb13-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-211"><a href="#cb13-211" aria-hidden="true" tabindex="-1"></a>The simulation below assesses how frequently a study with a moderate sample size</span>
<span id="cb13-212"><a href="#cb13-212" aria-hidden="true" tabindex="-1"></a>(n=500 per group) might incorrectly estimate the direction or exaggerate the</span>
<span id="cb13-213"><a href="#cb13-213" aria-hidden="true" tabindex="-1"></a>magnitude of the observed effect:</span>
<span id="cb13-214"><a href="#cb13-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-215"><a href="#cb13-215" aria-hidden="true" tabindex="-1"></a>Now lets run some simulations to estimate type S and M errors. The code bellow</span>
<span id="cb13-216"><a href="#cb13-216" aria-hidden="true" tabindex="-1"></a>runs 10,000 simulations with 500 obervations in the treatment and 500 in the</span>
<span id="cb13-217"><a href="#cb13-217" aria-hidden="true" tabindex="-1"></a>control group, 5% probability of churn for the control group, and and impact</span>
<span id="cb13-218"><a href="#cb13-218" aria-hidden="true" tabindex="-1"></a>of 2 percentage points for treated units.</span>
<span id="cb13-219"><a href="#cb13-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-222"><a href="#cb13-222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-223"><a href="#cb13-223" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-224"><a href="#cb13-224" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb13-225"><a href="#cb13-225" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb13-226"><a href="#cb13-226" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb13-227"><a href="#cb13-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-228"><a href="#cb13-228" aria-hidden="true" tabindex="-1"></a>estimateTypeSM <span class="ot">&lt;-</span> <span class="cf">function</span>(p_true_control, lift, n_per_group, alpha, n_sim) {</span>
<span id="cb13-229"><a href="#cb13-229" aria-hidden="true" tabindex="-1"></a>  p_true_variant <span class="ot">&lt;-</span> p_true_control <span class="sc">+</span> lift</span>
<span id="cb13-230"><a href="#cb13-230" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-231"><a href="#cb13-231" aria-hidden="true" tabindex="-1"></a>  simulations <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb13-232"><a href="#cb13-232" aria-hidden="true" tabindex="-1"></a>    <span class="at">control_successes =</span> <span class="fu">rbinom</span>(n_sim, n_per_group, p_true_control),</span>
<span id="cb13-233"><a href="#cb13-233" aria-hidden="true" tabindex="-1"></a>    <span class="at">variant_successes =</span> <span class="fu">rbinom</span>(n_sim, n_per_group, p_true_variant)</span>
<span id="cb13-234"><a href="#cb13-234" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-235"><a href="#cb13-235" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-236"><a href="#cb13-236" aria-hidden="true" tabindex="-1"></a>  prop_tests <span class="ot">&lt;-</span> <span class="fu">map2_df</span>(simulations<span class="sc">$</span>control_successes, simulations<span class="sc">$</span>variant_successes, </span>
<span id="cb13-237"><a href="#cb13-237" aria-hidden="true" tabindex="-1"></a>                        <span class="sc">~</span> <span class="fu">tidy</span>(<span class="fu">prop.test</span>(<span class="fu">c</span>(.x, .y), </span>
<span id="cb13-238"><a href="#cb13-238" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">n =</span> <span class="fu">c</span>(n_per_group, n_per_group),</span>
<span id="cb13-239"><a href="#cb13-239" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">correct =</span> <span class="cn">FALSE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb13-240"><a href="#cb13-240" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">diff =</span> estimate2 <span class="sc">-</span> estimate1)</span>
<span id="cb13-241"><a href="#cb13-241" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-242"><a href="#cb13-242" aria-hidden="true" tabindex="-1"></a>  significant_results <span class="ot">&lt;-</span> prop_tests <span class="sc">%&gt;%</span></span>
<span id="cb13-243"><a href="#cb13-243" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(p.value <span class="sc">&lt;</span> alpha)</span>
<span id="cb13-244"><a href="#cb13-244" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-245"><a href="#cb13-245" aria-hidden="true" tabindex="-1"></a>  significant_count <span class="ot">&lt;-</span> <span class="fu">nrow</span>(significant_results)</span>
<span id="cb13-246"><a href="#cb13-246" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-247"><a href="#cb13-247" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(significant_count <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb13-248"><a href="#cb13-248" aria-hidden="true" tabindex="-1"></a>    type_s_rate <span class="ot">&lt;-</span> <span class="fu">mean</span>(significant_results<span class="sc">$</span>diff <span class="sc">*</span> lift <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb13-249"><a href="#cb13-249" aria-hidden="true" tabindex="-1"></a>    exaggeration <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(significant_results<span class="sc">$</span>diff) <span class="sc">/</span> <span class="fu">abs</span>(lift))</span>
<span id="cb13-250"><a href="#cb13-250" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb13-251"><a href="#cb13-251" aria-hidden="true" tabindex="-1"></a>    type_s_rate <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-252"><a href="#cb13-252" aria-hidden="true" tabindex="-1"></a>    exaggeration <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb13-253"><a href="#cb13-253" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-254"><a href="#cb13-254" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-255"><a href="#cb13-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb13-256"><a href="#cb13-256" aria-hidden="true" tabindex="-1"></a>    <span class="at">significant_count =</span> significant_count,</span>
<span id="cb13-257"><a href="#cb13-257" aria-hidden="true" tabindex="-1"></a>    <span class="at">type_s_rate =</span> type_s_rate,</span>
<span id="cb13-258"><a href="#cb13-258" aria-hidden="true" tabindex="-1"></a>    <span class="at">exaggeration =</span> exaggeration</span>
<span id="cb13-259"><a href="#cb13-259" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-260"><a href="#cb13-260" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-261"><a href="#cb13-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-262"><a href="#cb13-262" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">estimateTypeSM</span>(<span class="at">p_true_control =</span> <span class="fl">0.05</span>, <span class="at">lift =</span> <span class="fl">0.02</span>, <span class="at">n_per_group =</span> <span class="dv">500</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>, <span class="at">n_sim =</span> <span class="dv">10000</span>)</span>
<span id="cb13-263"><a href="#cb13-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-264"><a href="#cb13-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-265"><a href="#cb13-265" aria-hidden="true" tabindex="-1"></a>Out of the 10,000 simulations, only <span class="in">`r results$significant_count`</span> yielded a</span>
<span id="cb13-266"><a href="#cb13-266" aria-hidden="true" tabindex="-1"></a>statistically significant result. Among these statistically significant results,</span>
<span id="cb13-267"><a href="#cb13-267" aria-hidden="true" tabindex="-1"></a><span class="in">`r round(results$type_s_rate, 2)`</span>% incorrectly estimated the direction of the</span>
<span id="cb13-268"><a href="#cb13-268" aria-hidden="true" tabindex="-1"></a>effect (Type S error). The average exaggeration of the effect size (Type M</span>
<span id="cb13-269"><a href="#cb13-269" aria-hidden="true" tabindex="-1"></a>error) among the significant results was <span class="in">`r round(results$exaggeration, 2)`</span>x.</span>
<span id="cb13-270"><a href="#cb13-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-271"><a href="#cb13-271" aria-hidden="true" tabindex="-1"></a><span class="fu">## Profit-Maximizing A/B Testing: A Test &amp; Roll Approach</span></span>
<span id="cb13-272"><a href="#cb13-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-273"><a href="#cb13-273" aria-hidden="true" tabindex="-1"></a>Traditional power calculations in A/B testing focus on managing statistical</span>
<span id="cb13-274"><a href="#cb13-274" aria-hidden="true" tabindex="-1"></a>significance by controlling Type I and Type II errors. However, in practical</span>
<span id="cb13-275"><a href="#cb13-275" aria-hidden="true" tabindex="-1"></a>business experiments, the primary goal isn't merely to "reject the null</span>
<span id="cb13-276"><a href="#cb13-276" aria-hidden="true" tabindex="-1"></a>hypothesis" but to maximize overall profit. The test &amp; roll framework,</span>
<span id="cb13-277"><a href="#cb13-277" aria-hidden="true" tabindex="-1"></a>introduced by @mcdonnell2018test, re-frames sample size determination as a</span>
<span id="cb13-278"><a href="#cb13-278" aria-hidden="true" tabindex="-1"></a>strategic decision balancing the cost of learning against the opportunity cost</span>
<span id="cb13-279"><a href="#cb13-279" aria-hidden="true" tabindex="-1"></a>of deploying a suboptimal treatment.</span>
<span id="cb13-280"><a href="#cb13-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-281"><a href="#cb13-281" aria-hidden="true" tabindex="-1"></a><span class="fu">### Balancing Learning and Opportunity Cost</span></span>
<span id="cb13-282"><a href="#cb13-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-283"><a href="#cb13-283" aria-hidden="true" tabindex="-1"></a>In conventional A/B tests, achieving high statistical power often requires large</span>
<span id="cb13-284"><a href="#cb13-284" aria-hidden="true" tabindex="-1"></a>test groups, inadvertently exposing more customers to potentially inferior</span>
<span id="cb13-285"><a href="#cb13-285" aria-hidden="true" tabindex="-1"></a>treatments. The test &amp; roll framework explicitly addresses two crucial</span>
<span id="cb13-286"><a href="#cb13-286" aria-hidden="true" tabindex="-1"></a>considerations:</span>
<span id="cb13-287"><a href="#cb13-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-288"><a href="#cb13-288" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**The cost of testing:** Every unit allocated to the test phase may</span>
<span id="cb13-289"><a href="#cb13-289" aria-hidden="true" tabindex="-1"></a>    experience a less-than-optimal treatment.</span>
<span id="cb13-290"><a href="#cb13-290" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**The benefit of deployment:** Once the better treatment is identified, it</span>
<span id="cb13-291"><a href="#cb13-291" aria-hidden="true" tabindex="-1"></a>    can be applied to the remainder of the population to maximize profit.</span>
<span id="cb13-292"><a href="#cb13-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-293"><a href="#cb13-293" aria-hidden="true" tabindex="-1"></a>By quantifying these trade-offs explicitly, the optimal (profit-maximizing) test</span>
<span id="cb13-294"><a href="#cb13-294" aria-hidden="true" tabindex="-1"></a>size is typically smaller than traditional hypothesis testing methods recommend,</span>
<span id="cb13-295"><a href="#cb13-295" aria-hidden="true" tabindex="-1"></a>particularly when data responses are noisy or population size is limited.</span>
<span id="cb13-296"><a href="#cb13-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-297"><a href="#cb13-297" aria-hidden="true" tabindex="-1"></a><span class="fu">### A Closed-Form Insight</span></span>
<span id="cb13-298"><a href="#cb13-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-299"><a href="#cb13-299" aria-hidden="true" tabindex="-1"></a>@mcdonnell2018test derived a closed-form formula for determining optimal test</span>
<span id="cb13-300"><a href="#cb13-300" aria-hidden="true" tabindex="-1"></a>sizes under symmetric Normal priors (assuming no initial preference between</span>
<span id="cb13-301"><a href="#cb13-301" aria-hidden="true" tabindex="-1"></a>treatments). Formally, the optimal sample size grows as follows:</span>
<span id="cb13-302"><a href="#cb13-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-303"><a href="#cb13-303" aria-hidden="true" tabindex="-1"></a>$$ n^* \propto \sqrt{N} \quad \text{and} \quad n^* \sim \mathcal{O}\left(\frac{s}{\sigma}\right) $$</span>
<span id="cb13-304"><a href="#cb13-304" aria-hidden="true" tabindex="-1"></a>This implies:</span>
<span id="cb13-305"><a href="#cb13-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-306"><a href="#cb13-306" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Optimal test size ($n^*$) scales with the square root of the total available</span>
<span id="cb13-307"><a href="#cb13-307" aria-hidden="true" tabindex="-1"></a>    population ($N$).</span>
<span id="cb13-308"><a href="#cb13-308" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>The optimal test size is sensitive to the response noise ($s$) and the</span>
<span id="cb13-309"><a href="#cb13-309" aria-hidden="true" tabindex="-1"></a>    uncertainty in treatment effects ($\sigma$).</span>
<span id="cb13-310"><a href="#cb13-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-311"><a href="#cb13-311" aria-hidden="true" tabindex="-1"></a>More specifically, proposition A.2 in their paper derives:</span>
<span id="cb13-312"><a href="#cb13-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-313"><a href="#cb13-313" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb13-314"><a href="#cb13-314" aria-hidden="true" tabindex="-1"></a>n^{*}=n_{1}^{*}=n_{2}^{*}=\sqrt{\frac{N}{4}\left(\frac{s}{\sigma}\right)^{2}+\left(\frac{3}{4}\left(\frac{s}{\sigma}\right)^{2}\right)^{2}}-\frac{3}{4}\left(\frac{s}{\sigma}\right)^{2}</span>
<span id="cb13-315"><a href="#cb13-315" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb13-316"><a href="#cb13-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-317"><a href="#cb13-317" aria-hidden="true" tabindex="-1"></a>This contrasts with traditional power calculations, which typically recommend</span>
<span id="cb13-318"><a href="#cb13-318" aria-hidden="true" tabindex="-1"></a>sample sizes scaling linearly or super-linearly with variance, often resulting</span>
<span id="cb13-319"><a href="#cb13-319" aria-hidden="true" tabindex="-1"></a>in overly large tests.</span>
<span id="cb13-320"><a href="#cb13-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-321"><a href="#cb13-321" aria-hidden="true" tabindex="-1"></a><span class="fu">### Extensions to Asymmetric and Complex Settings</span></span>
<span id="cb13-322"><a href="#cb13-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-323"><a href="#cb13-323" aria-hidden="true" tabindex="-1"></a>The basic test &amp; roll framework can also be extended to account for situations</span>
<span id="cb13-324"><a href="#cb13-324" aria-hidden="true" tabindex="-1"></a>where prior beliefs about the treatments differ. For instance:</span>
<span id="cb13-325"><a href="#cb13-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-326"><a href="#cb13-326" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Incumbent/Challenger Tests:** If one treatment is well understood (the</span>
<span id="cb13-327"><a href="#cb13-327" aria-hidden="true" tabindex="-1"></a>    incumbent) and the other is more uncertain (the challenger), asymmetric</span>
<span id="cb13-328"><a href="#cb13-328" aria-hidden="true" tabindex="-1"></a>    priors can be used to justify allocating a larger sample to the less-known</span>
<span id="cb13-329"><a href="#cb13-329" aria-hidden="true" tabindex="-1"></a>    treatment.</span>
<span id="cb13-330"><a href="#cb13-330" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Pricing Experiments:** When treatments involve different price points, the</span>
<span id="cb13-331"><a href="#cb13-331" aria-hidden="true" tabindex="-1"></a>    trade-offs include not only response variability but also differences in</span>
<span id="cb13-332"><a href="#cb13-332" aria-hidden="true" tabindex="-1"></a>    profit per sale. The framework naturally extends to these settings by</span>
<span id="cb13-333"><a href="#cb13-333" aria-hidden="true" tabindex="-1"></a>    adjusting priors to reflect both the likelihood of purchase and the profit</span>
<span id="cb13-334"><a href="#cb13-334" aria-hidden="true" tabindex="-1"></a>    margin.</span>
<span id="cb13-335"><a href="#cb13-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-336"><a href="#cb13-336" aria-hidden="true" tabindex="-1"></a><span class="fu">### Operational Advantages</span></span>
<span id="cb13-337"><a href="#cb13-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-338"><a href="#cb13-338" aria-hidden="true" tabindex="-1"></a>In practice, the test &amp; roll design helps managers make timely decisions:</span>
<span id="cb13-339"><a href="#cb13-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-340"><a href="#cb13-340" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Smaller, Agile Tests:** By running smaller tests, firms expose fewer</span>
<span id="cb13-341"><a href="#cb13-341" aria-hidden="true" tabindex="-1"></a>    customers to a potentially inferior treatment.</span>
<span id="cb13-342"><a href="#cb13-342" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Transparency:** The decision rule is based on explicit profit</span>
<span id="cb13-343"><a href="#cb13-343" aria-hidden="true" tabindex="-1"></a>    calculations, making it easier to justify the chosen test size and strategy.</span>
<span id="cb13-344"><a href="#cb13-344" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Comparable Performance:** Despite its simplicity, the test &amp; roll approach</span>
<span id="cb13-345"><a href="#cb13-345" aria-hidden="true" tabindex="-1"></a>    has been shown to achieve regret—and thus overall performance—that is</span>
<span id="cb13-346"><a href="#cb13-346" aria-hidden="true" tabindex="-1"></a>    comparable to more complex, continuously adaptive methods like Thompson</span>
<span id="cb13-347"><a href="#cb13-347" aria-hidden="true" tabindex="-1"></a>    sampling.</span>
<span id="cb13-348"><a href="#cb13-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-349"><a href="#cb13-349" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summary</span></span>
<span id="cb13-350"><a href="#cb13-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-351"><a href="#cb13-351" aria-hidden="true" tabindex="-1"></a>By centering experimentation on maximizing business impact rather than solely</span>
<span id="cb13-352"><a href="#cb13-352" aria-hidden="true" tabindex="-1"></a>achieving statistical significance, the test &amp; roll framework presents a robust,</span>
<span id="cb13-353"><a href="#cb13-353" aria-hidden="true" tabindex="-1"></a>economically efficient alternative to traditional power-based approaches. It</span>
<span id="cb13-354"><a href="#cb13-354" aria-hidden="true" tabindex="-1"></a>optimally manages the trade-offs between learning and earning, particularly</span>
<span id="cb13-355"><a href="#cb13-355" aria-hidden="true" tabindex="-1"></a>advantageous for noisy data or limited customer populations.</span>
<span id="cb13-356"><a href="#cb13-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-357"><a href="#cb13-357" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pilot Strength: A Decision-Centric Approach</span></span>
<span id="cb13-358"><a href="#cb13-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-359"><a href="#cb13-359" aria-hidden="true" tabindex="-1"></a>Instead of focusing solely on traditional power calculations, let's explore a</span>
<span id="cb13-360"><a href="#cb13-360" aria-hidden="true" tabindex="-1"></a>slightly different concept: pilot strength. Pilot strength represents the</span>
<span id="cb13-361"><a href="#cb13-361" aria-hidden="true" tabindex="-1"></a>probability of making the correct decision based on a pilot study with specific</span>
<span id="cb13-362"><a href="#cb13-362" aria-hidden="true" tabindex="-1"></a>characteristics and assumptions. For instance, we can examine how sample size</span>
<span id="cb13-363"><a href="#cb13-363" aria-hidden="true" tabindex="-1"></a>influences the strength of a pilot. This decision-centric approach proves</span>
<span id="cb13-364"><a href="#cb13-364" aria-hidden="true" tabindex="-1"></a>particularly valuable when the traditional frequentist framework might fail to</span>
<span id="cb13-365"><a href="#cb13-365" aria-hidden="true" tabindex="-1"></a>reject the null hypothesis, yet a decision must still be made with the available</span>
<span id="cb13-366"><a href="#cb13-366" aria-hidden="true" tabindex="-1"></a>data. To calculate pilot strength, we'll employ simulations.</span>
<span id="cb13-367"><a href="#cb13-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-368"><a href="#cb13-368" aria-hidden="true" tabindex="-1"></a><span class="fu">### Generating Synthetic Data</span></span>
<span id="cb13-369"><a href="#cb13-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-370"><a href="#cb13-370" aria-hidden="true" tabindex="-1"></a>Let's start by generating synthetic data. Similar to the previous example, we'll</span>
<span id="cb13-371"><a href="#cb13-371" aria-hidden="true" tabindex="-1"></a>consider a binary outcome like customer churn and an intervention that could</span>
<span id="cb13-372"><a href="#cb13-372" aria-hidden="true" tabindex="-1"></a>potentially impact it. In our synthetic data, we'll assume the new feature</span>
<span id="cb13-373"><a href="#cb13-373" aria-hidden="true" tabindex="-1"></a>increases churn by 2 percentage points. Our goal is to decide whether to roll</span>
<span id="cb13-374"><a href="#cb13-374" aria-hidden="true" tabindex="-1"></a>out this new feature, with the understanding that we should avoid the rollout if</span>
<span id="cb13-375"><a href="#cb13-375" aria-hidden="true" tabindex="-1"></a>the impact on churn exceeds 1 percentage point.</span>
<span id="cb13-376"><a href="#cb13-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-377"><a href="#cb13-377" aria-hidden="true" tabindex="-1"></a>We'll generate data based on the following assumptions:</span>
<span id="cb13-378"><a href="#cb13-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-379"><a href="#cb13-379" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Equal Treatment Allocation:** A 50% probability of assignment to the</span>
<span id="cb13-380"><a href="#cb13-380" aria-hidden="true" tabindex="-1"></a>    treatment group.</span>
<span id="cb13-381"><a href="#cb13-381" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Churn Probabilities:** A churn probability of 5% for the control group</span>
<span id="cb13-382"><a href="#cb13-382" aria-hidden="true" tabindex="-1"></a>    and 7% for the treatment group.</span>
<span id="cb13-383"><a href="#cb13-383" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Time Periods:** Data collection across three time periods, with 20% of</span>
<span id="cb13-384"><a href="#cb13-384" aria-hidden="true" tabindex="-1"></a>    observations in period 1, 50% in period 2, and 30% in period 3.</span>
<span id="cb13-385"><a href="#cb13-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-388"><a href="#cb13-388" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-389"><a href="#cb13-389" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-390"><a href="#cb13-390" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb13-391"><a href="#cb13-391" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb13-392"><a href="#cb13-392" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb13-393"><a href="#cb13-393" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb13-394"><a href="#cb13-394" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb13-395"><a href="#cb13-395" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr)</span>
<span id="cb13-396"><a href="#cb13-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-397"><a href="#cb13-397" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to generate synthetic data</span></span>
<span id="cb13-398"><a href="#cb13-398" aria-hidden="true" tabindex="-1"></a>generate_synthetic_data <span class="ot">&lt;-</span></span>
<span id="cb13-399"><a href="#cb13-399" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(seed,</span>
<span id="cb13-400"><a href="#cb13-400" aria-hidden="true" tabindex="-1"></a>             num_observations,</span>
<span id="cb13-401"><a href="#cb13-401" aria-hidden="true" tabindex="-1"></a>             treatment_proportion,</span>
<span id="cb13-402"><a href="#cb13-402" aria-hidden="true" tabindex="-1"></a>             control_churn_prob,</span>
<span id="cb13-403"><a href="#cb13-403" aria-hidden="true" tabindex="-1"></a>             treatment_churn_prob,</span>
<span id="cb13-404"><a href="#cb13-404" aria-hidden="true" tabindex="-1"></a>             period1_proportion,</span>
<span id="cb13-405"><a href="#cb13-405" aria-hidden="true" tabindex="-1"></a>             period2_proportion) {</span>
<span id="cb13-406"><a href="#cb13-406" aria-hidden="true" tabindex="-1"></a>        <span class="fu">set.seed</span>(seed)</span>
<span id="cb13-407"><a href="#cb13-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-408"><a href="#cb13-408" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate number of observations in each group and period directly</span></span>
<span id="cb13-409"><a href="#cb13-409" aria-hidden="true" tabindex="-1"></a>        num_treatment <span class="ot">&lt;-</span> <span class="fu">round</span>(num_observations <span class="sc">*</span> treatment_proportion)</span>
<span id="cb13-410"><a href="#cb13-410" aria-hidden="true" tabindex="-1"></a>        num_control <span class="ot">&lt;-</span> num_observations <span class="sc">-</span> num_treatment</span>
<span id="cb13-411"><a href="#cb13-411" aria-hidden="true" tabindex="-1"></a>        num_period1 <span class="ot">&lt;-</span> <span class="fu">round</span>(num_observations <span class="sc">*</span> period1_proportion)</span>
<span id="cb13-412"><a href="#cb13-412" aria-hidden="true" tabindex="-1"></a>        num_period2 <span class="ot">&lt;-</span> <span class="fu">round</span>(num_observations <span class="sc">*</span> period2_proportion)</span>
<span id="cb13-413"><a href="#cb13-413" aria-hidden="true" tabindex="-1"></a>        num_period3 <span class="ot">&lt;-</span> num_observations <span class="sc">-</span> num_period1 <span class="sc">-</span> num_period2</span>
<span id="cb13-414"><a href="#cb13-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-415"><a href="#cb13-415" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create data frame using explicit group and period assignments</span></span>
<span id="cb13-416"><a href="#cb13-416" aria-hidden="true" tabindex="-1"></a>        synthetic_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb13-417"><a href="#cb13-417" aria-hidden="true" tabindex="-1"></a>            <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span>num_observations,</span>
<span id="cb13-418"><a href="#cb13-418" aria-hidden="true" tabindex="-1"></a>            <span class="at">treat =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, num_treatment), <span class="fu">rep</span>(<span class="dv">0</span>, num_control)),</span>
<span id="cb13-419"><a href="#cb13-419" aria-hidden="true" tabindex="-1"></a>            <span class="at">period =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, num_period1), <span class="fu">rep</span>(<span class="dv">2</span>, num_period2), <span class="fu">rep</span>(<span class="dv">3</span>, num_period3))</span>
<span id="cb13-420"><a href="#cb13-420" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb13-421"><a href="#cb13-421" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by</span>(treat) <span class="sc">%&gt;%</span></span>
<span id="cb13-422"><a href="#cb13-422" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="co"># Generate binary outcome based on group-specific probabilities</span></span>
<span id="cb13-423"><a href="#cb13-423" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-424"><a href="#cb13-424" aria-hidden="true" tabindex="-1"></a>                    treat <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">rbinom</span>(<span class="fu">n</span>(), <span class="dv">1</span>, control_churn_prob),</span>
<span id="cb13-425"><a href="#cb13-425" aria-hidden="true" tabindex="-1"></a>                    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">rbinom</span>(<span class="fu">n</span>(), <span class="dv">1</span>, treatment_churn_prob)</span>
<span id="cb13-426"><a href="#cb13-426" aria-hidden="true" tabindex="-1"></a>                )) <span class="sc">%&gt;%</span></span>
<span id="cb13-427"><a href="#cb13-427" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ungroup</span>() <span class="co"># Important: Always ungroup after group_by</span></span>
<span id="cb13-428"><a href="#cb13-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-429"><a href="#cb13-429" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(synthetic_data)</span>
<span id="cb13-430"><a href="#cb13-430" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-431"><a href="#cb13-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-432"><a href="#cb13-432" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate synthetic data</span></span>
<span id="cb13-433"><a href="#cb13-433" aria-hidden="true" tabindex="-1"></a>synthetic_data <span class="ot">&lt;-</span> <span class="fu">generate_synthetic_data</span>(</span>
<span id="cb13-434"><a href="#cb13-434" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb13-435"><a href="#cb13-435" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_observations =</span> <span class="dv">2000</span>,</span>
<span id="cb13-436"><a href="#cb13-436" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_proportion =</span> <span class="fl">0.5</span>,</span>
<span id="cb13-437"><a href="#cb13-437" aria-hidden="true" tabindex="-1"></a>    <span class="at">control_churn_prob =</span> <span class="fl">0.05</span>,</span>
<span id="cb13-438"><a href="#cb13-438" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_churn_prob =</span> <span class="fl">0.07</span>,</span>
<span id="cb13-439"><a href="#cb13-439" aria-hidden="true" tabindex="-1"></a>    <span class="at">period1_proportion =</span> <span class="fl">0.2</span>,</span>
<span id="cb13-440"><a href="#cb13-440" aria-hidden="true" tabindex="-1"></a>    <span class="at">period2_proportion =</span> <span class="fl">0.5</span></span>
<span id="cb13-441"><a href="#cb13-441" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-442"><a href="#cb13-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-443"><a href="#cb13-443" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(synthetic_data)</span>
<span id="cb13-444"><a href="#cb13-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-445"><a href="#cb13-445" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-446"><a href="#cb13-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-447"><a href="#cb13-447" aria-hidden="true" tabindex="-1"></a>The <span class="in">`glimpse()`</span> output provides a summary of the synthetic<span class="sc">\_</span>data dataframe. It</span>
<span id="cb13-448"><a href="#cb13-448" aria-hidden="true" tabindex="-1"></a>confirms that we have 2000 observations with the variables <span class="in">`id`</span>, <span class="in">`treat`</span></span>
<span id="cb13-449"><a href="#cb13-449" aria-hidden="true" tabindex="-1"></a>(treatment indicator), <span class="in">`period`</span>, and <span class="in">`y`</span> (binary outcome representing churn).</span>
<span id="cb13-450"><a href="#cb13-450" aria-hidden="true" tabindex="-1"></a>The true impact of the new feature is a 2 percentage point increase in churn</span>
<span id="cb13-451"><a href="#cb13-451" aria-hidden="true" tabindex="-1"></a>probability. Our objective is to estimate the probability that this impact</span>
<span id="cb13-452"><a href="#cb13-452" aria-hidden="true" tabindex="-1"></a>exceeds 1 percentage point, which would lead us to decide against rolling out</span>
<span id="cb13-453"><a href="#cb13-453" aria-hidden="true" tabindex="-1"></a>the feature.</span>
<span id="cb13-454"><a href="#cb13-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-455"><a href="#cb13-455" aria-hidden="true" tabindex="-1"></a><span class="fu">### A Simple Stan Model to Fit the Data</span></span>
<span id="cb13-456"><a href="#cb13-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-457"><a href="#cb13-457" aria-hidden="true" tabindex="-1"></a>We'll implement a simple Bayesian logistic regression model to analyze these</span>
<span id="cb13-458"><a href="#cb13-458" aria-hidden="true" tabindex="-1"></a>synthetic data. This approach allows us to directly estimate the probability</span>
<span id="cb13-459"><a href="#cb13-459" aria-hidden="true" tabindex="-1"></a>that the treatment effect exceeds our decision threshold.</span>
<span id="cb13-460"><a href="#cb13-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-461"><a href="#cb13-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{stan output.var = "logit"}</span></span>
<span id="cb13-462"><a href="#cb13-462" aria-hidden="true" tabindex="-1"></a><span class="in">data {</span></span>
<span id="cb13-463"><a href="#cb13-463" aria-hidden="true" tabindex="-1"></a><span class="in">  int N;                          // Number of observations</span></span>
<span id="cb13-464"><a href="#cb13-464" aria-hidden="true" tabindex="-1"></a><span class="in">  int&lt;lower = 0, upper = 1&gt; y[N]; // Outcome (binary 0 or 1)</span></span>
<span id="cb13-465"><a href="#cb13-465" aria-hidden="true" tabindex="-1"></a><span class="in">  vector[N] treat;      // Treatment indicator</span></span>
<span id="cb13-466"><a href="#cb13-466" aria-hidden="true" tabindex="-1"></a><span class="in">  real mean_alpha;</span></span>
<span id="cb13-467"><a href="#cb13-467" aria-hidden="true" tabindex="-1"></a><span class="in">  real sd_alpha;</span></span>
<span id="cb13-468"><a href="#cb13-468" aria-hidden="true" tabindex="-1"></a><span class="in">  real tau_mean;        // Prior mean for treatment effect</span></span>
<span id="cb13-469"><a href="#cb13-469" aria-hidden="true" tabindex="-1"></a><span class="in">  real&lt;lower=0&gt; tau_sd; // Prior standard deviation for treatment effect</span></span>
<span id="cb13-470"><a href="#cb13-470" aria-hidden="true" tabindex="-1"></a><span class="in">  // Flag for running estimation (0: no, 1: yes)</span></span>
<span id="cb13-471"><a href="#cb13-471" aria-hidden="true" tabindex="-1"></a><span class="in">  int&lt;lower=0, upper=1&gt; run_estimation;</span></span>
<span id="cb13-472"><a href="#cb13-472" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb13-473"><a href="#cb13-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-474"><a href="#cb13-474" aria-hidden="true" tabindex="-1"></a><span class="in">parameters {</span></span>
<span id="cb13-475"><a href="#cb13-475" aria-hidden="true" tabindex="-1"></a><span class="in">  real alpha;         // Intercept parameter</span></span>
<span id="cb13-476"><a href="#cb13-476" aria-hidden="true" tabindex="-1"></a><span class="in">  real tau;         // treatment effect parameter</span></span>
<span id="cb13-477"><a href="#cb13-477" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb13-478"><a href="#cb13-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-479"><a href="#cb13-479" aria-hidden="true" tabindex="-1"></a><span class="in">model {</span></span>
<span id="cb13-480"><a href="#cb13-480" aria-hidden="true" tabindex="-1"></a><span class="in">  vector[N] theta;        // Linear predictor (stores calculated probabilities)</span></span>
<span id="cb13-481"><a href="#cb13-481" aria-hidden="true" tabindex="-1"></a><span class="in">  // Priors</span></span>
<span id="cb13-482"><a href="#cb13-482" aria-hidden="true" tabindex="-1"></a><span class="in">  alpha ~ normal(mean_alpha, sd_alpha);</span></span>
<span id="cb13-483"><a href="#cb13-483" aria-hidden="true" tabindex="-1"></a><span class="in">  tau ~ normal(tau_mean, tau_sd);</span></span>
<span id="cb13-484"><a href="#cb13-484" aria-hidden="true" tabindex="-1"></a><span class="in">  theta = alpha + tau * treat;     // Calculate linear predictor</span></span>
<span id="cb13-485"><a href="#cb13-485" aria-hidden="true" tabindex="-1"></a><span class="in">  if (run_estimation==1) {</span></span>
<span id="cb13-486"><a href="#cb13-486" aria-hidden="true" tabindex="-1"></a><span class="in">  // Likelihood with logit link function:</span></span>
<span id="cb13-487"><a href="#cb13-487" aria-hidden="true" tabindex="-1"></a><span class="in">      y ~ bernoulli_logit(theta); </span></span>
<span id="cb13-488"><a href="#cb13-488" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb13-489"><a href="#cb13-489" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb13-490"><a href="#cb13-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-491"><a href="#cb13-491" aria-hidden="true" tabindex="-1"></a><span class="in">generated quantities {</span></span>
<span id="cb13-492"><a href="#cb13-492" aria-hidden="true" tabindex="-1"></a><span class="in">  vector[N] y_sim;</span></span>
<span id="cb13-493"><a href="#cb13-493" aria-hidden="true" tabindex="-1"></a><span class="in">  vector[N] y0;</span></span>
<span id="cb13-494"><a href="#cb13-494" aria-hidden="true" tabindex="-1"></a><span class="in">  vector[N] y1;</span></span>
<span id="cb13-495"><a href="#cb13-495" aria-hidden="true" tabindex="-1"></a><span class="in">  real eta;</span></span>
<span id="cb13-496"><a href="#cb13-496" aria-hidden="true" tabindex="-1"></a><span class="in">  real mean_y_sim;</span></span>
<span id="cb13-497"><a href="#cb13-497" aria-hidden="true" tabindex="-1"></a><span class="in">  for (i in 1:N) {</span></span>
<span id="cb13-498"><a href="#cb13-498" aria-hidden="true" tabindex="-1"></a><span class="in">    y_sim[i] = bernoulli_logit_rng(alpha + tau * treat[i]);</span></span>
<span id="cb13-499"><a href="#cb13-499" aria-hidden="true" tabindex="-1"></a><span class="in">    y0[i] = bernoulli_logit_rng(alpha);</span></span>
<span id="cb13-500"><a href="#cb13-500" aria-hidden="true" tabindex="-1"></a><span class="in">    y1[i] = bernoulli_logit_rng(alpha + tau);</span></span>
<span id="cb13-501"><a href="#cb13-501" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb13-502"><a href="#cb13-502" aria-hidden="true" tabindex="-1"></a><span class="in">  eta = mean(y1) - mean(y0);</span></span>
<span id="cb13-503"><a href="#cb13-503" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_y_sim = mean(y_sim);</span></span>
<span id="cb13-504"><a href="#cb13-504" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb13-505"><a href="#cb13-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-506"><a href="#cb13-506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-507"><a href="#cb13-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-508"><a href="#cb13-508" aria-hidden="true" tabindex="-1"></a>This model allows us to calculate the probability that the intervention elevates</span>
<span id="cb13-509"><a href="#cb13-509" aria-hidden="true" tabindex="-1"></a>the likelihood of churn by more than our minimum threshold. Let's create a</span>
<span id="cb13-510"><a href="#cb13-510" aria-hidden="true" tabindex="-1"></a>function to analyze our synthetic data:</span>
<span id="cb13-511"><a href="#cb13-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-514"><a href="#cb13-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-515"><a href="#cb13-515" aria-hidden="true" tabindex="-1"></a>analyze_synthetic_data <span class="ot">&lt;-</span></span>
<span id="cb13-516"><a href="#cb13-516" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(data,</span>
<span id="cb13-517"><a href="#cb13-517" aria-hidden="true" tabindex="-1"></a>           mean_alpha,</span>
<span id="cb13-518"><a href="#cb13-518" aria-hidden="true" tabindex="-1"></a>           sd_alpha,</span>
<span id="cb13-519"><a href="#cb13-519" aria-hidden="true" tabindex="-1"></a>           tau_mean,</span>
<span id="cb13-520"><a href="#cb13-520" aria-hidden="true" tabindex="-1"></a>           tau_sd,</span>
<span id="cb13-521"><a href="#cb13-521" aria-hidden="true" tabindex="-1"></a>           run_estimation,</span>
<span id="cb13-522"><a href="#cb13-522" aria-hidden="true" tabindex="-1"></a>           periods,</span>
<span id="cb13-523"><a href="#cb13-523" aria-hidden="true" tabindex="-1"></a>           threshold) {</span>
<span id="cb13-524"><a href="#cb13-524" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data</span></span>
<span id="cb13-525"><a href="#cb13-525" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(periods)) {</span>
<span id="cb13-526"><a href="#cb13-526" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(period <span class="sc">%in%</span> periods)</span>
<span id="cb13-527"><a href="#cb13-527" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-528"><a href="#cb13-528" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-529"><a href="#cb13-529" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare data for Stan</span></span>
<span id="cb13-530"><a href="#cb13-530" aria-hidden="true" tabindex="-1"></a>    stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb13-531"><a href="#cb13-531" aria-hidden="true" tabindex="-1"></a>      <span class="at">N =</span> <span class="fu">nrow</span>(data),</span>
<span id="cb13-532"><a href="#cb13-532" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> data<span class="sc">$</span>y,</span>
<span id="cb13-533"><a href="#cb13-533" aria-hidden="true" tabindex="-1"></a>      <span class="at">treat =</span> data<span class="sc">$</span>treat,</span>
<span id="cb13-534"><a href="#cb13-534" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_alpha =</span> mean_alpha,</span>
<span id="cb13-535"><a href="#cb13-535" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_alpha =</span> sd_alpha,</span>
<span id="cb13-536"><a href="#cb13-536" aria-hidden="true" tabindex="-1"></a>      <span class="at">tau_mean =</span> tau_mean,</span>
<span id="cb13-537"><a href="#cb13-537" aria-hidden="true" tabindex="-1"></a>      <span class="at">tau_sd =</span> tau_sd,</span>
<span id="cb13-538"><a href="#cb13-538" aria-hidden="true" tabindex="-1"></a>      <span class="at">run_estimation =</span> run_estimation</span>
<span id="cb13-539"><a href="#cb13-539" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-540"><a href="#cb13-540" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-541"><a href="#cb13-541" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit Stan model</span></span>
<span id="cb13-542"><a href="#cb13-542" aria-hidden="true" tabindex="-1"></a>    posterior <span class="ot">&lt;-</span> <span class="fu">sampling</span>(logit, <span class="co"># Use the loaded stan model</span></span>
<span id="cb13-543"><a href="#cb13-543" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> stan_data,</span>
<span id="cb13-544"><a href="#cb13-544" aria-hidden="true" tabindex="-1"></a>                          <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb13-545"><a href="#cb13-545" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-546"><a href="#cb13-546" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (run_estimation <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb13-547"><a href="#cb13-547" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Prior predictive check</span></span>
<span id="cb13-548"><a href="#cb13-548" aria-hidden="true" tabindex="-1"></a>      prior_draws <span class="ot">&lt;-</span> posterior<span class="sc">::</span><span class="fu">as_draws_df</span>(posterior)</span>
<span id="cb13-549"><a href="#cb13-549" aria-hidden="true" tabindex="-1"></a>      prior_eta <span class="ot">&lt;-</span> prior_draws<span class="sc">$</span>eta</span>
<span id="cb13-550"><a href="#cb13-550" aria-hidden="true" tabindex="-1"></a>      prior_tau <span class="ot">&lt;-</span> prior_draws<span class="sc">$</span>tau</span>
<span id="cb13-551"><a href="#cb13-551" aria-hidden="true" tabindex="-1"></a>      prior_mean_y <span class="ot">&lt;-</span> prior_draws<span class="sc">$</span>mean_y_sim</span>
<span id="cb13-552"><a href="#cb13-552" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb13-553"><a href="#cb13-553" aria-hidden="true" tabindex="-1"></a>      <span class="co"># --- Create plots (using your provided structure) ---</span></span>
<span id="cb13-554"><a href="#cb13-554" aria-hidden="true" tabindex="-1"></a>      mean_y_plot <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb13-555"><a href="#cb13-555" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">draws =</span> prior_mean_y),</span>
<span id="cb13-556"><a href="#cb13-556" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> draws)</span>
<span id="cb13-557"><a href="#cb13-557" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb13-558"><a href="#cb13-558" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb13-559"><a href="#cb13-559" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb13-560"><a href="#cb13-560" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb13-561"><a href="#cb13-561" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x =</span> <span class="fu">quantile</span>(prior_mean_y, <span class="at">prob =</span> <span class="fl">0.9</span>),</span>
<span id="cb13-562"><a href="#cb13-562" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> <span class="dv">200</span>, <span class="at">label =</span> <span class="fu">paste0</span>(</span>
<span id="cb13-563"><a href="#cb13-563" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"mean: "</span>,</span>
<span id="cb13-564"><a href="#cb13-564" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">round</span>(<span class="fu">mean</span>(prior_mean_y) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb13-565"><a href="#cb13-565" aria-hidden="true" tabindex="-1"></a>                          ),</span>
<span id="cb13-566"><a href="#cb13-566" aria-hidden="true" tabindex="-1"></a>                          <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb13-567"><a href="#cb13-567" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb13-568"><a href="#cb13-568" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">bar</span>(y))) <span class="sc">+</span>  <span class="co"># Using expression for y bar</span></span>
<span id="cb13-569"><a href="#cb13-569" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"N draws"</span>) <span class="sc">+</span></span>
<span id="cb13-570"><a href="#cb13-570" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="cb13-571"><a href="#cb13-571" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb13-572"><a href="#cb13-572" aria-hidden="true" tabindex="-1"></a>      tau_plot <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb13-573"><a href="#cb13-573" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">draws =</span> prior_tau),</span>
<span id="cb13-574"><a href="#cb13-574" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> draws)</span>
<span id="cb13-575"><a href="#cb13-575" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb13-576"><a href="#cb13-576" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb13-577"><a href="#cb13-577" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="fu">expression</span>(tau)) <span class="sc">+</span> <span class="co"># Using expression for tau</span></span>
<span id="cb13-578"><a href="#cb13-578" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"N draws"</span>) <span class="sc">+</span></span>
<span id="cb13-579"><a href="#cb13-579" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="cb13-580"><a href="#cb13-580" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb13-581"><a href="#cb13-581" aria-hidden="true" tabindex="-1"></a>      eta_plot <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb13-582"><a href="#cb13-582" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">draws =</span> prior_eta <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb13-583"><a href="#cb13-583" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> draws)</span>
<span id="cb13-584"><a href="#cb13-584" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb13-585"><a href="#cb13-585" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb13-586"><a href="#cb13-586" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb13-587"><a href="#cb13-587" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x =</span> <span class="fu">quantile</span>(prior_eta <span class="sc">*</span> <span class="dv">100</span>, <span class="at">prob =</span> <span class="fl">0.9</span>),</span>
<span id="cb13-588"><a href="#cb13-588" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> <span class="dv">200</span>, <span class="at">label =</span> <span class="fu">paste0</span>(</span>
<span id="cb13-589"><a href="#cb13-589" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"mean: "</span>,</span>
<span id="cb13-590"><a href="#cb13-590" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">round</span>(<span class="fu">mean</span>(prior_eta) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb13-591"><a href="#cb13-591" aria-hidden="true" tabindex="-1"></a>                          ),</span>
<span id="cb13-592"><a href="#cb13-592" aria-hidden="true" tabindex="-1"></a>                          <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb13-593"><a href="#cb13-593" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb13-594"><a href="#cb13-594" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span>,</span>
<span id="cb13-595"><a href="#cb13-595" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb13-596"><a href="#cb13-596" aria-hidden="true" tabindex="-1"></a>                            <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-597"><a href="#cb13-597" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb13-598"><a href="#cb13-598" aria-hidden="true" tabindex="-1"></a>          <span class="st">"text"</span>,</span>
<span id="cb13-599"><a href="#cb13-599" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="fl">2.5</span>,</span>
<span id="cb13-600"><a href="#cb13-600" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="dv">250</span>,</span>
<span id="cb13-601"><a href="#cb13-601" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="st">"True Effect"</span>,</span>
<span id="cb13-602"><a href="#cb13-602" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb13-603"><a href="#cb13-603" aria-hidden="true" tabindex="-1"></a>          <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb13-604"><a href="#cb13-604" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb13-605"><a href="#cb13-605" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="st">"Impact in percentage points"</span>) <span class="sc">+</span></span>
<span id="cb13-606"><a href="#cb13-606" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"N draws"</span>) <span class="sc">+</span></span>
<span id="cb13-607"><a href="#cb13-607" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="cb13-608"><a href="#cb13-608" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb13-609"><a href="#cb13-609" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb13-610"><a href="#cb13-610" aria-hidden="true" tabindex="-1"></a>      <span class="co"># --- Combine plots with ggarrange ---</span></span>
<span id="cb13-611"><a href="#cb13-611" aria-hidden="true" tabindex="-1"></a>      plots <span class="ot">&lt;-</span> ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(eta_plot,</span>
<span id="cb13-612"><a href="#cb13-612" aria-hidden="true" tabindex="-1"></a>                                 ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(tau_plot, mean_y_plot,</span>
<span id="cb13-613"><a href="#cb13-613" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"tau"</span>, <span class="st">"Outcome"</span>),</span>
<span id="cb13-614"><a href="#cb13-614" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">ncol =</span> <span class="dv">2</span>),</span>
<span id="cb13-615"><a href="#cb13-615" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">labels =</span> <span class="st">"Impact"</span>, <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb13-616"><a href="#cb13-616" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb13-617"><a href="#cb13-617" aria-hidden="true" tabindex="-1"></a>       plots <span class="ot">&lt;-</span> <span class="fu">annotate_figure</span>(plots,</span>
<span id="cb13-618"><a href="#cb13-618" aria-hidden="true" tabindex="-1"></a>                                <span class="at">top =</span> <span class="fu">text_grob</span>(</span>
<span id="cb13-619"><a href="#cb13-619" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Draws from prior distributions"</span>,</span>
<span id="cb13-620"><a href="#cb13-620" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb13-621"><a href="#cb13-621" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">size =</span> <span class="dv">14</span></span>
<span id="cb13-622"><a href="#cb13-622" aria-hidden="true" tabindex="-1"></a>                               ))</span>
<span id="cb13-623"><a href="#cb13-623" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb13-624"><a href="#cb13-624" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate probability above threshold</span></span>
<span id="cb13-625"><a href="#cb13-625" aria-hidden="true" tabindex="-1"></a>      prob_above_threshold <span class="ot">&lt;-</span> <span class="fu">mean</span>(prior_eta <span class="sc">&gt;</span> threshold)</span>
<span id="cb13-626"><a href="#cb13-626" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb13-627"><a href="#cb13-627" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Return the combined plot and probability</span></span>
<span id="cb13-628"><a href="#cb13-628" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">plot =</span> plots, <span class="at">prob_above_threshold =</span> prob_above_threshold))</span>
<span id="cb13-629"><a href="#cb13-629" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb13-630"><a href="#cb13-630" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb13-631"><a href="#cb13-631" aria-hidden="true" tabindex="-1"></a>      <span class="co"># --- Posterior analysis (remains the same) ---</span></span>
<span id="cb13-632"><a href="#cb13-632" aria-hidden="true" tabindex="-1"></a>      posterior_draws <span class="ot">&lt;-</span> posterior<span class="sc">::</span><span class="fu">as_draws_df</span>(posterior)</span>
<span id="cb13-633"><a href="#cb13-633" aria-hidden="true" tabindex="-1"></a>      posterior_eta <span class="ot">&lt;-</span> posterior_draws<span class="sc">$</span>eta</span>
<span id="cb13-634"><a href="#cb13-634" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb13-635"><a href="#cb13-635" aria-hidden="true" tabindex="-1"></a>      eta_plot <span class="ot">&lt;-</span></span>
<span id="cb13-636"><a href="#cb13-636" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">draws =</span> posterior_eta <span class="sc">*</span> <span class="dv">100</span>), <span class="fu">aes</span>(<span class="at">x =</span> draws)) <span class="sc">+</span></span>
<span id="cb13-637"><a href="#cb13-637" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb13-638"><a href="#cb13-638" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotate</span>(</span>
<span id="cb13-639"><a href="#cb13-639" aria-hidden="true" tabindex="-1"></a>          <span class="st">"text"</span>,</span>
<span id="cb13-640"><a href="#cb13-640" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="fu">quantile</span>(posterior_eta <span class="sc">*</span> <span class="dv">100</span>, <span class="at">prob =</span> <span class="fl">0.9</span>),</span>
<span id="cb13-641"><a href="#cb13-641" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="dv">200</span>,</span>
<span id="cb13-642"><a href="#cb13-642" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"mean: "</span>, <span class="fu">round</span>(<span class="fu">mean</span>(posterior_eta) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)),</span>
<span id="cb13-643"><a href="#cb13-643" aria-hidden="true" tabindex="-1"></a>          <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb13-644"><a href="#cb13-644" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb13-645"><a href="#cb13-645" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span>,</span>
<span id="cb13-646"><a href="#cb13-646" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb13-647"><a href="#cb13-647" aria-hidden="true" tabindex="-1"></a>                   <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-648"><a href="#cb13-648" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotate</span>(</span>
<span id="cb13-649"><a href="#cb13-649" aria-hidden="true" tabindex="-1"></a>          <span class="st">"text"</span>,</span>
<span id="cb13-650"><a href="#cb13-650" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="fl">2.5</span>,</span>
<span id="cb13-651"><a href="#cb13-651" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="dv">250</span>,</span>
<span id="cb13-652"><a href="#cb13-652" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="st">"True Effect"</span>,</span>
<span id="cb13-653"><a href="#cb13-653" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb13-654"><a href="#cb13-654" aria-hidden="true" tabindex="-1"></a>          <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb13-655"><a href="#cb13-655" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb13-656"><a href="#cb13-656" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Impact (percentage points)"</span>, <span class="at">y =</span> <span class="st">"N draws"</span>) <span class="sc">+</span></span>
<span id="cb13-657"><a href="#cb13-657" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_minimal</span>()</span>
<span id="cb13-658"><a href="#cb13-658" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb13-659"><a href="#cb13-659" aria-hidden="true" tabindex="-1"></a>      prob_above_threshold <span class="ot">&lt;-</span> <span class="fu">mean</span>(posterior_eta <span class="sc">&gt;</span> threshold)</span>
<span id="cb13-660"><a href="#cb13-660" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb13-661"><a href="#cb13-661" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">plot =</span> eta_plot, <span class="at">prob_above_threshold =</span> prob_above_threshold))</span>
<span id="cb13-662"><a href="#cb13-662" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-663"><a href="#cb13-663" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-664"><a href="#cb13-664" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-665"><a href="#cb13-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-666"><a href="#cb13-666" aria-hidden="true" tabindex="-1"></a><span class="fu">### Prior Predictive Checks</span></span>
<span id="cb13-667"><a href="#cb13-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-668"><a href="#cb13-668" aria-hidden="true" tabindex="-1"></a>In Bayesian modeling, it's crucial to check if our prior distributions are</span>
<span id="cb13-669"><a href="#cb13-669" aria-hidden="true" tabindex="-1"></a>reasonable. We use prior predictive checks to simulate data from our prior</span>
<span id="cb13-670"><a href="#cb13-670" aria-hidden="true" tabindex="-1"></a>distributions and visually assess if these simulated datasets are plausible in</span>
<span id="cb13-671"><a href="#cb13-671" aria-hidden="true" tabindex="-1"></a>the context of our problem. If the prior predictive distributions generate</span>
<span id="cb13-672"><a href="#cb13-672" aria-hidden="true" tabindex="-1"></a>implausible data, it might indicate that our priors are misspecified.</span>
<span id="cb13-673"><a href="#cb13-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-676"><a href="#cb13-676" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-677"><a href="#cb13-677" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-678"><a href="#cb13-678" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb13-679"><a href="#cb13-679" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">analyze_synthetic_data</span>(</span>
<span id="cb13-680"><a href="#cb13-680" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> synthetic_data,</span>
<span id="cb13-681"><a href="#cb13-681" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_alpha =</span> <span class="sc">-</span><span class="dv">6</span>,</span>
<span id="cb13-682"><a href="#cb13-682" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb13-683"><a href="#cb13-683" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau_mean =</span> <span class="dv">2</span>,</span>
<span id="cb13-684"><a href="#cb13-684" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau_sd =</span> <span class="dv">2</span>,</span>
<span id="cb13-685"><a href="#cb13-685" aria-hidden="true" tabindex="-1"></a>    <span class="at">run_estimation =</span> <span class="dv">0</span>,</span>
<span id="cb13-686"><a href="#cb13-686" aria-hidden="true" tabindex="-1"></a>    <span class="at">periods =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb13-687"><a href="#cb13-687" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="fl">0.01</span></span>
<span id="cb13-688"><a href="#cb13-688" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-689"><a href="#cb13-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-690"><a href="#cb13-690" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the plot</span></span>
<span id="cb13-691"><a href="#cb13-691" aria-hidden="true" tabindex="-1"></a>prior<span class="sc">$</span>plot</span>
<span id="cb13-692"><a href="#cb13-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-693"><a href="#cb13-693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-694"><a href="#cb13-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-695"><a href="#cb13-695" aria-hidden="true" tabindex="-1"></a>The plots above show that our prior distributions for the outcome (churn) and</span>
<span id="cb13-696"><a href="#cb13-696" aria-hidden="true" tabindex="-1"></a>the impact of the intervention are reasonable. In particular our prior before</span>
<span id="cb13-697"><a href="#cb13-697" aria-hidden="true" tabindex="-1"></a>seeing the outcome data is that the probability that the intervention has a</span>
<span id="cb13-698"><a href="#cb13-698" aria-hidden="true" tabindex="-1"></a>meaningful impact is <span class="in">`r scales::percent(prior$prob_above_threshold)`</span>.</span>
<span id="cb13-699"><a href="#cb13-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-700"><a href="#cb13-700" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sequential Bayesian Updating with Incoming Data</span></span>
<span id="cb13-701"><a href="#cb13-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-702"><a href="#cb13-702" aria-hidden="true" tabindex="-1"></a>Let's see how our model updates its beliefs as new data becomes available across</span>
<span id="cb13-703"><a href="#cb13-703" aria-hidden="true" tabindex="-1"></a>different time periods.</span>
<span id="cb13-704"><a href="#cb13-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-707"><a href="#cb13-707" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-708"><a href="#cb13-708" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-709"><a href="#cb13-709" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb13-710"><a href="#cb13-710" aria-hidden="true" tabindex="-1"></a>period_1 <span class="ot">&lt;-</span> <span class="fu">analyze_synthetic_data</span>(</span>
<span id="cb13-711"><a href="#cb13-711" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> synthetic_data,</span>
<span id="cb13-712"><a href="#cb13-712" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_alpha =</span> <span class="sc">-</span><span class="dv">6</span>,</span>
<span id="cb13-713"><a href="#cb13-713" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb13-714"><a href="#cb13-714" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau_mean =</span> <span class="dv">2</span>,</span>
<span id="cb13-715"><a href="#cb13-715" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau_sd =</span> <span class="dv">2</span>,</span>
<span id="cb13-716"><a href="#cb13-716" aria-hidden="true" tabindex="-1"></a>    <span class="at">run_estimation =</span> <span class="dv">1</span>,</span>
<span id="cb13-717"><a href="#cb13-717" aria-hidden="true" tabindex="-1"></a>    <span class="at">periods =</span> <span class="fu">c</span>(<span class="dv">1</span>),</span>
<span id="cb13-718"><a href="#cb13-718" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="fl">0.01</span></span>
<span id="cb13-719"><a href="#cb13-719" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-720"><a href="#cb13-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-721"><a href="#cb13-721" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the plot</span></span>
<span id="cb13-722"><a href="#cb13-722" aria-hidden="true" tabindex="-1"></a>period_1<span class="sc">$</span>plot</span>
<span id="cb13-723"><a href="#cb13-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-724"><a href="#cb13-724" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-725"><a href="#cb13-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-726"><a href="#cb13-726" aria-hidden="true" tabindex="-1"></a>Given the data available in period 1, we believe that the probability that the</span>
<span id="cb13-727"><a href="#cb13-727" aria-hidden="true" tabindex="-1"></a>intervention has a meaningful impact is</span>
<span id="cb13-728"><a href="#cb13-728" aria-hidden="true" tabindex="-1"></a><span class="in">`r scales::percent(period_1$prob_above_threshold, accuracy = 0.1)`</span>. This is with</span>
<span id="cb13-729"><a href="#cb13-729" aria-hidden="true" tabindex="-1"></a>just <span class="in">`r synthetic_data %&gt;% filter(period == 1) %&gt;% nrow()`</span> observations. Now we</span>
<span id="cb13-730"><a href="#cb13-730" aria-hidden="true" tabindex="-1"></a>can see what happens as we see more data in period 2.</span>
<span id="cb13-731"><a href="#cb13-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-734"><a href="#cb13-734" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-735"><a href="#cb13-735" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb13-736"><a href="#cb13-736" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-737"><a href="#cb13-737" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb13-738"><a href="#cb13-738" aria-hidden="true" tabindex="-1"></a>period_1_2 <span class="ot">&lt;-</span> <span class="fu">analyze_synthetic_data</span>(</span>
<span id="cb13-739"><a href="#cb13-739" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> synthetic_data,</span>
<span id="cb13-740"><a href="#cb13-740" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_alpha =</span> <span class="sc">-</span><span class="dv">6</span>,</span>
<span id="cb13-741"><a href="#cb13-741" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb13-742"><a href="#cb13-742" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau_mean =</span> <span class="dv">2</span>,</span>
<span id="cb13-743"><a href="#cb13-743" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau_sd =</span> <span class="dv">2</span>,</span>
<span id="cb13-744"><a href="#cb13-744" aria-hidden="true" tabindex="-1"></a>    <span class="at">run_estimation =</span> <span class="dv">1</span>,</span>
<span id="cb13-745"><a href="#cb13-745" aria-hidden="true" tabindex="-1"></a>    <span class="at">periods =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb13-746"><a href="#cb13-746" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="fl">0.01</span></span>
<span id="cb13-747"><a href="#cb13-747" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-748"><a href="#cb13-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-749"><a href="#cb13-749" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the plot</span></span>
<span id="cb13-750"><a href="#cb13-750" aria-hidden="true" tabindex="-1"></a>period_1_2<span class="sc">$</span>plot</span>
<span id="cb13-751"><a href="#cb13-751" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-752"><a href="#cb13-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-753"><a href="#cb13-753" aria-hidden="true" tabindex="-1"></a>Now, given the data available in period 2, we believe that the probability that</span>
<span id="cb13-754"><a href="#cb13-754" aria-hidden="true" tabindex="-1"></a>the intervention has a meaningful impact is</span>
<span id="cb13-755"><a href="#cb13-755" aria-hidden="true" tabindex="-1"></a><span class="in">`r scales::percent(period_1_2$prob_above_threshold, accuracy = 0.1)`</span>. Notice</span>
<span id="cb13-756"><a href="#cb13-756" aria-hidden="true" tabindex="-1"></a>that new <span class="in">`r synthetic_data %&gt;% filter(period == 2) %&gt;% nrow()`</span> observations from</span>
<span id="cb13-757"><a href="#cb13-757" aria-hidden="true" tabindex="-1"></a>period 2 move the posterior quite a bit. Finally, let's see how the data from</span>
<span id="cb13-758"><a href="#cb13-758" aria-hidden="true" tabindex="-1"></a>period 3 updates the posterior.</span>
<span id="cb13-759"><a href="#cb13-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-762"><a href="#cb13-762" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-763"><a href="#cb13-763" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb13-764"><a href="#cb13-764" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-765"><a href="#cb13-765" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb13-766"><a href="#cb13-766" aria-hidden="true" tabindex="-1"></a>period_1_2_3 <span class="ot">&lt;-</span> <span class="fu">analyze_synthetic_data</span>(</span>
<span id="cb13-767"><a href="#cb13-767" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> synthetic_data,</span>
<span id="cb13-768"><a href="#cb13-768" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_alpha =</span> <span class="sc">-</span><span class="dv">6</span>,</span>
<span id="cb13-769"><a href="#cb13-769" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb13-770"><a href="#cb13-770" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau_mean =</span> <span class="dv">2</span>,</span>
<span id="cb13-771"><a href="#cb13-771" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau_sd =</span> <span class="dv">2</span>,</span>
<span id="cb13-772"><a href="#cb13-772" aria-hidden="true" tabindex="-1"></a>    <span class="at">run_estimation =</span> <span class="dv">1</span>,</span>
<span id="cb13-773"><a href="#cb13-773" aria-hidden="true" tabindex="-1"></a>    <span class="at">periods =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb13-774"><a href="#cb13-774" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="fl">0.01</span></span>
<span id="cb13-775"><a href="#cb13-775" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-776"><a href="#cb13-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-777"><a href="#cb13-777" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the plot</span></span>
<span id="cb13-778"><a href="#cb13-778" aria-hidden="true" tabindex="-1"></a>period_1_2_3<span class="sc">$</span>plot</span>
<span id="cb13-779"><a href="#cb13-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-780"><a href="#cb13-780" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-781"><a href="#cb13-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-782"><a href="#cb13-782" aria-hidden="true" tabindex="-1"></a>Once we have collected all the data from this pilot, Given the data available in</span>
<span id="cb13-783"><a href="#cb13-783" aria-hidden="true" tabindex="-1"></a>period 3, we believe that the probability that the intervention has a meaningful</span>
<span id="cb13-784"><a href="#cb13-784" aria-hidden="true" tabindex="-1"></a>impact is</span>
<span id="cb13-785"><a href="#cb13-785" aria-hidden="true" tabindex="-1"></a><span class="in">`r scales::percent(period_1_2_3$prob_above_threshold, accuracy = 0.1)`</span>.</span>
<span id="cb13-786"><a href="#cb13-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-787"><a href="#cb13-787" aria-hidden="true" tabindex="-1"></a>One important thing to notice is that at any moment, including before collecting</span>
<span id="cb13-788"><a href="#cb13-788" aria-hidden="true" tabindex="-1"></a>any data, we could have made a decision. Then, as we collected more data our</span>
<span id="cb13-789"><a href="#cb13-789" aria-hidden="true" tabindex="-1"></a>belief changed.</span>
<span id="cb13-790"><a href="#cb13-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-791"><a href="#cb13-791" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculating the Strength of a Pilot</span></span>
<span id="cb13-792"><a href="#cb13-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-793"><a href="#cb13-793" aria-hidden="true" tabindex="-1"></a>To calculate the strength of a pilot, we can run a simulation like the one above</span>
<span id="cb13-794"><a href="#cb13-794" aria-hidden="true" tabindex="-1"></a>many times and see how often we would make the right decision. Moreover, we can</span>
<span id="cb13-795"><a href="#cb13-795" aria-hidden="true" tabindex="-1"></a>do this under different assumptions.</span>
<span id="cb13-796"><a href="#cb13-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-797"><a href="#cb13-797" aria-hidden="true" tabindex="-1"></a>For all our simulations, we will use the following decision rule: if the</span>
<span id="cb13-798"><a href="#cb13-798" aria-hidden="true" tabindex="-1"></a>posterior probability that the impact exceeds 1 percentage point is greater</span>
<span id="cb13-799"><a href="#cb13-799" aria-hidden="true" tabindex="-1"></a>than 75%, we kill the new feature; otherwise, we launch it. For the first set of</span>
<span id="cb13-800"><a href="#cb13-800" aria-hidden="true" tabindex="-1"></a>simulations, we will assume that the true impact is an increase in churn of 2</span>
<span id="cb13-801"><a href="#cb13-801" aria-hidden="true" tabindex="-1"></a>percentage points; therefore, killing the new feature is the right choice. We</span>
<span id="cb13-802"><a href="#cb13-802" aria-hidden="true" tabindex="-1"></a>will also run these simulations assuming our pilot will have 2000 observations,</span>
<span id="cb13-803"><a href="#cb13-803" aria-hidden="true" tabindex="-1"></a>half in treatment and half in control.</span>
<span id="cb13-804"><a href="#cb13-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-807"><a href="#cb13-807" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-808"><a href="#cb13-808" aria-hidden="true" tabindex="-1"></a>run_simulations <span class="ot">&lt;-</span></span>
<span id="cb13-809"><a href="#cb13-809" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(N,</span>
<span id="cb13-810"><a href="#cb13-810" aria-hidden="true" tabindex="-1"></a>           num_observations,</span>
<span id="cb13-811"><a href="#cb13-811" aria-hidden="true" tabindex="-1"></a>           treatment_proportion,</span>
<span id="cb13-812"><a href="#cb13-812" aria-hidden="true" tabindex="-1"></a>           control_churn_prob,</span>
<span id="cb13-813"><a href="#cb13-813" aria-hidden="true" tabindex="-1"></a>           treatment_churn_prob,</span>
<span id="cb13-814"><a href="#cb13-814" aria-hidden="true" tabindex="-1"></a>           period1_proportion,</span>
<span id="cb13-815"><a href="#cb13-815" aria-hidden="true" tabindex="-1"></a>           period2_proportion,</span>
<span id="cb13-816"><a href="#cb13-816" aria-hidden="true" tabindex="-1"></a>           mean_alpha,</span>
<span id="cb13-817"><a href="#cb13-817" aria-hidden="true" tabindex="-1"></a>           sd_alpha,</span>
<span id="cb13-818"><a href="#cb13-818" aria-hidden="true" tabindex="-1"></a>           tau_mean,</span>
<span id="cb13-819"><a href="#cb13-819" aria-hidden="true" tabindex="-1"></a>           tau_sd,</span>
<span id="cb13-820"><a href="#cb13-820" aria-hidden="true" tabindex="-1"></a>           periods,</span>
<span id="cb13-821"><a href="#cb13-821" aria-hidden="true" tabindex="-1"></a>           threshold,</span>
<span id="cb13-822"><a href="#cb13-822" aria-hidden="true" tabindex="-1"></a>           <span class="at">num_cores =</span> <span class="dv">1</span>) {</span>
<span id="cb13-823"><a href="#cb13-823" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Function to run a single simulation</span></span>
<span id="cb13-824"><a href="#cb13-824" aria-hidden="true" tabindex="-1"></a>    run_single_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(i) {</span>
<span id="cb13-825"><a href="#cb13-825" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Generate synthetic data with a unique seed</span></span>
<span id="cb13-826"><a href="#cb13-826" aria-hidden="true" tabindex="-1"></a>      synthetic_data <span class="ot">&lt;-</span> <span class="fu">generate_synthetic_data</span>(</span>
<span id="cb13-827"><a href="#cb13-827" aria-hidden="true" tabindex="-1"></a>        <span class="at">seed =</span> i,</span>
<span id="cb13-828"><a href="#cb13-828" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use simulation number as seed</span></span>
<span id="cb13-829"><a href="#cb13-829" aria-hidden="true" tabindex="-1"></a>        <span class="at">num_observations =</span> num_observations,</span>
<span id="cb13-830"><a href="#cb13-830" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment_proportion =</span> treatment_proportion,</span>
<span id="cb13-831"><a href="#cb13-831" aria-hidden="true" tabindex="-1"></a>        <span class="at">control_churn_prob =</span> control_churn_prob,</span>
<span id="cb13-832"><a href="#cb13-832" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment_churn_prob =</span> treatment_churn_prob,</span>
<span id="cb13-833"><a href="#cb13-833" aria-hidden="true" tabindex="-1"></a>        <span class="at">period1_proportion =</span> period1_proportion,</span>
<span id="cb13-834"><a href="#cb13-834" aria-hidden="true" tabindex="-1"></a>        <span class="at">period2_proportion =</span> period2_proportion</span>
<span id="cb13-835"><a href="#cb13-835" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb13-836"><a href="#cb13-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-837"><a href="#cb13-837" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Analyze the synthetic data</span></span>
<span id="cb13-838"><a href="#cb13-838" aria-hidden="true" tabindex="-1"></a>      analysis_result <span class="ot">&lt;-</span> <span class="fu">analyze_synthetic_data</span>(</span>
<span id="cb13-839"><a href="#cb13-839" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> synthetic_data,</span>
<span id="cb13-840"><a href="#cb13-840" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_alpha =</span> mean_alpha,</span>
<span id="cb13-841"><a href="#cb13-841" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd_alpha =</span> sd_alpha,</span>
<span id="cb13-842"><a href="#cb13-842" aria-hidden="true" tabindex="-1"></a>        <span class="at">tau_mean =</span> tau_mean,</span>
<span id="cb13-843"><a href="#cb13-843" aria-hidden="true" tabindex="-1"></a>        <span class="at">tau_sd =</span> tau_sd,</span>
<span id="cb13-844"><a href="#cb13-844" aria-hidden="true" tabindex="-1"></a>        <span class="at">run_estimation =</span> <span class="dv">1</span>,</span>
<span id="cb13-845"><a href="#cb13-845" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Run estimation</span></span>
<span id="cb13-846"><a href="#cb13-846" aria-hidden="true" tabindex="-1"></a>        <span class="at">periods =</span> periods,</span>
<span id="cb13-847"><a href="#cb13-847" aria-hidden="true" tabindex="-1"></a>        <span class="at">threshold =</span> threshold</span>
<span id="cb13-848"><a href="#cb13-848" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb13-849"><a href="#cb13-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-850"><a href="#cb13-850" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(analysis_result<span class="sc">$</span>prob_above_threshold)</span>
<span id="cb13-851"><a href="#cb13-851" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-852"><a href="#cb13-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-853"><a href="#cb13-853" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run simulations using purrr (parallel or sequential)</span></span>
<span id="cb13-854"><a href="#cb13-854" aria-hidden="true" tabindex="-1"></a>    probabilities <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N <span class="sc">%&gt;%</span></span>
<span id="cb13-855"><a href="#cb13-855" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb13-856"><a href="#cb13-856" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (num_cores <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb13-857"><a href="#cb13-857" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Use future_map for parallel execution</span></span>
<span id="cb13-858"><a href="#cb13-858" aria-hidden="true" tabindex="-1"></a>          future<span class="sc">::</span><span class="fu">plan</span>(future<span class="sc">::</span>multicore, <span class="at">workers =</span> num_cores) <span class="co"># Setup parallel processing</span></span>
<span id="cb13-859"><a href="#cb13-859" aria-hidden="true" tabindex="-1"></a>          <span class="fu">future_map</span>(., run_single_sim)</span>
<span id="cb13-860"><a href="#cb13-860" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb13-861"><a href="#cb13-861" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Use map for sequential execution</span></span>
<span id="cb13-862"><a href="#cb13-862" aria-hidden="true" tabindex="-1"></a>          <span class="fu">map</span>(., run_single_sim)</span>
<span id="cb13-863"><a href="#cb13-863" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-864"><a href="#cb13-864" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb13-865"><a href="#cb13-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-866"><a href="#cb13-866" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(probabilities)</span>
<span id="cb13-867"><a href="#cb13-867" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-868"><a href="#cb13-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-869"><a href="#cb13-869" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-870"><a href="#cb13-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-871"><a href="#cb13-871" aria-hidden="true" tabindex="-1"></a>Let's run the simulations with 2000 observations:</span>
<span id="cb13-872"><a href="#cb13-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-875"><a href="#cb13-875" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-876"><a href="#cb13-876" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-877"><a href="#cb13-877" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb13-878"><a href="#cb13-878" aria-hidden="true" tabindex="-1"></a>simulations <span class="ot">&lt;-</span> <span class="fu">run_simulations</span>(</span>
<span id="cb13-879"><a href="#cb13-879" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="dv">200</span>,</span>
<span id="cb13-880"><a href="#cb13-880" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_observations =</span> <span class="dv">2000</span>,</span>
<span id="cb13-881"><a href="#cb13-881" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_proportion =</span> <span class="fl">0.5</span>,</span>
<span id="cb13-882"><a href="#cb13-882" aria-hidden="true" tabindex="-1"></a>  <span class="at">control_churn_prob =</span> <span class="fl">0.05</span>,</span>
<span id="cb13-883"><a href="#cb13-883" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_churn_prob =</span> <span class="fl">0.07</span>,</span>
<span id="cb13-884"><a href="#cb13-884" aria-hidden="true" tabindex="-1"></a>  <span class="at">period1_proportion =</span> <span class="fl">0.2</span>,</span>
<span id="cb13-885"><a href="#cb13-885" aria-hidden="true" tabindex="-1"></a>  <span class="at">period2_proportion =</span> <span class="fl">0.5</span>,</span>
<span id="cb13-886"><a href="#cb13-886" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_alpha =</span> <span class="sc">-</span><span class="dv">6</span>,</span>
<span id="cb13-887"><a href="#cb13-887" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb13-888"><a href="#cb13-888" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau_mean =</span> <span class="dv">2</span>,</span>
<span id="cb13-889"><a href="#cb13-889" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau_sd =</span> <span class="dv">2</span>,</span>
<span id="cb13-890"><a href="#cb13-890" aria-hidden="true" tabindex="-1"></a>  <span class="at">periods =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb13-891"><a href="#cb13-891" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb13-892"><a href="#cb13-892" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_cores =</span> <span class="dv">4</span></span>
<span id="cb13-893"><a href="#cb13-893" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-894"><a href="#cb13-894" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-895"><a href="#cb13-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-896"><a href="#cb13-896" aria-hidden="true" tabindex="-1"></a>The simulation results tell us that, with our chosen priors, model, pilot size,</span>
<span id="cb13-897"><a href="#cb13-897" aria-hidden="true" tabindex="-1"></a>and decision rule, we correctly kill the new feature (when it truly has a</span>
<span id="cb13-898"><a href="#cb13-898" aria-hidden="true" tabindex="-1"></a>meaningful impact) in approximately</span>
<span id="cb13-899"><a href="#cb13-899" aria-hidden="true" tabindex="-1"></a><span class="in">`r scales::percent(mean(simulations &gt; 0.75))`</span> of the simulated pilot studies.</span>
<span id="cb13-900"><a href="#cb13-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-901"><a href="#cb13-901" aria-hidden="true" tabindex="-1"></a>Next we can run this simulation under the assumption that instead of 2000</span>
<span id="cb13-902"><a href="#cb13-902" aria-hidden="true" tabindex="-1"></a>observations we will only have 1000 observations.</span>
<span id="cb13-903"><a href="#cb13-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-906"><a href="#cb13-906" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-907"><a href="#cb13-907" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-908"><a href="#cb13-908" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb13-909"><a href="#cb13-909" aria-hidden="true" tabindex="-1"></a>simulations <span class="ot">&lt;-</span> <span class="fu">run_simulations</span>(</span>
<span id="cb13-910"><a href="#cb13-910" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="dv">200</span>,</span>
<span id="cb13-911"><a href="#cb13-911" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_observations =</span> <span class="dv">1000</span>,</span>
<span id="cb13-912"><a href="#cb13-912" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_proportion =</span> <span class="fl">0.5</span>,</span>
<span id="cb13-913"><a href="#cb13-913" aria-hidden="true" tabindex="-1"></a>  <span class="at">control_churn_prob =</span> <span class="fl">0.05</span>,</span>
<span id="cb13-914"><a href="#cb13-914" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_churn_prob =</span> <span class="fl">0.07</span>,</span>
<span id="cb13-915"><a href="#cb13-915" aria-hidden="true" tabindex="-1"></a>  <span class="at">period1_proportion =</span> <span class="fl">0.2</span>,</span>
<span id="cb13-916"><a href="#cb13-916" aria-hidden="true" tabindex="-1"></a>  <span class="at">period2_proportion =</span> <span class="fl">0.5</span>,</span>
<span id="cb13-917"><a href="#cb13-917" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_alpha =</span> <span class="sc">-</span><span class="dv">6</span>,</span>
<span id="cb13-918"><a href="#cb13-918" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb13-919"><a href="#cb13-919" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau_mean =</span> <span class="dv">2</span>,</span>
<span id="cb13-920"><a href="#cb13-920" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau_sd =</span> <span class="dv">2</span>,</span>
<span id="cb13-921"><a href="#cb13-921" aria-hidden="true" tabindex="-1"></a>  <span class="at">periods =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb13-922"><a href="#cb13-922" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb13-923"><a href="#cb13-923" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_cores =</span> <span class="dv">4</span></span>
<span id="cb13-924"><a href="#cb13-924" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-925"><a href="#cb13-925" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-926"><a href="#cb13-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-927"><a href="#cb13-927" aria-hidden="true" tabindex="-1"></a>Now we can see that if the pilot only has 1000 observations, we would make the</span>
<span id="cb13-928"><a href="#cb13-928" aria-hidden="true" tabindex="-1"></a>right decision only <span class="in">`r scales::percent(mean(simulations &gt; 0.75))`</span> of the time.</span>
<span id="cb13-929"><a href="#cb13-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-930"><a href="#cb13-930" aria-hidden="true" tabindex="-1"></a>Similarly, we can now change our data generating process so that the true effect</span>
<span id="cb13-931"><a href="#cb13-931" aria-hidden="true" tabindex="-1"></a>of the intervention is zero. In the right decision would be to roll out the new</span>
<span id="cb13-932"><a href="#cb13-932" aria-hidden="true" tabindex="-1"></a>feature.</span>
<span id="cb13-933"><a href="#cb13-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-936"><a href="#cb13-936" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-937"><a href="#cb13-937" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-938"><a href="#cb13-938" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb13-939"><a href="#cb13-939" aria-hidden="true" tabindex="-1"></a>simulations <span class="ot">&lt;-</span> <span class="fu">run_simulations</span>(</span>
<span id="cb13-940"><a href="#cb13-940" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="dv">200</span>,</span>
<span id="cb13-941"><a href="#cb13-941" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_observations =</span> <span class="dv">1000</span>,</span>
<span id="cb13-942"><a href="#cb13-942" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_proportion =</span> <span class="fl">0.5</span>,</span>
<span id="cb13-943"><a href="#cb13-943" aria-hidden="true" tabindex="-1"></a>  <span class="at">control_churn_prob =</span> <span class="fl">0.05</span>,</span>
<span id="cb13-944"><a href="#cb13-944" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment_churn_prob =</span> <span class="fl">0.05</span>, <span class="co"># &lt;-same as control_churn_prob</span></span>
<span id="cb13-945"><a href="#cb13-945" aria-hidden="true" tabindex="-1"></a>  <span class="at">period1_proportion =</span> <span class="fl">0.2</span>,</span>
<span id="cb13-946"><a href="#cb13-946" aria-hidden="true" tabindex="-1"></a>  <span class="at">period2_proportion =</span> <span class="fl">0.5</span>,</span>
<span id="cb13-947"><a href="#cb13-947" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_alpha =</span> <span class="sc">-</span><span class="dv">6</span>,</span>
<span id="cb13-948"><a href="#cb13-948" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb13-949"><a href="#cb13-949" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau_mean =</span> <span class="dv">2</span>,</span>
<span id="cb13-950"><a href="#cb13-950" aria-hidden="true" tabindex="-1"></a>  <span class="at">tau_sd =</span> <span class="dv">2</span>,</span>
<span id="cb13-951"><a href="#cb13-951" aria-hidden="true" tabindex="-1"></a>  <span class="at">periods =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb13-952"><a href="#cb13-952" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fl">0.01</span>,</span>
<span id="cb13-953"><a href="#cb13-953" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_cores =</span> <span class="dv">4</span></span>
<span id="cb13-954"><a href="#cb13-954" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-955"><a href="#cb13-955" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-956"><a href="#cb13-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-957"><a href="#cb13-957" aria-hidden="true" tabindex="-1"></a>In this case, the probability of making the right choice (rolling out the new feature when it has no meaningful impact on churn) is <span class="in">`r scales::percent(mean(simulations &lt; 0.75))`</span>.</span>
<span id="cb13-958"><a href="#cb13-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-959"><a href="#cb13-959" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb13-960"><a href="#cb13-960" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learn more</span></span>
<span id="cb13-961"><a href="#cb13-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-962"><a href="#cb13-962" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>@dong2013powerup PowerUp!: A tool for calculating minimum detectable effect sizes and minimum required sample sizes for experimental and quasi-experimental design studies.</span>
<span id="cb13-963"><a href="#cb13-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-964"><a href="#cb13-964" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>@bloom2008core The core analytics of randomized experiments for social research.</span>
<span id="cb13-965"><a href="#cb13-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-966"><a href="#cb13-966" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>@gelman2014beyond Beyond power calculations: Assessing type S (sign) and type M (magnitude) errors.</span>
<span id="cb13-967"><a href="#cb13-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-968"><a href="#cb13-968" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>@mcdonnell2018test Test &amp; Roll: Profit-Maximizing A/B Tests.\</span>
<span id="cb13-969"><a href="#cb13-969" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ignacio82/book/edit/master/strength.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer><div class="page-columns page-rows-contents page-layout-article"><div class="social-share"><a href="https://www.linkedin.com/shareArticle?url=https://book.martinez.fyi/strenght.html&amp;title=Pilot Strength: Designing Decision-Centric Business Experiments" target="_blank" class="linkedin"><i class="fa-brands fa-linkedin-in fa-fw fa-lg"></i></a>  <a href="mailto:?subject=Pilot Strength: Designing Decision-Centric Business Experiments&amp;body=Check out this link:https://book.martinez.fyi/strenght.html" target="_blank" class="email"><i class="fa-solid fa-envelope fa-fw fa-lg"></i></a><a href="javascript:void(0);" onclick="var mastodon_instance=prompt('Mastodon Instance / Server Name?'); if(typeof mastodon_instance==='string' &amp;&amp; mastodon_instance.length){this.href='https://'+mastodon_instance+'/share?text=Pilot Strength: Designing Decision-Centric Business Experiments https://book.martinez.fyi/strenght.html'}else{return false;}" target="_blank" class="mastodon"><i class="fa-brands fa-mastodon fa-fw fa-lg"></i></a></div></div>




</body></html>