<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="??">
<meta name="author" content="Ignacio Martinez">

<title>Business Data Science - 12&nbsp; Matching</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./causalimpact.html" rel="next">
<link href="./other_methods.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/social-share-0.1.0/social-share.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/social-share-0.1.0/all.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script defer="" src="https://umami.martinez.fyi/script.js" data-website-id="bc587120-3bd3-4c2d-b463-5eb64dd4e330"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Business Data Science - 12&nbsp; Matching">
<meta property="og:description" content="">
<meta property="og:image" content="https://book.martinez.fyi/hex.png">
<meta property="og:site_name" content="Business Data Science">
<meta property="og:image:height" content="588">
<meta property="og:image:width" content="510">
<meta name="twitter:title" content="Business Data Science - 12&nbsp; Matching">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://book.martinez.fyi/hex.png">
<meta name="twitter:image-height" content="588">
<meta name="twitter:image-width" content="510">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./other_methods.html">Non Experimental Methods</a></li><li class="breadcrumb-item"><a href="./matching.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Matching</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./hex.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Business Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ignacio82/book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">What Does it Mean to Be Data-Driven?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./potential_outcome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Potential Outcomes Framework</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./baseline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Baseline Equivalence</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes101.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bayes 101</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./decisions_first.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">A Decisions First Framework</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rce.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Rapid-Cycle Evaluation for Program Improvement</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surrogates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Surrogates</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./rct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Gold Standard</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rct_basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">The Power of Randomization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bad.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Bayesian Adaptive Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./factorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Bayesian Factorial Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Randomized Encouragement Design</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./other_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Non Experimental Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matching.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Matching</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causalimpact.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Bayesian Structural Time Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bsynth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Bayesian Synthetic Control</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generalized Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./blm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Bayesian Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meta-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Meta-Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./beyond_normality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Beyond Normality</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./stochastictrees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Stochastic Trees</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Bayesian Additive Regression Trees (BART)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bcf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Bayesian Causal Forest (BCF)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./longbet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">LongBet: Heterogeneous Treatment Effects in Panel Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-bootcamp-conundrum" id="toc-the-bootcamp-conundrum" class="nav-link active" data-scroll-target="#the-bootcamp-conundrum"><span class="header-section-number">12.1</span> The Bootcamp Conundrum</a></li>
  <li><a href="#matching-to-the-rescue" id="toc-matching-to-the-rescue" class="nav-link" data-scroll-target="#matching-to-the-rescue"><span class="header-section-number">12.2</span> Matching to the Rescue</a></li>
  <li><a href="#the-mechanics-of-matching" id="toc-the-mechanics-of-matching" class="nav-link" data-scroll-target="#the-mechanics-of-matching"><span class="header-section-number">12.3</span> The Mechanics of Matching</a>
  <ul class="collapse">
  <li><a href="#mahalanobis-distance-accounting-for-covariate-relationships" id="toc-mahalanobis-distance-accounting-for-covariate-relationships" class="nav-link" data-scroll-target="#mahalanobis-distance-accounting-for-covariate-relationships">Mahalanobis Distance: Accounting for Covariate Relationships</a></li>
  <li><a href="#propensity-scores-collapsing-dimensions" id="toc-propensity-scores-collapsing-dimensions" class="nav-link" data-scroll-target="#propensity-scores-collapsing-dimensions">Propensity Scores: Collapsing Dimensions</a></li>
  <li><a href="#key-differences-between-mahalanobis-distance-and-propensity-score" id="toc-key-differences-between-mahalanobis-distance-and-propensity-score" class="nav-link" data-scroll-target="#key-differences-between-mahalanobis-distance-and-propensity-score">Key Differences Between Mahalanobis Distance and Propensity Score</a></li>
  <li><a href="#when-to-use-each" id="toc-when-to-use-each" class="nav-link" data-scroll-target="#when-to-use-each">When to Use Each</a></li>
  <li><a href="#matching-algorithms-putting-theory-into-practice" id="toc-matching-algorithms-putting-theory-into-practice" class="nav-link" data-scroll-target="#matching-algorithms-putting-theory-into-practice">Matching Algorithms: Putting Theory into Practice</a></li>
  </ul></li>
  <li><a href="#the-limits-of-matching-avoiding-matching-charles-to-ozzy" id="toc-the-limits-of-matching-avoiding-matching-charles-to-ozzy" class="nav-link" data-scroll-target="#the-limits-of-matching-avoiding-matching-charles-to-ozzy"><span class="header-section-number">12.4</span> The Limits of Matching: Avoiding Matching Charles to Ozzy</a></li>
  <li><a href="#the-propensity-score-paradox-a-critique-by-king-and-nielsen" id="toc-the-propensity-score-paradox-a-critique-by-king-and-nielsen" class="nav-link" data-scroll-target="#the-propensity-score-paradox-a-critique-by-king-and-nielsen"><span class="header-section-number">12.5</span> The Propensity Score Paradox: A Critique by King and Nielsen</a>
  <ul class="collapse">
  <li><a href="#the-psm-paradox" id="toc-the-psm-paradox" class="nav-link" data-scroll-target="#the-psm-paradox">The PSM Paradox</a></li>
  <li><a href="#the-mechanics-behind-the-paradox" id="toc-the-mechanics-behind-the-paradox" class="nav-link" data-scroll-target="#the-mechanics-behind-the-paradox">The Mechanics Behind the Paradox</a></li>
  <li><a href="#empirical-evidence" id="toc-empirical-evidence" class="nav-link" data-scroll-target="#empirical-evidence">Empirical Evidence</a></li>
  <li><a href="#recommendations" id="toc-recommendations" class="nav-link" data-scroll-target="#recommendations">Recommendations</a></li>
  <li><a href="#implications-for-practice" id="toc-implications-for-practice" class="nav-link" data-scroll-target="#implications-for-practice">Implications for Practice</a></li>
  </ul></li>
  <li><a href="#practical-examples-with-matchit" id="toc-practical-examples-with-matchit" class="nav-link" data-scroll-target="#practical-examples-with-matchit"><span class="header-section-number">12.6</span> Practical Examples with MatchIt</a>
  <ul class="collapse">
  <li><a href="#cautionary-tale-unmeasured-confounders." id="toc-cautionary-tale-unmeasured-confounders." class="nav-link" data-scroll-target="#cautionary-tale-unmeasured-confounders.">Cautionary tale: Unmeasured Confounders.</a></li>
  </ul></li>
  <li><a href="#conclusion-the-power-and-pitfalls-of-matching" id="toc-conclusion-the-power-and-pitfalls-of-matching" class="nav-link" data-scroll-target="#conclusion-the-power-and-pitfalls-of-matching"><span class="header-section-number">12.7</span> Conclusion: The Power and Pitfalls of Matching</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ignacio82/book/edit/master/matching.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./other_methods.html">Non Experimental Methods</a></li><li class="breadcrumb-item"><a href="./matching.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Matching</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Matching</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>?? </p>
             <p>Ignacio Martinez </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>In the realm of causal inference, matching stands out as a powerful and popular statistical technique. Its primary goal? To construct a valid comparison group by pairing treated units with untreated units that are as similar as possible based on observable characteristics. This chapter will dive deep into the world of matching, exploring its mechanics, applications, and limitations.</p>
<section id="the-bootcamp-conundrum" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="the-bootcamp-conundrum"><span class="header-section-number">12.1</span> The Bootcamp Conundrum</h2>
<p>Imagine a tech company, eager to propel its engineers forward, rolls out a shiny new AI bootcamp. Yet, due to scheduling quirks, the bootcamp ends up heavily skewed towards senior engineers – those with five or more years under their belts. This poses a classic causal inference challenge.</p>
<p>In the potential outcomes framework, we envision each engineer with two possible career paths: one if they attend the bootcamp (<span class="math inline">\(Y_1\)</span>), another if they don’t (<span class="math inline">\(Y_0\)</span>). The rub, of course, is that we only witness one reality per engineer.</p>
<p>The non-random enrollment in our bootcamp muddies the waters. Simply comparing bootcamp graduates to non-participants would be like judging a footrace where one runner had a head start. The bootcamp group, on average, boasts more experience – a factor we know can independently turbocharge careers.</p>
</section>
<section id="matching-to-the-rescue" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="matching-to-the-rescue"><span class="header-section-number">12.2</span> Matching to the Rescue</h2>
<p>To level the playing field, we construct a matched control group. For each bootcamp attendee, we seek out a non-attendee with a similar experience level. By comparing outcomes within these matched pairs, we can tease out the bootcamp’s true impact, disentangling it from the effects of experience.</p>
<p>Yet, the plot thickens. What if bootcamp participation wasn’t solely about experience? In a global company, time zones could play a role. Attending a bootcamp during US business hours is far more convenient for an engineer in New York than one in Tokyo. Here, time zone becomes a confounder, potentially influencing both bootcamp attendance and career trajectory.</p>
<p>One might try to match on both experience and location, but this quickly becomes unwieldy as more factors enter the picture. The elegant solution is to estimate a propensity score – the probability of each engineer attending the bootcamp based on their various characteristics. By matching on this propensity score, we create comparable groups, even when those groups differ on a multitude of individual attributes.</p>
</section>
<section id="the-mechanics-of-matching" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="the-mechanics-of-matching"><span class="header-section-number">12.3</span> The Mechanics of Matching</h2>
<p>Matching typically involves four key steps:</p>
<ol type="1">
<li>Choose a distance measure to quantify the similarity between units.</li>
<li>Match treated units to untreated units based on this distance measure.</li>
<li>Assess the quality of the matches and iterate if necessary.</li>
<li>Estimate treatment effects using the matched sample.</li>
</ol>
<p>Let’s explore two common distance measures in detail: Mahalanobis distance and propensity scores.</p>
<section id="mahalanobis-distance-accounting-for-covariate-relationships" class="level3">
<h3 class="anchored" data-anchor-id="mahalanobis-distance-accounting-for-covariate-relationships">Mahalanobis Distance: Accounting for Covariate Relationships</h3>
<p>Mahalanobis distance is a multivariate measure of the distance between a point and the center of a distribution. It’s particularly useful in matching because it accounts for the correlations between variables.</p>
<p>Key features of Mahalanobis distance include:</p>
<ul>
<li>Scale-invariance: It’s unaffected by the scale of measurement.</li>
<li>Covariance consideration: It accounts for relationships between variables.</li>
<li>Euclidean equivalence: For uncorrelated variables with unit variance, it reduces to Euclidean distance.</li>
</ul>
<p>Mathematically, the Mahalanobis distance between two points <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> in p-dimensional space is:</p>
<p><span class="math display">\[D_M(x,y) = \sqrt{(x-y)^T S^{-1} (x-y)}\]</span> Where <span class="math inline">\(S\)</span> is the covariance matrix of the variables.</p>
</section>
<section id="propensity-scores-collapsing-dimensions" class="level3">
<h3 class="anchored" data-anchor-id="propensity-scores-collapsing-dimensions">Propensity Scores: Collapsing Dimensions</h3>
<p>The propensity score represents the probability of receiving treatment given observed covariates, often estimated using logistic regression. Key features of propensity scores include:</p>
<ul>
<li>Dimension reduction: They collapse multiple covariates into a single score.</li>
<li>Balance assessment: They make it easier to check balance on a single dimension.</li>
<li>Interpretability: They represent the probability of treatment.</li>
</ul>
<p>The propensity score is given by: <span class="math display">\[ e(X) = P(T=1|X)\]</span> Where <span class="math inline">\(T\)</span> is the treatment indicator and <span class="math inline">\(X\)</span> is the vector of covariates.</p>
</section>
<section id="key-differences-between-mahalanobis-distance-and-propensity-score" class="level3">
<h3 class="anchored" data-anchor-id="key-differences-between-mahalanobis-distance-and-propensity-score">Key Differences Between Mahalanobis Distance and Propensity Score</h3>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 32%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>Mahalanobis Distance</th>
<th>Propensity Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Dimensionality</td>
<td>Operates in original covariate space</td>
<td>Reduces matching to a single dimension</td>
</tr>
<tr class="even">
<td>Interpretation</td>
<td>Measures multivariate similarity</td>
<td>Represents probability of treatment</td>
</tr>
<tr class="odd">
<td>Covariate relationships</td>
<td>Explicitly accounts for covariance</td>
<td>Implicitly captures relationships through the model</td>
</tr>
<tr class="even">
<td>Model specification</td>
<td>Doesn’t require a model</td>
<td>Can be sensitive to estimation method</td>
</tr>
<tr class="odd">
<td>Categorical variables</td>
<td>Can struggle with them</td>
<td>Naturally incorporates them</td>
</tr>
<tr class="even">
<td>Curse of dimensionality</td>
<td>Can suffer in high dimensions</td>
<td>Handles higher dimensions more easily</td>
</tr>
</tbody>
</table>
</section>
<section id="when-to-use-each" class="level3">
<h3 class="anchored" data-anchor-id="when-to-use-each">When to Use Each</h3>
<ul>
<li><strong>Mahalanobis distance:</strong> Ideal when you have few continuous covariates, relationships between covariates are important, and you want to avoid specifying a treatment model.</li>
<li><strong>Propensity scores:</strong> Better suited when you have many covariates (including categorical ones), the treatment mechanism is of interest, and you want to easily assess balance and overlap.</li>
</ul>
</section>
<section id="matching-algorithms-putting-theory-into-practice" class="level3">
<h3 class="anchored" data-anchor-id="matching-algorithms-putting-theory-into-practice">Matching Algorithms: Putting Theory into Practice</h3>
<p>Once we’ve chosen a distance measure, we need an algorithm to perform the actual matching. Three common approaches are:</p>
<ul>
<li>Nearest neighbor matching: Matches each treated unit to the closest untreated unit.</li>
<li>Optimal matching: Minimizes the total distance across all matched pairs.</li>
<li>Full matching: Creates matched sets, each containing at least one treated and one untreated unit.</li>
</ul>
</section>
</section>
<section id="the-limits-of-matching-avoiding-matching-charles-to-ozzy" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="the-limits-of-matching-avoiding-matching-charles-to-ozzy"><span class="header-section-number">12.4</span> The Limits of Matching: Avoiding Matching Charles to Ozzy</h2>
<p>As with any causal inference method, matching is not a magic bullet. It works best when you have the right data to model treatment assignment. Essentially, after matching, whether someone is in the treatment group should be effectively random.</p>
<p>For example, in our bootcamp scenario, imagine that participation is largely explained by an engineer’s “grit” – a trait we cannot directly observe or match on. If career trajectory is also a function of grit, we might mistakenly conclude that the bootcamp has a larger impact than it truly does. Conversely, if procrastinators are more likely to participate, we might wrongly infer that the bootcamp hurts career success.</p>
<p>A memorable way to understand this limitation is through the “Ozzy Osbourne Conundrum.” Consider these two individuals:</p>
<div id="tbl-ozzy_and_charles" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ozzy_and_charles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12.1: Matching Charles to Ozzy
</figcaption>
<div aria-describedby="tbl-ozzy_and_charles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 53%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"><pre><code>               Charles</code></pre></th>
<th style="text-align: center;"><pre><code>               Ozzy</code></pre></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><p><img src="img/charles.webp" height="500" class="figure-img"></p>
<pre><code>                Male

            Born in 1948

          Raised in the UK

         Lives in a castle

         Wealthy &amp; famous</code></pre></td>
<td style="text-align: center;"><p><img src="img/ozzy.png" height="500" class="figure-img"></p>
<pre><code>               Male

           Born in 1948

         Raised in the UK

         Lives in a castle

         Wealthy &amp; famous</code></pre></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Ozzy and Charles share many observable characteristics: they’re both males, born in 1948, raised in the UK, live in castles, and are wealthy and famous. However, Ozzy would clearly not be a good match for Charles in most studies. This example illustrates how matching on observables can sometimes be misleading.</p>
<p>The key takeaway? Matching is a powerful tool, but it relies on the assumption that after matching, the remaining differences between groups are essentially random. If this assumption doesn’t hold, our conclusions may be misleading.</p>
</section>
<section id="the-propensity-score-paradox-a-critique-by-king-and-nielsen" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="the-propensity-score-paradox-a-critique-by-king-and-nielsen"><span class="header-section-number">12.5</span> The Propensity Score Paradox: A Critique by King and Nielsen</h2>
<p>In their influential paper, <span class="citation" data-cites="King_Nielsen_2019">King and Nielsen (<a href="references.html#ref-King_Nielsen_2019" role="doc-biblioref">2019</a>)</span> present a compelling critique of propensity score matching (PSM). Their findings challenge conventional wisdom and offer important insights for practitioners of matching methods.</p>
<section id="the-psm-paradox" class="level3">
<h3 class="anchored" data-anchor-id="the-psm-paradox">The PSM Paradox</h3>
<p>At the heart of King and Nielsen’s argument is what they term the “PSM paradox.” They demonstrate that under certain conditions, PSM can actually increase imbalance, model dependence, and bias. This occurs because PSM approximates a completely randomized experiment, rather than a more efficient fully blocked randomized experiment.</p>
<p>Key findings include:</p>
<ol type="1">
<li>Increased Imbalance: As PSM prunes observations to improve balance, it can paradoxically increase imbalance on the original covariates after a certain point.</li>
<li>Model Dependence: PSM can lead to greater model dependence, meaning that different model specifications can yield substantially different causal estimates.</li>
<li>Bias: The combination of increased imbalance and model dependence can result in biased causal estimates.</li>
</ol>
</section>
<section id="the-mechanics-behind-the-paradox" class="level3">
<h3 class="anchored" data-anchor-id="the-mechanics-behind-the-paradox">The Mechanics Behind the Paradox</h3>
<p>King and Nielsen explain that PSM’s shortcomings stem from its attempt to approximate complete randomization. In contrast, other matching methods aim to approximate full blocking, which is generally more efficient and precise.</p>
<ol type="1">
<li>Information Loss: PSM collapses multi-dimensional covariate information into a single dimension (the propensity score), potentially discarding valuable information.</li>
<li>Random Pruning: Once PSM achieves its goal of approximate randomization, further pruning of observations becomes essentially random with respect to the original covariates. This random pruning can increase imbalance.</li>
<li>Dimensionality: The problems with PSM become more pronounced as the number of covariates increases.</li>
</ol>
</section>
<section id="empirical-evidence" class="level3">
<h3 class="anchored" data-anchor-id="empirical-evidence">Empirical Evidence</h3>
<p>The authors provide evidence from both simulations and real-world datasets to support their claims. They show that as PSM prunes more observations, other matching methods (like Mahalanobis distance matching) continue to improve balance, while PSM begins to worsen it.</p>
</section>
<section id="recommendations" class="level3">
<h3 class="anchored" data-anchor-id="recommendations">Recommendations</h3>
<p>Based on their findings, King and Nielsen offer several recommendations:</p>
<ol type="1">
<li>Avoid PSM for Matching: They suggest using other matching methods that better approximate full blocking, such as Mahalanobis distance matching or coarsened exact matching.</li>
<li>Use PSM Carefully: If using PSM, researchers should be aware of its limitations and stop pruning before the paradox kicks in.</li>
<li>Balance Checking: Regardless of the matching method used, researchers should always check covariate balance before and after matching.</li>
<li>Consider Alternative Uses: While discouraging PSM for matching, the authors note that propensity scores can be useful in other contexts, such as weighting or subclassification.</li>
</ol>
</section>
<section id="implications-for-practice" class="level3">
<h3 class="anchored" data-anchor-id="implications-for-practice">Implications for Practice</h3>
<p>This critique has significant implications for how we approach matching in causal inference:</p>
<ol type="1">
<li>Method Selection: When choosing a matching method, consider how well it approximates full blocking rather than complete randomization.</li>
<li>Iterative Process: Matching should be an iterative process, with continuous checks on balance and careful consideration of when to stop pruning observations.</li>
<li>Multidimensional Balance: Pay attention to balance on the original covariates, not just the propensity score.</li>
<li>Transparency: Given the potential for increased model dependence, it’s crucial to be transparent about the matching process and to consider multiple model specifications.</li>
</ol>
</section>
</section>
<section id="practical-examples-with-matchit" class="level2" data-number="12.6">
<h2 data-number="12.6" class="anchored" data-anchor-id="practical-examples-with-matchit"><span class="header-section-number">12.6</span> Practical Examples with MatchIt</h2>
<p>The R package <a href="https://kosukeimai.github.io/MatchIt/">{MatchIt}</a> provides a comprehensive set of tools for implementing various matching methods. It was developed based on the recommendations of <span class="citation" data-cites="ho2007matching">(<a href="references.html#ref-ho2007matching" role="doc-biblioref">Daniel E. Ho et al. 2007</a>)</span> for improving parametric models through nonparametric preprocessing.</p>
<p>MatchIt supports a wide range of matching techniques, including:</p>
<ul>
<li>Exact matching</li>
<li>Nearest neighbor matching</li>
<li>Optimal matching</li>
<li>Full matching</li>
<li>Genetic matching</li>
<li>Coarsened exact matching</li>
</ul>
<section id="cautionary-tale-unmeasured-confounders." class="level3">
<h3 class="anchored" data-anchor-id="cautionary-tale-unmeasured-confounders.">Cautionary tale: Unmeasured Confounders.</h3>
<p>Imagine you’re a data scientist at the illustrious TechGiant Inc., a company that recently rolled out an intensive AI bootcamp program for its engineers. This ambitious initiative aims to elevate the workforce’s skills and propel innovation to new heights. You’ve been entrusted with a crucial task: to evaluate the program’s effectiveness by examining its impact on engineers’ salaries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate synthetic data</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>experience <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">10</span>)  <span class="co"># Years of experience</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>procrastination <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)  <span class="co"># Unobserved procrastination level</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>bootcamp <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="sc">-</span><span class="fl">0.3</span> <span class="sc">*</span> experience <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> procrastination))  <span class="co"># Bootcamp participation</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>salary_increase <span class="ot">&lt;-</span> <span class="dv">2000</span> <span class="sc">*</span> bootcamp <span class="sc">+</span> <span class="dv">1000</span> <span class="sc">*</span> experience <span class="sc">-</span> <span class="dv">9000</span> <span class="sc">*</span> procrastination <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">5000</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># True average treatment effect is $2000</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">experience =</span> experience,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bootcamp =</span> bootcamp,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">salary_increase =</span> salary_increase)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Naive estimate</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>naive_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary_increase <span class="sc">~</span> bootcamp, <span class="at">data =</span> data)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>naive_ate <span class="ot">&lt;-</span> <span class="fu">coef</span>(naive_model)[<span class="st">"bootcamp"</span>]</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Matching on experience (ignoring unobserved procrastination)</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>m.out <span class="ot">&lt;-</span> <span class="fu">matchit</span>(bootcamp <span class="sc">~</span> experience,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> data,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"nearest"</span>,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ratio =</span> <span class="dv">1</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>matched_data <span class="ot">&lt;-</span> <span class="fu">match.data</span>(m.out)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate ATE on matched data</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>matched_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary_increase <span class="sc">~</span> bootcamp,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> matched_data,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>                    <span class="at">weights =</span> weights)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>matched_ate <span class="ot">&lt;-</span> <span class="fu">coef</span>(matched_model)[<span class="st">"bootcamp"</span>]</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"True ATE: $2000</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True ATE: $2000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Naive ATE estimate:"</span>, <span class="fu">round</span>(naive_ate, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Naive ATE estimate: -3307.67 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Matched ATE estimate:"</span>, <span class="fu">round</span>(matched_ate, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Matched ATE estimate: -1543.69 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize results</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> experience,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> salary_increase,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="fu">factor</span>(bootcamp))) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AI Bootcamp Effect on Salary Increase"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"True effect is positive, but observed relationship appears negative"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Years of Experience"</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Salary Increase ($)"</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Bootcamp Participation"</span>) <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="matching_files/figure-html/unmeasure_confounders-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What’s happening in this scenario? Let’s break it down:</p>
<ol type="1">
<li><strong>The True Impact:</strong> In reality, the bootcamp program is a success. It genuinely enhances skills and, consequently, leads to higher salary increases.</li>
<li><strong>Experience and Participation:</strong> Less experienced engineers are more likely to enroll in the bootcamp, perhaps viewing it as a way to bridge the gap with their seasoned colleagues.</li>
<li><strong>Procrastination as a Hidden Factor:</strong> These same less experienced engineers, possibly due to feeling overwhelmed or uncertain in their roles, tend to have higher levels of procrastination.</li>
<li><strong>Motivation’s Influence on Salary:</strong> This inherent motivation leads to exceptional performance and subsequent salary raises, whether or not they participate in the bootcamp.</li>
<li><strong>Matching Gone Awry:</strong> By focusing on matching solely based on experience and overlooking motivation, you inadvertently compare highly motivated non-participants with a mix of motivated and less motivated participants.</li>
</ol>
<p>The consequence? Your analysis paints a deceptive picture, indicating a negative effect of the bootcamp when the true effect is, in fact, positive.</p>
<p>This example illustrates a critical lesson in causal inference: the danger of unmeasured confounders. In this case, motivation acts as an unmeasured confounder, influencing both the likelihood of bootcamp participation and salary increases. As a business data scientist, this scenario highlights the importance of:</p>
<ol type="1">
<li>Thinking critically about all factors that might influence both your treatment (bootcamp participation) and outcome (salary increases).</li>
<li>Recognizing the limitations of your data and analysis methods.</li>
<li>Communicating these nuances to stakeholders who might otherwise make decisions based on misleading results.</li>
<li>Considering additional data collection or alternative analysis methods to account for potential unmeasured confounders.</li>
</ol>
<p>In the end, your role isn’t just to crunch numbers, but to uncover the true story behind the data and guide your company towards informed decisions. This might involve recommending a more comprehensive study that includes measures of motivation, or suggesting a randomized pilot program for future iterations of the bootcamp.</p>
</section>
</section>
<section id="conclusion-the-power-and-pitfalls-of-matching" class="level2" data-number="12.7">
<h2 data-number="12.7" class="anchored" data-anchor-id="conclusion-the-power-and-pitfalls-of-matching"><span class="header-section-number">12.7</span> Conclusion: The Power and Pitfalls of Matching</h2>
<p>Matching is a powerful tool in the causal inference toolkit, offering a way to construct valid comparison groups and tease out causal effects from observational data. However, as we’ve seen, it’s not without its complexities and potential pitfalls.</p>
<p>From the basic concept of pairing similar units to the intricacies of different distance measures and matching algorithms, we’ve explored the mechanics of how matching works. We’ve also delved into its limitations, illustrated vividly by the Ozzy Osbourne Conundrum, which reminds us that observable characteristics don’t always tell the full story.</p>
<p>The critique by King and Nielsen serves as a important cautionary tale, particularly regarding the use of propensity score matching. Their work underscores the importance of understanding the theoretical underpinnings of our methods and approaching them critically.</p>
<p>As data scientists, our task is to navigate these complexities, understanding when and how to apply matching methods appropriately. We must be aware of their strengths and limitations, always striving for transparency in our processes and robustness in our results.</p>
<p>Matching, when used judiciously, can be a powerful ally in our quest to uncover causal relationships. But like any tool, its effectiveness depends on the skill and understanding of those who wield it. As we continue to push the boundaries of causal inference, let’s carry forward this nuanced understanding of matching, always remaining open to new developments and critiques that can refine our methodological toolkit.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learn more
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><span class="citation" data-cites="stuart2011matchit">Daniel E. Ho et al. (<a href="references.html#ref-stuart2011matchit" role="doc-biblioref">2011</a>)</span> {MatchIt}: Nonparametric Preprocessing for Parametric Causal Inference.</li>
<li><span class="citation" data-cites="King_Nielsen_2019">King and Nielsen (<a href="references.html#ref-King_Nielsen_2019" role="doc-biblioref">2019</a>)</span> Why Propensity Scores Should Not Be Used for Matching.</li>
</ul>
</div>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-stuart2011matchit" class="csl-entry" role="listitem">
Ho, Daniel E., Kosuke Imai, Gary King, and Elizabeth A. Stuart. 2011. <span>“<span>MatchIt</span>: Nonparametric Preprocessing for Parametric Causal Inference.”</span> <em>Journal of Statistical Software</em> 42 (8): 1–28. <a href="https://doi.org/10.18637/jss.v042.i08">https://doi.org/10.18637/jss.v042.i08</a>.
</div>
<div id="ref-ho2007matching" class="csl-entry" role="listitem">
Ho, Daniel E, Kosuke Imai, Gary King, and Elizabeth A Stuart. 2007. <span>“Matching as Nonparametric Preprocessing for Reducing Model Dependence in Parametric Causal Inference.”</span> <em>Political Analysis</em> 15 (3): 199–236.
</div>
<div id="ref-King_Nielsen_2019" class="csl-entry" role="listitem">
King, Gary, and Richard Nielsen. 2019. <span>“Why Propensity Scores Should Not Be Used for Matching.”</span> <em>Political Analysis</em> 27 (4): 435–54. <a href="https://doi.org/10.1017/pan.2019.11">https://doi.org/10.1017/pan.2019.11</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/book\.martinez\.fyi");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="ignacio82/book" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./other_methods.html" class="pagination-link" aria-label="Non Experimental Methods">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Non Experimental Methods</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./causalimpact.html" class="pagination-link" aria-label="Bayesian Structural Time Series">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Bayesian Structural Time Series</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb12" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Matching"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="an">share:</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">  permalink: "https://book.martinez.fyi/matching.html"</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">  description: "Business Data Science: What Does it Mean to Be Data-Driven?"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">  linkedin: true</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">  email: true</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">  mastodon: true</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: ??</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Ignacio Martinez  </span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>In the realm of causal inference, matching stands out as a powerful and popular</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>statistical technique. Its primary goal? To construct a valid comparison group</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>by pairing treated units with untreated units that are as similar as possible</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>based on observable characteristics. This chapter will dive deep into the world</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>of matching, exploring its mechanics, applications, and limitations.</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Bootcamp Conundrum</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>Imagine a tech company, eager to propel its engineers forward, rolls out a shiny</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>new AI bootcamp. Yet, due to scheduling quirks, the bootcamp ends up heavily</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>skewed towards senior engineers – those with five or more years under their</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>belts. This poses a classic causal inference challenge.</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>In the potential outcomes framework, we envision each engineer with two possible</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>career paths: one if they attend the bootcamp ($Y_1$), another if they don't</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>($Y_0$). The rub, of course, is that we only witness one reality per engineer.</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>The non-random enrollment in our bootcamp muddies the waters. Simply comparing</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>bootcamp graduates to non-participants would be like judging a footrace where</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>one runner had a head start. The bootcamp group, on average, boasts more</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>experience – a factor we know can independently turbocharge careers.</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="fu">## Matching to the Rescue</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>To level the playing field, we construct a matched control group. For each</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>bootcamp attendee, we seek out a non-attendee with a similar experience level.</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>By comparing outcomes within these matched pairs, we can tease out the</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>bootcamp's true impact, disentangling it from the effects of experience.</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>Yet, the plot thickens. What if bootcamp participation wasn't solely about</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>experience? In a global company, time zones could play a role. Attending a</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>bootcamp during US business hours is far more convenient for an engineer in New</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>York than one in Tokyo. Here, time zone becomes a confounder, potentially</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>influencing both bootcamp attendance and career trajectory.</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>One might try to match on both experience and location, but this quickly becomes</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>unwieldy as more factors enter the picture. The elegant solution is to estimate</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>a propensity score – the probability of each engineer attending the bootcamp</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>based on their various characteristics. By matching on this propensity score, we</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>create comparable groups, even when those groups differ on a multitude of</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>individual attributes.</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Mechanics of Matching</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>Matching typically involves four key steps:</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Choose a distance measure to quantify the similarity between units.</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Match treated units to untreated units based on this distance measure.</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Assess the quality of the matches and iterate if necessary.</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Estimate treatment effects using the matched sample.</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>Let's explore two common distance measures in detail: Mahalanobis distance and</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>propensity scores.</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mahalanobis Distance: Accounting for Covariate Relationships</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>Mahalanobis distance is a multivariate measure of the distance between a point</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>and the center of a distribution. It's particularly useful in matching because</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>it accounts for the correlations between variables.</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>Key features of Mahalanobis distance include:</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Scale-invariance: It's unaffected by the scale of measurement.</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Covariance consideration: It accounts for relationships between variables.</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Euclidean equivalence: For uncorrelated variables with unit variance, it</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>    reduces to Euclidean distance.</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>Mathematically, the Mahalanobis distance between two points $x$ and $y$ in</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>p-dimensional space is:</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>$$D_M(x,y) = \sqrt{(x-y)^T S^{-1} (x-y)}$$</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>Where $S$ is the covariance matrix of</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>the variables.</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a><span class="fu">### Propensity Scores: Collapsing Dimensions</span></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>The propensity score represents the probability of receiving treatment given</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>observed covariates, often estimated using logistic regression. Key features of</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>propensity scores include:</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Dimension reduction: They collapse multiple covariates into a single score.</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Balance assessment: They make it easier to check balance on a single</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>    dimension.</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Interpretability: They represent the probability of treatment.</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>The propensity score is given by: $$ e(X) = P(T=1|X)$$</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>Where $T$ is the treatment indicator and $X$ is the vector of covariates.</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a><span class="fu">### Key Differences Between Mahalanobis Distance and Propensity Score</span></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>| Feature                 | Mahalanobis Distance                 | Propensity Score                                    |</span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>| ----------------------- | ------------------------------------ | --------------------------------------------------- |</span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a>| Dimensionality          | Operates in original covariate space | Reduces matching to a single dimension              |</span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>| Interpretation          | Measures multivariate similarity     | Represents probability of treatment                 |</span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>| Covariate relationships | Explicitly accounts for covariance   | Implicitly captures relationships through the model |</span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>| Model specification     | Doesn't require a model              | Can be sensitive to estimation method               |</span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>| Categorical variables   | Can struggle with them               | Naturally incorporates them                         |</span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>| Curse of dimensionality | Can suffer in high dimensions        | Handles higher dimensions more easily               |</span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a><span class="fu">### When to Use Each</span></span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Mahalanobis distance:** Ideal when you have few continuous covariates,</span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a>    relationships between covariates are important, and you want to avoid</span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>    specifying a treatment model.</span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Propensity scores:** Better suited when you have many covariates</span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a>    (including categorical ones), the treatment mechanism is of interest, and</span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a>    you want to easily assess balance and overlap.</span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a><span class="fu">### Matching Algorithms: Putting Theory into Practice</span></span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a>Once we've chosen a distance measure, we need an algorithm to perform the actual</span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a>matching. Three common approaches are:</span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Nearest neighbor matching: Matches each treated unit to the closest</span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a>    untreated unit.</span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Optimal matching: Minimizes the total distance across all matched pairs.</span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Full matching: Creates matched sets, each containing at least one treated</span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a>    and one untreated unit.</span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Limits of Matching: Avoiding Matching Charles to Ozzy</span></span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a>As with any causal inference method, matching is not a magic bullet. It works</span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a>best when you have the right data to model treatment assignment. Essentially,</span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a>after matching, whether someone is in the treatment group should be effectively</span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a>random.</span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a>For example, in our bootcamp scenario, imagine that participation is largely</span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a>explained by an engineer's "grit" – a trait we cannot directly observe or match</span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>on. If career trajectory is also a function of grit, we might mistakenly</span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a>conclude that the bootcamp has a larger impact than it truly does. Conversely,</span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a>if procrastinators are more likely to participate, we might wrongly infer that</span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a>the bootcamp hurts career success.</span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a>A memorable way to understand this limitation is through the "Ozzy Osbourne</span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a>Conundrum." Consider these two individuals:</span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a>+--------------------------------------------------+--------------------------------------------+</span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a>|                    Charles                       |                    Ozzy                    |</span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a>+:================================================:+:==========================================:+</span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a>|                                                  |                                            |</span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a>| <span class="al">![](img/charles.webp)</span>{width=400px, height=500px} |<span class="al">![](img/ozzy.png)</span>{width=400px, height=500px}|</span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a>|                                                  |                                            |</span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a>|                     Male                         |                   Male                     |</span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a>|                                                  |                                            |</span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a>|                 Born in 1948                     |               Born in 1948                 |</span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a>|                                                  |                                            |</span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a>|               Raised in the UK                   |             Raised in the UK               |</span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a>|                                                  |                                            |</span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a>|              Lives in a castle                   |             Lives in a castle              |</span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a>|                                                  |                                            |</span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a>|              Wealthy &amp; famous                    |             Wealthy &amp; famous               |</span>
<span id="cb12-167"><a href="#cb12-167" aria-hidden="true" tabindex="-1"></a>+--------------------------------------------------+--------------------------------------------+</span>
<span id="cb12-168"><a href="#cb12-168" aria-hidden="true" tabindex="-1"></a>: Matching Charles to Ozzy {#tbl-ozzy_and_charles}</span>
<span id="cb12-169"><a href="#cb12-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-170"><a href="#cb12-170" aria-hidden="true" tabindex="-1"></a>Ozzy and Charles share many observable characteristics: they're both males, born</span>
<span id="cb12-171"><a href="#cb12-171" aria-hidden="true" tabindex="-1"></a>in 1948, raised in the UK, live in castles, and are wealthy and famous. However,</span>
<span id="cb12-172"><a href="#cb12-172" aria-hidden="true" tabindex="-1"></a>Ozzy would clearly not be a good match for Charles in most studies. This example</span>
<span id="cb12-173"><a href="#cb12-173" aria-hidden="true" tabindex="-1"></a>illustrates how matching on observables can sometimes be misleading.</span>
<span id="cb12-174"><a href="#cb12-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-175"><a href="#cb12-175" aria-hidden="true" tabindex="-1"></a>The key takeaway? Matching is a powerful tool, but it relies on the assumption</span>
<span id="cb12-176"><a href="#cb12-176" aria-hidden="true" tabindex="-1"></a>that after matching, the remaining differences between groups are essentially</span>
<span id="cb12-177"><a href="#cb12-177" aria-hidden="true" tabindex="-1"></a>random. If this assumption doesn't hold, our conclusions may be misleading.</span>
<span id="cb12-178"><a href="#cb12-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-179"><a href="#cb12-179" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Propensity Score Paradox: A Critique by King and Nielsen</span></span>
<span id="cb12-180"><a href="#cb12-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-181"><a href="#cb12-181" aria-hidden="true" tabindex="-1"></a>In their influential paper, @King_Nielsen_2019 present a compelling critique</span>
<span id="cb12-182"><a href="#cb12-182" aria-hidden="true" tabindex="-1"></a>of propensity score matching (PSM). Their findings challenge conventional wisdom</span>
<span id="cb12-183"><a href="#cb12-183" aria-hidden="true" tabindex="-1"></a>and offer important insights for practitioners of matching methods.</span>
<span id="cb12-184"><a href="#cb12-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-185"><a href="#cb12-185" aria-hidden="true" tabindex="-1"></a><span class="fu">### The PSM Paradox</span></span>
<span id="cb12-186"><a href="#cb12-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-187"><a href="#cb12-187" aria-hidden="true" tabindex="-1"></a>At the heart of King and Nielsen's argument is what they term the "PSM paradox."</span>
<span id="cb12-188"><a href="#cb12-188" aria-hidden="true" tabindex="-1"></a>They demonstrate that under certain conditions, PSM can actually increase</span>
<span id="cb12-189"><a href="#cb12-189" aria-hidden="true" tabindex="-1"></a>imbalance, model dependence, and bias. This occurs because PSM approximates a</span>
<span id="cb12-190"><a href="#cb12-190" aria-hidden="true" tabindex="-1"></a>completely randomized experiment, rather than a more efficient fully blocked</span>
<span id="cb12-191"><a href="#cb12-191" aria-hidden="true" tabindex="-1"></a>randomized experiment.</span>
<span id="cb12-192"><a href="#cb12-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-193"><a href="#cb12-193" aria-hidden="true" tabindex="-1"></a>Key findings include:</span>
<span id="cb12-194"><a href="#cb12-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-195"><a href="#cb12-195" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Increased Imbalance: As PSM prunes observations to improve balance, it can</span>
<span id="cb12-196"><a href="#cb12-196" aria-hidden="true" tabindex="-1"></a>    paradoxically increase imbalance on the original covariates after a certain</span>
<span id="cb12-197"><a href="#cb12-197" aria-hidden="true" tabindex="-1"></a>    point.</span>
<span id="cb12-198"><a href="#cb12-198" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Model Dependence: PSM can lead to greater model dependence, meaning that</span>
<span id="cb12-199"><a href="#cb12-199" aria-hidden="true" tabindex="-1"></a>    different model specifications can yield substantially different causal</span>
<span id="cb12-200"><a href="#cb12-200" aria-hidden="true" tabindex="-1"></a>    estimates.</span>
<span id="cb12-201"><a href="#cb12-201" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Bias: The combination of increased imbalance and model dependence can result</span>
<span id="cb12-202"><a href="#cb12-202" aria-hidden="true" tabindex="-1"></a>    in biased causal estimates.</span>
<span id="cb12-203"><a href="#cb12-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-204"><a href="#cb12-204" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Mechanics Behind the Paradox</span></span>
<span id="cb12-205"><a href="#cb12-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-206"><a href="#cb12-206" aria-hidden="true" tabindex="-1"></a>King and Nielsen explain that PSM's shortcomings stem from its attempt to</span>
<span id="cb12-207"><a href="#cb12-207" aria-hidden="true" tabindex="-1"></a>approximate complete randomization. In contrast, other matching methods aim to</span>
<span id="cb12-208"><a href="#cb12-208" aria-hidden="true" tabindex="-1"></a>approximate full blocking, which is generally more efficient and precise.</span>
<span id="cb12-209"><a href="#cb12-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-210"><a href="#cb12-210" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Information Loss: PSM collapses multi-dimensional covariate information into</span>
<span id="cb12-211"><a href="#cb12-211" aria-hidden="true" tabindex="-1"></a>    a single dimension (the propensity score), potentially discarding valuable</span>
<span id="cb12-212"><a href="#cb12-212" aria-hidden="true" tabindex="-1"></a>    information.</span>
<span id="cb12-213"><a href="#cb12-213" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Random Pruning: Once PSM achieves its goal of approximate randomization,</span>
<span id="cb12-214"><a href="#cb12-214" aria-hidden="true" tabindex="-1"></a>    further pruning of observations becomes essentially random with respect to</span>
<span id="cb12-215"><a href="#cb12-215" aria-hidden="true" tabindex="-1"></a>    the original covariates. This random pruning can increase imbalance.</span>
<span id="cb12-216"><a href="#cb12-216" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Dimensionality: The problems with PSM become more pronounced as the number</span>
<span id="cb12-217"><a href="#cb12-217" aria-hidden="true" tabindex="-1"></a>    of covariates increases.</span>
<span id="cb12-218"><a href="#cb12-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-219"><a href="#cb12-219" aria-hidden="true" tabindex="-1"></a><span class="fu">### Empirical Evidence</span></span>
<span id="cb12-220"><a href="#cb12-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-221"><a href="#cb12-221" aria-hidden="true" tabindex="-1"></a>The authors provide evidence from both simulations and real-world datasets to</span>
<span id="cb12-222"><a href="#cb12-222" aria-hidden="true" tabindex="-1"></a>support their claims. They show that as PSM prunes more observations, other</span>
<span id="cb12-223"><a href="#cb12-223" aria-hidden="true" tabindex="-1"></a>matching methods (like Mahalanobis distance matching) continue to improve</span>
<span id="cb12-224"><a href="#cb12-224" aria-hidden="true" tabindex="-1"></a>balance, while PSM begins to worsen it.</span>
<span id="cb12-225"><a href="#cb12-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-226"><a href="#cb12-226" aria-hidden="true" tabindex="-1"></a><span class="fu">### Recommendations</span></span>
<span id="cb12-227"><a href="#cb12-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-228"><a href="#cb12-228" aria-hidden="true" tabindex="-1"></a>Based on their findings, King and Nielsen offer several recommendations:</span>
<span id="cb12-229"><a href="#cb12-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-230"><a href="#cb12-230" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Avoid PSM for Matching: They suggest using other matching methods that</span>
<span id="cb12-231"><a href="#cb12-231" aria-hidden="true" tabindex="-1"></a>    better approximate full blocking, such as Mahalanobis distance matching or</span>
<span id="cb12-232"><a href="#cb12-232" aria-hidden="true" tabindex="-1"></a>    coarsened exact matching.</span>
<span id="cb12-233"><a href="#cb12-233" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Use PSM Carefully: If using PSM, researchers should be aware of its</span>
<span id="cb12-234"><a href="#cb12-234" aria-hidden="true" tabindex="-1"></a>    limitations and stop pruning before the paradox kicks in.</span>
<span id="cb12-235"><a href="#cb12-235" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Balance Checking: Regardless of the matching method used, researchers should</span>
<span id="cb12-236"><a href="#cb12-236" aria-hidden="true" tabindex="-1"></a>    always check covariate balance before and after matching.</span>
<span id="cb12-237"><a href="#cb12-237" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Consider Alternative Uses: While discouraging PSM for matching, the authors</span>
<span id="cb12-238"><a href="#cb12-238" aria-hidden="true" tabindex="-1"></a>    note that propensity scores can be useful in other contexts, such as</span>
<span id="cb12-239"><a href="#cb12-239" aria-hidden="true" tabindex="-1"></a>    weighting or subclassification.</span>
<span id="cb12-240"><a href="#cb12-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-241"><a href="#cb12-241" aria-hidden="true" tabindex="-1"></a><span class="fu">### Implications for Practice</span></span>
<span id="cb12-242"><a href="#cb12-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-243"><a href="#cb12-243" aria-hidden="true" tabindex="-1"></a>This critique has significant implications for how we approach matching in</span>
<span id="cb12-244"><a href="#cb12-244" aria-hidden="true" tabindex="-1"></a>causal inference:</span>
<span id="cb12-245"><a href="#cb12-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-246"><a href="#cb12-246" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Method Selection: When choosing a matching method, consider how well it</span>
<span id="cb12-247"><a href="#cb12-247" aria-hidden="true" tabindex="-1"></a>    approximates full blocking rather than complete randomization.</span>
<span id="cb12-248"><a href="#cb12-248" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Iterative Process: Matching should be an iterative process, with continuous</span>
<span id="cb12-249"><a href="#cb12-249" aria-hidden="true" tabindex="-1"></a>    checks on balance and careful consideration of when to stop pruning</span>
<span id="cb12-250"><a href="#cb12-250" aria-hidden="true" tabindex="-1"></a>    observations.</span>
<span id="cb12-251"><a href="#cb12-251" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Multidimensional Balance: Pay attention to balance on the original</span>
<span id="cb12-252"><a href="#cb12-252" aria-hidden="true" tabindex="-1"></a>    covariates, not just the propensity score.</span>
<span id="cb12-253"><a href="#cb12-253" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Transparency: Given the potential for increased model dependence, it's</span>
<span id="cb12-254"><a href="#cb12-254" aria-hidden="true" tabindex="-1"></a>    crucial to be transparent about the matching process and to consider</span>
<span id="cb12-255"><a href="#cb12-255" aria-hidden="true" tabindex="-1"></a>    multiple model specifications.</span>
<span id="cb12-256"><a href="#cb12-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-257"><a href="#cb12-257" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practical Examples with MatchIt</span></span>
<span id="cb12-258"><a href="#cb12-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-259"><a href="#cb12-259" aria-hidden="true" tabindex="-1"></a>The R package <span class="co">[</span><span class="ot">{MatchIt}</span><span class="co">](https://kosukeimai.github.io/MatchIt/)</span> provides a</span>
<span id="cb12-260"><a href="#cb12-260" aria-hidden="true" tabindex="-1"></a>comprehensive set of tools for implementing various matching methods. It was</span>
<span id="cb12-261"><a href="#cb12-261" aria-hidden="true" tabindex="-1"></a>developed based on the recommendations of <span class="co">[</span><span class="ot">@ho2007matching</span><span class="co">]</span> for improving</span>
<span id="cb12-262"><a href="#cb12-262" aria-hidden="true" tabindex="-1"></a>parametric models through nonparametric preprocessing. </span>
<span id="cb12-263"><a href="#cb12-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-264"><a href="#cb12-264" aria-hidden="true" tabindex="-1"></a>MatchIt supports a wide range of matching techniques, including:</span>
<span id="cb12-265"><a href="#cb12-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-266"><a href="#cb12-266" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Exact matching</span>
<span id="cb12-267"><a href="#cb12-267" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Nearest neighbor matching</span>
<span id="cb12-268"><a href="#cb12-268" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Optimal matching</span>
<span id="cb12-269"><a href="#cb12-269" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Full matching</span>
<span id="cb12-270"><a href="#cb12-270" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Genetic matching</span>
<span id="cb12-271"><a href="#cb12-271" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Coarsened exact matching</span>
<span id="cb12-272"><a href="#cb12-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-273"><a href="#cb12-273" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cautionary tale: Unmeasured Confounders. </span></span>
<span id="cb12-274"><a href="#cb12-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-275"><a href="#cb12-275" aria-hidden="true" tabindex="-1"></a>Imagine you're a data scientist at the illustrious TechGiant Inc., a company</span>
<span id="cb12-276"><a href="#cb12-276" aria-hidden="true" tabindex="-1"></a>that recently rolled out an intensive AI bootcamp program for its engineers.</span>
<span id="cb12-277"><a href="#cb12-277" aria-hidden="true" tabindex="-1"></a>This ambitious initiative aims to elevate the workforce's skills and propel</span>
<span id="cb12-278"><a href="#cb12-278" aria-hidden="true" tabindex="-1"></a>innovation to new heights. You've been entrusted with a crucial task: to</span>
<span id="cb12-279"><a href="#cb12-279" aria-hidden="true" tabindex="-1"></a>evaluate the program's effectiveness by examining its impact on engineers'</span>
<span id="cb12-280"><a href="#cb12-280" aria-hidden="true" tabindex="-1"></a>salaries.</span>
<span id="cb12-281"><a href="#cb12-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-282"><a href="#cb12-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r unmeasure_confounders, message=FALSE, warning=FALSE}</span></span>
<span id="cb12-283"><a href="#cb12-283" aria-hidden="true" tabindex="-1"></a><span class="in">library(MatchIt)</span></span>
<span id="cb12-284"><a href="#cb12-284" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb12-285"><a href="#cb12-285" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb12-286"><a href="#cb12-286" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(123)</span></span>
<span id="cb12-287"><a href="#cb12-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-288"><a href="#cb12-288" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate synthetic data</span></span>
<span id="cb12-289"><a href="#cb12-289" aria-hidden="true" tabindex="-1"></a><span class="in">n &lt;- 1000</span></span>
<span id="cb12-290"><a href="#cb12-290" aria-hidden="true" tabindex="-1"></a><span class="in">experience &lt;- runif(n, 0, 10)  # Years of experience</span></span>
<span id="cb12-291"><a href="#cb12-291" aria-hidden="true" tabindex="-1"></a><span class="in">procrastination &lt;- rnorm(n)  # Unobserved procrastination level</span></span>
<span id="cb12-292"><a href="#cb12-292" aria-hidden="true" tabindex="-1"></a><span class="in">bootcamp &lt;- rbinom(n, 1, plogis(-0.3 * experience + 0.5 * procrastination))  # Bootcamp participation</span></span>
<span id="cb12-293"><a href="#cb12-293" aria-hidden="true" tabindex="-1"></a><span class="in">salary_increase &lt;- 2000 * bootcamp + 1000 * experience - 9000 * procrastination + rnorm(n, 0, 5000)</span></span>
<span id="cb12-294"><a href="#cb12-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-295"><a href="#cb12-295" aria-hidden="true" tabindex="-1"></a><span class="in"># True average treatment effect is $2000</span></span>
<span id="cb12-296"><a href="#cb12-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-297"><a href="#cb12-297" aria-hidden="true" tabindex="-1"></a><span class="in">data &lt;- data.frame(experience = experience,</span></span>
<span id="cb12-298"><a href="#cb12-298" aria-hidden="true" tabindex="-1"></a><span class="in">                   bootcamp = bootcamp,</span></span>
<span id="cb12-299"><a href="#cb12-299" aria-hidden="true" tabindex="-1"></a><span class="in">                   salary_increase = salary_increase)</span></span>
<span id="cb12-300"><a href="#cb12-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-301"><a href="#cb12-301" aria-hidden="true" tabindex="-1"></a><span class="in"># Naive estimate</span></span>
<span id="cb12-302"><a href="#cb12-302" aria-hidden="true" tabindex="-1"></a><span class="in">naive_model &lt;- lm(salary_increase ~ bootcamp, data = data)</span></span>
<span id="cb12-303"><a href="#cb12-303" aria-hidden="true" tabindex="-1"></a><span class="in">naive_ate &lt;- coef(naive_model)["bootcamp"]</span></span>
<span id="cb12-304"><a href="#cb12-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-305"><a href="#cb12-305" aria-hidden="true" tabindex="-1"></a><span class="in"># Matching on experience (ignoring unobserved procrastination)</span></span>
<span id="cb12-306"><a href="#cb12-306" aria-hidden="true" tabindex="-1"></a><span class="in">m.out &lt;- matchit(bootcamp ~ experience,</span></span>
<span id="cb12-307"><a href="#cb12-307" aria-hidden="true" tabindex="-1"></a><span class="in">                 data = data,</span></span>
<span id="cb12-308"><a href="#cb12-308" aria-hidden="true" tabindex="-1"></a><span class="in">                 method = "nearest",</span></span>
<span id="cb12-309"><a href="#cb12-309" aria-hidden="true" tabindex="-1"></a><span class="in">                 ratio = 1)</span></span>
<span id="cb12-310"><a href="#cb12-310" aria-hidden="true" tabindex="-1"></a><span class="in">matched_data &lt;- match.data(m.out)</span></span>
<span id="cb12-311"><a href="#cb12-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-312"><a href="#cb12-312" aria-hidden="true" tabindex="-1"></a><span class="in"># Estimate ATE on matched data</span></span>
<span id="cb12-313"><a href="#cb12-313" aria-hidden="true" tabindex="-1"></a><span class="in">matched_model &lt;- lm(salary_increase ~ bootcamp,</span></span>
<span id="cb12-314"><a href="#cb12-314" aria-hidden="true" tabindex="-1"></a><span class="in">                    data = matched_data,</span></span>
<span id="cb12-315"><a href="#cb12-315" aria-hidden="true" tabindex="-1"></a><span class="in">                    weights = weights)</span></span>
<span id="cb12-316"><a href="#cb12-316" aria-hidden="true" tabindex="-1"></a><span class="in">matched_ate &lt;- coef(matched_model)["bootcamp"]</span></span>
<span id="cb12-317"><a href="#cb12-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-318"><a href="#cb12-318" aria-hidden="true" tabindex="-1"></a><span class="in"># Print results</span></span>
<span id="cb12-319"><a href="#cb12-319" aria-hidden="true" tabindex="-1"></a><span class="in">cat("True ATE: $2000\n")</span></span>
<span id="cb12-320"><a href="#cb12-320" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Naive ATE estimate:", round(naive_ate, 2), "\n")</span></span>
<span id="cb12-321"><a href="#cb12-321" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Matched ATE estimate:", round(matched_ate, 2), "\n")</span></span>
<span id="cb12-322"><a href="#cb12-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-323"><a href="#cb12-323" aria-hidden="true" tabindex="-1"></a><span class="in"># Visualize results</span></span>
<span id="cb12-324"><a href="#cb12-324" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data, aes(x = experience,</span></span>
<span id="cb12-325"><a href="#cb12-325" aria-hidden="true" tabindex="-1"></a><span class="in">                 y = salary_increase,</span></span>
<span id="cb12-326"><a href="#cb12-326" aria-hidden="true" tabindex="-1"></a><span class="in">                 color = factor(bootcamp))) +</span></span>
<span id="cb12-327"><a href="#cb12-327" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(alpha = 0.5) +</span></span>
<span id="cb12-328"><a href="#cb12-328" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = FALSE) +</span></span>
<span id="cb12-329"><a href="#cb12-329" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "AI Bootcamp Effect on Salary Increase",</span></span>
<span id="cb12-330"><a href="#cb12-330" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "True effect is positive, but observed relationship appears negative",</span></span>
<span id="cb12-331"><a href="#cb12-331" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "Years of Experience",</span></span>
<span id="cb12-332"><a href="#cb12-332" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Salary Increase ($)",</span></span>
<span id="cb12-333"><a href="#cb12-333" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "Bootcamp Participation") +</span></span>
<span id="cb12-334"><a href="#cb12-334" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb12-335"><a href="#cb12-335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-336"><a href="#cb12-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-337"><a href="#cb12-337" aria-hidden="true" tabindex="-1"></a>What's happening in this scenario? Let's break it down:</span>
<span id="cb12-338"><a href="#cb12-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-339"><a href="#cb12-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-340"><a href="#cb12-340" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**The True Impact:** In reality, the bootcamp program is a success. It</span>
<span id="cb12-341"><a href="#cb12-341" aria-hidden="true" tabindex="-1"></a>    genuinely enhances skills and, consequently, leads to higher salary</span>
<span id="cb12-342"><a href="#cb12-342" aria-hidden="true" tabindex="-1"></a>    increases.</span>
<span id="cb12-343"><a href="#cb12-343" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Experience and Participation:** Less experienced engineers are more likely</span>
<span id="cb12-344"><a href="#cb12-344" aria-hidden="true" tabindex="-1"></a>    to enroll in the bootcamp, perhaps viewing it as a way to bridge the gap</span>
<span id="cb12-345"><a href="#cb12-345" aria-hidden="true" tabindex="-1"></a>    with their seasoned colleagues.</span>
<span id="cb12-346"><a href="#cb12-346" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Procrastination as a Hidden Factor:** These same less experienced</span>
<span id="cb12-347"><a href="#cb12-347" aria-hidden="true" tabindex="-1"></a>    engineers, possibly due to feeling overwhelmed or uncertain in their roles,</span>
<span id="cb12-348"><a href="#cb12-348" aria-hidden="true" tabindex="-1"></a>    tend to have higher levels of procrastination.</span>
<span id="cb12-349"><a href="#cb12-349" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Motivation's Influence on Salary:** This inherent motivation leads to</span>
<span id="cb12-350"><a href="#cb12-350" aria-hidden="true" tabindex="-1"></a>    exceptional performance and subsequent salary raises, whether or not they</span>
<span id="cb12-351"><a href="#cb12-351" aria-hidden="true" tabindex="-1"></a>    participate in the bootcamp.</span>
<span id="cb12-352"><a href="#cb12-352" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Matching Gone Awry:** By focusing on matching solely based on experience</span>
<span id="cb12-353"><a href="#cb12-353" aria-hidden="true" tabindex="-1"></a>    and overlooking motivation, you inadvertently compare highly motivated</span>
<span id="cb12-354"><a href="#cb12-354" aria-hidden="true" tabindex="-1"></a>    non-participants with a mix of motivated and less motivated participants.</span>
<span id="cb12-355"><a href="#cb12-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-356"><a href="#cb12-356" aria-hidden="true" tabindex="-1"></a>The consequence? Your analysis paints a deceptive picture, indicating a negative</span>
<span id="cb12-357"><a href="#cb12-357" aria-hidden="true" tabindex="-1"></a>effect of the bootcamp when the true effect is, in fact, positive.</span>
<span id="cb12-358"><a href="#cb12-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-359"><a href="#cb12-359" aria-hidden="true" tabindex="-1"></a>This example illustrates a critical lesson in causal inference: the danger of</span>
<span id="cb12-360"><a href="#cb12-360" aria-hidden="true" tabindex="-1"></a>unmeasured confounders. In this case, motivation acts as an unmeasured</span>
<span id="cb12-361"><a href="#cb12-361" aria-hidden="true" tabindex="-1"></a>confounder, influencing both the likelihood of bootcamp participation and salary</span>
<span id="cb12-362"><a href="#cb12-362" aria-hidden="true" tabindex="-1"></a>increases. As a business data scientist, this scenario highlights the importance</span>
<span id="cb12-363"><a href="#cb12-363" aria-hidden="true" tabindex="-1"></a>of:</span>
<span id="cb12-364"><a href="#cb12-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-365"><a href="#cb12-365" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Thinking critically about all factors that might influence both your</span>
<span id="cb12-366"><a href="#cb12-366" aria-hidden="true" tabindex="-1"></a>    treatment (bootcamp participation) and outcome (salary increases).</span>
<span id="cb12-367"><a href="#cb12-367" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Recognizing the limitations of your data and analysis methods.</span>
<span id="cb12-368"><a href="#cb12-368" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Communicating these nuances to stakeholders who might otherwise make</span>
<span id="cb12-369"><a href="#cb12-369" aria-hidden="true" tabindex="-1"></a>    decisions based on misleading results.</span>
<span id="cb12-370"><a href="#cb12-370" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Considering additional data collection or alternative analysis methods to</span>
<span id="cb12-371"><a href="#cb12-371" aria-hidden="true" tabindex="-1"></a>    account for potential unmeasured confounders.</span>
<span id="cb12-372"><a href="#cb12-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-373"><a href="#cb12-373" aria-hidden="true" tabindex="-1"></a>In the end, your role isn't just to crunch numbers, but to uncover the true</span>
<span id="cb12-374"><a href="#cb12-374" aria-hidden="true" tabindex="-1"></a>story behind the data and guide your company towards informed decisions. This</span>
<span id="cb12-375"><a href="#cb12-375" aria-hidden="true" tabindex="-1"></a>might involve recommending a more comprehensive study that includes measures of</span>
<span id="cb12-376"><a href="#cb12-376" aria-hidden="true" tabindex="-1"></a>motivation, or suggesting a randomized pilot program for future iterations of</span>
<span id="cb12-377"><a href="#cb12-377" aria-hidden="true" tabindex="-1"></a>the bootcamp.</span>
<span id="cb12-378"><a href="#cb12-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-379"><a href="#cb12-379" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion: The Power and Pitfalls of Matching</span></span>
<span id="cb12-380"><a href="#cb12-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-381"><a href="#cb12-381" aria-hidden="true" tabindex="-1"></a>Matching is a powerful tool in the causal inference toolkit, offering a way to</span>
<span id="cb12-382"><a href="#cb12-382" aria-hidden="true" tabindex="-1"></a>construct valid comparison groups and tease out causal effects from</span>
<span id="cb12-383"><a href="#cb12-383" aria-hidden="true" tabindex="-1"></a>observational data. However, as we've seen, it's not without its complexities</span>
<span id="cb12-384"><a href="#cb12-384" aria-hidden="true" tabindex="-1"></a>and potential pitfalls.</span>
<span id="cb12-385"><a href="#cb12-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-386"><a href="#cb12-386" aria-hidden="true" tabindex="-1"></a>From the basic concept of pairing similar units to the intricacies of different</span>
<span id="cb12-387"><a href="#cb12-387" aria-hidden="true" tabindex="-1"></a>distance measures and matching algorithms, we've explored the mechanics of how</span>
<span id="cb12-388"><a href="#cb12-388" aria-hidden="true" tabindex="-1"></a>matching works. We've also delved into its limitations, illustrated vividly by</span>
<span id="cb12-389"><a href="#cb12-389" aria-hidden="true" tabindex="-1"></a>the Ozzy Osbourne Conundrum, which reminds us that observable characteristics</span>
<span id="cb12-390"><a href="#cb12-390" aria-hidden="true" tabindex="-1"></a>don't always tell the full story.</span>
<span id="cb12-391"><a href="#cb12-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-392"><a href="#cb12-392" aria-hidden="true" tabindex="-1"></a>The critique by King and Nielsen serves as a important cautionary tale,</span>
<span id="cb12-393"><a href="#cb12-393" aria-hidden="true" tabindex="-1"></a>particularly regarding the use of propensity score matching. Their work</span>
<span id="cb12-394"><a href="#cb12-394" aria-hidden="true" tabindex="-1"></a>underscores the importance of understanding the theoretical underpinnings of our</span>
<span id="cb12-395"><a href="#cb12-395" aria-hidden="true" tabindex="-1"></a>methods and approaching them critically.</span>
<span id="cb12-396"><a href="#cb12-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-397"><a href="#cb12-397" aria-hidden="true" tabindex="-1"></a>As data scientists, our task is to navigate these complexities, understanding</span>
<span id="cb12-398"><a href="#cb12-398" aria-hidden="true" tabindex="-1"></a>when and how to apply matching methods appropriately. We must be aware of their</span>
<span id="cb12-399"><a href="#cb12-399" aria-hidden="true" tabindex="-1"></a>strengths and limitations, always striving for transparency in our processes and</span>
<span id="cb12-400"><a href="#cb12-400" aria-hidden="true" tabindex="-1"></a>robustness in our results.</span>
<span id="cb12-401"><a href="#cb12-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-402"><a href="#cb12-402" aria-hidden="true" tabindex="-1"></a>Matching, when used judiciously, can be a powerful ally in our quest to uncover</span>
<span id="cb12-403"><a href="#cb12-403" aria-hidden="true" tabindex="-1"></a>causal relationships. But like any tool, its effectiveness depends on the skill</span>
<span id="cb12-404"><a href="#cb12-404" aria-hidden="true" tabindex="-1"></a>and understanding of those who wield it. As we continue to push the boundaries</span>
<span id="cb12-405"><a href="#cb12-405" aria-hidden="true" tabindex="-1"></a>of causal inference, let's carry forward this nuanced understanding of matching,</span>
<span id="cb12-406"><a href="#cb12-406" aria-hidden="true" tabindex="-1"></a>always remaining open to new developments and critiques that can refine our</span>
<span id="cb12-407"><a href="#cb12-407" aria-hidden="true" tabindex="-1"></a>methodological toolkit.</span>
<span id="cb12-408"><a href="#cb12-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-409"><a href="#cb12-409" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb12-410"><a href="#cb12-410" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learn more</span></span>
<span id="cb12-411"><a href="#cb12-411" aria-hidden="true" tabindex="-1"></a><span class="ss"> - </span>@stuart2011matchit {MatchIt}: Nonparametric Preprocessing for Parametric Causal Inference.</span>
<span id="cb12-412"><a href="#cb12-412" aria-hidden="true" tabindex="-1"></a><span class="ss"> - </span>@King_Nielsen_2019 Why Propensity Scores Should Not Be Used for Matching.</span>
<span id="cb12-413"><a href="#cb12-413" aria-hidden="true" tabindex="-1"></a>:::</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ignacio82/book/edit/master/matching.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer><div class="page-columns page-rows-contents page-layout-article"><div class="social-share"><a href="https://www.linkedin.com/shareArticle?url=https://book.martinez.fyi/matching.html&amp;title=Business Data Science: What Does it Mean to Be Data-Driven?" target="_blank" class="linkedin"><i class="fa-brands fa-linkedin-in fa-fw fa-lg"></i></a>  <a href="mailto:?subject=Business Data Science: What Does it Mean to Be Data-Driven?&amp;body=Check out this link:https://book.martinez.fyi/matching.html" target="_blank" class="email"><i class="fa-solid fa-envelope fa-fw fa-lg"></i></a><a href="javascript:void(0);" onclick="var mastodon_instance=prompt('Mastodon Instance / Server Name?'); if(typeof mastodon_instance==='string' &amp;&amp; mastodon_instance.length){this.href='https://'+mastodon_instance+'/share?text=Business Data Science: What Does it Mean to Be Data-Driven? https://book.martinez.fyi/matching.html'}else{return false;}" target="_blank" class="mastodon"><i class="fa-brands fa-mastodon fa-fw fa-lg"></i></a></div></div>




</body></html>